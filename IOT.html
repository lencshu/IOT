<!DOCTYPE html><html><head><meta charset="utf-8"><style> /*左边目录框的样式*/
.tod {
    height: 100%; /*目录框的高度*/
    float:left;/*目录框的位置*/
    overflow-y:scroll;/*目录框添加滚动条*/
    padding-right: 10px;
    position: fixed;/*目录框相对浏览器进行定位*/
    width:36%;/*目录框的宽度*/
    font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
  text-decoration: none;
    }
A { text-decoration: none} 
A:hover { text-decoration:underline;} 


img {
  box-shadow: 1px 1px 10px #d3d3d3;
  height: auto;
  max-width: 60vw;
}

/*img {
  border: 0px dotted #e6e6e6;
  padding: 0em;
  max-width:2.5rem;
  max-height:500px;
  box-shadow: 1px 1px 10px #d3d3d3;
  overflow:hidden;
  zoom: 0.65;
}*/

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
  margin: 16px auto;
  max-width: 980px;
  outline: 1300px solid #fff;

}

.progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #F8F8F8;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.progress-bar {
  height: 24px;
  float: left;
  border-right: 1px solid #ccc;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #34c2e3;
  box-shadow: inset 0 1px 0px rgba(255, 255, 255, .5);
}

For Level Colors

.progress-100plus .progress-bar {
  background-color: #1ee038;
}

.progress-80plus .progress-bar {
  background-color: #86e01e;
}

.progress-60plus .progress-bar {
  background-color: #f2d31b;
}

.progress-40plus .progress-bar {
  background-color: #f2b01e;
}

.progress-20plus .progress-bar {
  background-color: #f27011;
}

.progress-0plus .progress-bar {
  background-color: #f63a0f;
}

.candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}


@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAzUABAAAAAAFNgAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAABbAAAABwAAAAcZMzaOEdERUYAAAGIAAAAHQAAACAAOQAET1MvMgAAAagAAAA+AAAAYHqhde9jbWFwAAAB6AAAAFIAAAFa4azkLWN2dCAAAAI8AAAAKAAAACgFgwioZnBnbQAAAmQAAAGxAAACZVO0L6dnYXNwAAAEGAAAAAgAAAAIAAAAEGdseWYAAAQgAAAFDgAACMz7eroHaGVhZAAACTAAAAAwAAAANgWEOEloaGVhAAAJYAAAAB0AAAAkDGEGa2htdHgAAAmAAAAAEwAAADBEgAAQbG9jYQAACZQAAAAaAAAAGgsICJBtYXhwAAAJsAAAACAAAAAgASgBD25hbWUAAAnQAAACZwAABOD4no+3cG9zdAAADDgAAABsAAAAmF+yXM9wcmVwAAAMpAAAAC4AAAAusPIrFAAAAAEAAAAAyYlvMQAAAADLVHQgAAAAAM/u9uZ4nGNgZGBg4ANiCQYQYGJgBEJuIGYB8xgABMMAPgAAAHicY2Bm42OcwMDKwMLSw2LMwMDQBqGZihmiwHycoKCyqJjB4YPDh4NsDP+BfNb3DIuAFCOSEgUGRgAKDgt4AAB4nGNgYGBmgGAZBkYGEAgB8hjBfBYGCyDNxcDBwMTA9MHhQ9SHrA8H//9nYACyQyFs/sP86/kX8HtB9UIBIxsDXICRCUgwMaACRoZhDwA3fxKSAAAAAAHyAHABJQB/AIEAdAFGAOsBIwC/ALgAxACGAGYAugBNACcA/wCIeJxdUbtOW0EQ3Q0PA4HE2CA52hSzmZDGe6EFCcTVjWJkO4XlCGk3cpGLcQEfQIFEDdqvGaChpEibBiEXSHxCPiESM2uIojQ7O7NzzpkzS8qRqnfpa89T5ySQwt0GzTb9Tki1swD3pOvrjYy0gwdabGb0ynX7/gsGm9GUO2oA5T1vKQ8ZTTuBWrSn/tH8Cob7/B/zOxi0NNP01DoJ6SEE5ptxS4PvGc26yw/6gtXhYjAwpJim4i4/plL+tzTnasuwtZHRvIMzEfnJNEBTa20Emv7UIdXzcRRLkMumsTaYmLL+JBPBhcl0VVO1zPjawV2ys+hggyrNgQfYw1Z5DB4ODyYU0rckyiwNEfZiq8QIEZMcCjnl3Mn+pED5SBLGvElKO+OGtQbGkdfAoDZPs/88m01tbx3C+FkcwXe/GUs6+MiG2hgRYjtiKYAJREJGVfmGGs+9LAbkUvvPQJSA5fGPf50ItO7YRDyXtXUOMVYIen7b3PLLirtWuc6LQndvqmqo0inN+17OvscDnh4Lw0FjwZvP+/5Kgfo8LK40aA4EQ3o3ev+iteqIq7wXPrIn07+xWgAAAAABAAH//wAPeJyFlctvG1UUh+/12DPN1B7P3JnYjj2Ox4/MuDHxJH5N3UdaEUQLqBIkfQQioJWQ6AMEQkIqsPGCPwA1otuWSmTBhjtps2ADWbJg3EpIXbGouqSbCraJw7kzNo2dRN1cnXN1ZvT7zuuiMEI7ncizyA0URofRBJpCdbQuIFShYY+GZRrxMDVtih5TwQPHtXDFFSIKoWIbuREBjLH27Ny4MsbVx+uOJThavebgVrNRLAiYx06rXsvhxLgWx9xpfHdrs/ekc2Pl2cpPCVEITQpwbj8VQhfXSq2m+Wxqaq2D73Kne5e3NjHqQNj3CRYlJlgUl/jRNP+2Gs2pNYRQiOnmUaQDqm30KqKiTTWPWjboxnTWpvgxjXo0KrtZXAHt7hwIz0YVcj88JnKlJKi3NPAwLyDwZudSmJSMMJFDYaOkaol6XtESx3Gt1VTytdZJ3DCLeaVhVnCBH1fycHTxFXwPX+l2e3d6H/TufGGmMTLTnbSJUdo00zuBswMO/nl3YLeL/wnu9/limCuD3vC54h5NBVz6Li414AI8Vx3iiosKcQXUbrvhFFiYb++HN4DaF4XzFW0fIN4XDWJ3a3XQoq9V8WiyRmdsatV9xUcHims1JloH0YUa090G3Tro3mC6c01f+YwCPquINr1PTaCP6rVTOOmf0GE2dBc7zWIhji3/5MchSuBHgDbU99RMWt3YUNMZMJmx92YP6NsHx/5/M1yvInpnkIOM3Z8fA3JQ2lW1RFC1KaBPDFXNAHYYvGy73aYZZZ3HifbeuiVZCpwA3oQBs0wGPYJbJfg60xrKEbKiNtTe1adwrpBRwlAuQ3q3VRaX0QmQ9a49BTSCuF1MLfQ6+tinOubRBZuWPNoMevGMT+V41KitO1is3D/tpMcq1JHZqDHGs8DoYGDkxJgKjHROeTCmhZvzPm9pod+ltKm4PN7Dyvvldlpsg8D+4AUJZ3F/JBstZz7cbFRxsaAGV6yX/dkcycWf8eS3QlQea+YLjdm3yrOnrhFpUyKVvFE4lpv4bO3Svx/6F/4xmiDu/RT5iI++lko18mY1oX+5UGKR6kmVjM/Zb76yfHtxy+h/SyQ0lLdpdKy/lWB6szatetQJ8nZ80A2Qt6ift6gJeavU3BO4gtxs/KCtNPVibCtYCWY3SIlSBPKXZALXiIR9oZeJ1AuMyxLpHIy/yO7vSiSE+kZvk0ihJ30HgHfzZtEMmvV58x6dtqns0XTAW7Vdm4HJ04OCp/crOO7rd9SGxQAE/mVA9xRN+kVSMRFF6S9JFGUtthkjBA5tFCWc2l4V43Ex9GmUP3SI37Jjmir9KqlaDJ4S4JB3vuM/jzyH1+8MuoZ+QGzfnvPoJb96cZlWjMcKLfgDwB7E634JTY+asjsPzS5CiVnEWY+KsrsIN5rn3mAPjqmQBxGjcGKB9f9ZxY3mYC2L85CJ2FXIxKKyHk+dg0FHbuEc7D5NzWUX32WxFcWNGRAbvwSx0RmIXVDuYySafluQBmzA/ssqJAMLnli+WIC90Gw4lm85wcp0qjArEDPJJV/sSx4P9ungTpgMw5gVC1XO4uULq0s3v1rqLi0vX/z65vlH50f8T/RHmSPTk5xxWBWOluMT6WiOy+tdvWxlV/XQb3o3c6Ssr+r6I708GsX9/nzp1tKFh0s3v7m4vAy/Hnb/KMOvc1wump6Il48K6mGDy02X9Yd65pa+nQIjk76lWxCkG8NBCP0HQS9IpAAAeJxjYGRgYGBhcCrq214Qz2/zlUGenQEEzr/77oug/zewFbB+AHI5GJhAogBwKQ0qeJxjYGRgYH3/P46BgZ0BBNgKGBgZUAEPAE/7At0AAAB4nGNngAB2IGYjhBsYBAAIYADVAAAAAAAAAAAAAFwAyAEeAaACCgKmAx4DggRmAAAAAQAAAAwAagAEAAAAAAACAAEAAgAWAAABAAChAAAAAHiclZI7bxQxFIWPd/JkUYQChEhIyAVKgdBMskm1QkKrRETpQiLRUczueB/K7HhlOxttg8LvoKPgP9DxFxANDR0tHRWi4NjrPIBEgh1p/dm+vufcawNYFWsQmP6e4jSyQB2fI9cwj++RE9wTjyPP4LYoI89iWbyLPIe6+Bh5Hs9rryMv4GbtW+RF3EhuRa7jbrIbeQkPkjdUETOLnL0Kip4FVvAhco1RXyMnSPEz8gzWxE7kWTwUp5HnsCLeR57HW/El8gJWa58iL+JO7UfkOh4l9yMv4UnyEtvQGGECgwF66MNBooF1bGCL1ELB/TYU+ZBRlvsKQ44Se6jQ4a7hef+fh72Crv25kp+8lNWGmeKoOI5jJLb1aGIGvb6TjfWNLdkqdFvJw4l1amjlXtXRZqRN7lSRylZZyhBqpVFWmTEXgWfUrpi/hZOQXdOd4rKuXOtEWT3k5IArPRzTUU5tHKjecZkTpnVbNOnt6jzN8240GD4xtikvZW56043rPMg/dS+dlOceXoR+WPbJ55Dsekq1lJpnypsMUsYOdCW30o103Ytu/lvh+5RWFLfBjm9/N8hJntPhvx92rnoE/kyHdGasGy754kw36vsVf/lFeBi+0COu+cfgQr42G3CRpeLoZ53gmfe3X6rcKt5oVxnptHR9JS8ehVUd5wvvahN2uqxOOpMXapibI5k7Zwbt4xBSaTfoKBufhAnO/uqNcfK8OTs0OQ6l7JIqFjDhYj5WcjevCnI/1DDiI8j4ndWb/5YzDZWh79yomWXeXj7Nnw70/2TIeFPTrlSh89k1ObOSRVZWZfgF0r/zJQB4nG2JUQuCQBCEd07TTg36fb2IyBaLd3vWaUh/vmSJnvpgmG8YcmS8X3Shf3R7QA4OBUocUKHGER5NNbOOEvwc1txnuWkTRb/aPjimJ5vXabI+3VfOiyS15UWvyezM2xiGOPyuMohOH8O8JiO4Af+FsAGNAEuwCFBYsQEBjlmxRgYrWCGwEFlLsBRSWCGwgFkdsAYrXFhZsBQrAAA=) format('woff');
}

@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAYcAA0AAAAACjQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAABMAAAABwAAAAca8vGTk9TLzIAAAFMAAAARAAAAFZG1VHVY21hcAAAAZAAAAA+AAABQgAP9AdjdnQgAAAB0AAAAAQAAAAEACICiGdhc3AAAAHUAAAACAAAAAj//wADZ2x5ZgAAAdwAAADRAAABEKyikaNoZWFkAAACsAAAAC0AAAA2AtXoA2hoZWEAAALgAAAAHAAAACQHngNFaG10eAAAAvwAAAAQAAAAEAwAACJsb2NhAAADDAAAAAoAAAAKALIAVG1heHAAAAMYAAAAHwAAACABEAB2bmFtZQAAAzgAAALBAAAFu3I9x/Nwb3N0AAAF/AAAAB0AAAAvaoFvbwAAAAEAAAAAzBdyYwAAAADP2IQvAAAAAM/bz7t4nGNgZGFgnMDAysDB1Ml0hoGBoR9CM75mMGLkYGBgYmBlZsAKAtJcUxgcPsR8iGF2+O/AEMPsznAYKMwIkgMA5REMOXicY2BgYGaAYBkGRgYQsAHyGMF8FgYFIM0ChED+h5j//yEk/3KoSgZGNgYYk4GRCUgwMaACRoZhDwCs7QgGAAAAIgKIAAAAAf//AAJ4nHWMMQrCQBBF/0zWrCCIKUQsTDCL2EXMohYGSSmorScInsRGL2DOYJe0Ntp7BK+gJ1BxF1stZvjz/v8DRghQzEc4kIgKwiAppcA9LtzKLSkdNhKFY3HF4lK69ExKslx7Xa+vPRVS43G98vG1DnkDMIBUgFN0MDXflU8tbaZOUkXUH0+U27RoRpOIyCKjbMCVejwypzJJG4jIwb43rfl6wbwanocrJm9XFYfskuVC5K/TPyczNU7b84CXcbxks1Un6H6tLH9vf2LRnn8Ax7A5WQAAAHicY2BkYGAA4teL1+yI57f5ysDNwgAC529f0kOmWRiYVgEpDgYmEA8AUzEKsQAAAHicY2BkYGB2+O/AEMPCAAJAkpEBFbAAADgKAe0EAAAiAAAAAAQAAAAEAAAAAAAAKgAqACoAiAAAeJxjYGRgYGBhsGFgYgABEMkFhAwM/xn0QAIAD6YBhwB4nI1Ty07cMBS9QwKlQapQW3VXySvEqDCZGbGaHULiIQ1FKgjWMxknMfLEke2A+IJu+wntrt/QbVf9gG75jK577Lg8K1qQPCfnnnt8fX1NRC/pmjrk/zprC+8D7tBy9DHgBXoWfQ44Av8t4Bj4Z8CLtBL9CniJluPXASf0Lm4CXqFX8Q84dOLnMB17N4c7tBo1AS/Qi+hTwBH4rwHHwN8DXqQ30XXAS7QaLwSc0Gn8NuAVWou/gFmnjLrEaEh9GmDdDGgL3B4JsrRPDU2hTOiMSuJUIdKQQayiAth69r6akSSFqIJuA19TrzCIaY8sIoxyrNIrL//pw7A2iMygkX5vDj+G+kuoLdX4GlGK/8Lnlz6/h9MpmoO9rafrz7ILXEHHaAx95s9lsI7AHNMBWEZHULnfAXwG9/ZqdzLI08iuwRloXE8kfhXYAvE23+23DU3t626rbs8/8adv+9DWknsHp3E17oCf+Z48rvEQNZ78paYM38qfk3v/u3l3u3GXN2Dmvmvpf1Srwk3pB/VSsp512bA/GG5i2WJ7wu430yQ5K3nFGiOqgtmSB5pJVSizwaacmUZzZhXLlZTq8qGGFY2YcSkqbth6aW1tRmlaCFs2016m5qn36SbJrqosG4uMV4aP2PHBmB3tjtmgN2izkGQyLWprekbIntJFing32a5rKWCN/SdSoga45EJykyQ7asZvHQ8PTm6cslIpwyeyjbVltNikc2HTR7YKh9LBl9DADC0U/jLcBZDKrMhUBfQBvXRzLtFtjU9eNHKin0x5InTqb8lNpfKv1s1xHzTXRqgKzek/mb7nB8RZTCDhGEX3kK/8Q75AmUM/eLkfA+0Hi908Kx4eNsMgudg5GLdRD7a84npi+YxNr5i5KIbW5izXas7cHXIMAau1OueZhfj+cOcP3P8MNIWLyYOBuxL6DRylJ4cAAAB4nGNgYoAALjDJyIAOWMCiTIxMLDmZedkABtIBygAAAA==) format('woff');
}



.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headeranchor-link {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .headeranchor-link:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .headeranchor,
.markdown-body h2 .headeranchor,
.markdown-body h3 .headeranchor,
.markdown-body h4 .headeranchor,
.markdown-body h5 .headeranchor,
.markdown-body h6 .headeranchor {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .headeranchor-link,
.markdown-body h2:hover .headeranchor-link,
.markdown-body h3:hover .headeranchor-link,
.markdown-body h4:hover .headeranchor-link,
.markdown-body h5:hover .headeranchor-link,
.markdown-body h6:hover .headeranchor-link {
  height: 1em;
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .headeranchor-link .headeranchor,
.markdown-body h2:hover .headeranchor-link .headeranchor,
.markdown-body h3:hover .headeranchor-link .headeranchor,
.markdown-body h4:hover .headeranchor-link .headeranchor,
.markdown-body h5:hover .headeranchor-link .headeranchor,
.markdown-body h6:hover .headeranchor-link .headeranchor {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* Multimarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\f05c';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><script type='text/javascript' src='Markdown_vi/lazyload.js'></script><style>/*github*/
.codehilite {background-color:#fff;color:#333333;}
.codehilite .hll {background-color:#ffffcc;}
.codehilite .c{color:#999988;font-style:italic}
.codehilite .err{color:#a61717;background-color:#e3d2d2}
.codehilite .k{font-weight:bold}
.codehilite .o{font-weight:bold}
.codehilite .cm{color:#999988;font-style:italic}
.codehilite .cp{color:#999999;font-weight:bold}
.codehilite .c1{color:#999988;font-style:italic}
.codehilite .cs{color:#999999;font-weight:bold;font-style:italic}
.codehilite .gd{color:#000000;background-color:#ffdddd}
.codehilite .ge{font-style:italic}
.codehilite .gr{color:#aa0000}
.codehilite .gh{color:#999999}
.codehilite .gi{color:#000000;background-color:#ddffdd}
.codehilite .go{color:#888888}
.codehilite .gp{color:#555555}
.codehilite .gs{font-weight:bold}
.codehilite .gu{color:#800080;font-weight:bold}
.codehilite .gt{color:#aa0000}
.codehilite .kc{font-weight:bold}
.codehilite .kd{font-weight:bold}
.codehilite .kn{font-weight:bold}
.codehilite .kp{font-weight:bold}
.codehilite .kr{font-weight:bold}
.codehilite .kt{color:#445588;font-weight:bold}
.codehilite .m{color:#009999}
.codehilite .s{color:#dd1144}
.codehilite .n{color:#333333}
.codehilite .na{color:teal}
.codehilite .nb{color:#0086b3}
.codehilite .nc{color:#445588;font-weight:bold}
.codehilite .no{color:teal}
.codehilite .ni{color:purple}
.codehilite .ne{color:#990000;font-weight:bold}
.codehilite .nf{color:#990000;font-weight:bold}
.codehilite .nn{color:#555555}
.codehilite .nt{color:navy}
.codehilite .nv{color:teal}
.codehilite .ow{font-weight:bold}
.codehilite .w{color:#bbbbbb}
.codehilite .mf{color:#009999}
.codehilite .mh{color:#009999}
.codehilite .mi{color:#009999}
.codehilite .mo{color:#009999}
.codehilite .sb{color:#dd1144}
.codehilite .sc{color:#dd1144}
.codehilite .sd{color:#dd1144}
.codehilite .s2{color:#dd1144}
.codehilite .se{color:#dd1144}
.codehilite .sh{color:#dd1144}
.codehilite .si{color:#dd1144}
.codehilite .sx{color:#dd1144}
.codehilite .sr{color:#009926}
.codehilite .s1{color:#dd1144}
.codehilite .ss{color:#990073}
.codehilite .bp{color:#999999}
.codehilite .vc{color:teal}
.codehilite .vg{color:teal}
.codehilite .vi{color:teal}
.codehilite .il{color:#009999}
.codehilite .gc{color:#999;background-color:#EAF2F5}
</style><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
MathJax.Hub.Config({
  config: ["MMLorHTML.js"],
  extensions: ["tex2jax.js"],
  jax: ["input/TeX"],
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
    processEscapes: false
  },
  TeX: {
    extensions: ["AMSmath.js", "AMSsymbols.js"],
    TagSide: "right",
    TagIndent: ".8em",
    MultLineWidth: "85%",
    equationNumbers: {
      autoNumber: "AMS",
    },
    unicode: {
      fonts: "STIXGeneral,'Arial Unicode MS'"
    }
  },
  showProcessingMessages: false
});
</script>
<script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.2/raphael-min.js"></script>
<script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
<script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.4/sequence-diagram-min.js"></script>
<script type="text/javascript">// flowchart, v1.3.4
// Copyright (c)2014 Adriano Raiano (adrai).
// Distributed under MIT license
// http://adrai.github.io/flowchart.js
!function(){function a(b,c){if(!b||"function"==typeof b)return c;var d={};for(var e in c)d[e]=c[e];for(e in b)b[e]&&(d[e]="object"==typeof d[e]?a(d[e],b[e]):b[e]);return d}function b(a,b){if("function"==typeof Object.create)a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});else{a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}}function c(a,b,c){var d,e,f="M{0},{1}";for(d=2,e=2*c.length+2;e>d;d+=2)f+=" L{"+d+"},{"+(d+1)+"}";var g=[b.x,b.y];for(d=0,e=c.length;e>d;d++)g.push(c[d].x),g.push(c[d].y);var h=a.paper.path(f,g);h.attr("stroke",a.options["element-color"]),h.attr("stroke-width",a.options["line-width"]);var i=a.options.font,j=a.options["font-family"],k=a.options["font-weight"];return i&&h.attr({font:i}),j&&h.attr({"font-family":j}),k&&h.attr({"font-weight":k}),h}function d(a,b,c,d){var e,f;"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);var g="M{0},{1}";for(e=2,f=2*c.length+2;f>e;e+=2)g+=" L{"+e+"},{"+(e+1)+"}";var h=[b.x,b.y];for(e=0,f=c.length;f>e;e++)h.push(c[e].x),h.push(c[e].y);var i=a.paper.path(g,h);i.attr({stroke:a.options["line-color"],"stroke-width":a.options["line-width"],"arrow-end":a.options["arrow-end"]});var j=a.options.font,k=a.options["font-family"],l=a.options["font-weight"];if(j&&i.attr({font:j}),k&&i.attr({"font-family":k}),l&&i.attr({"font-weight":l}),d){var m=!1,n=a.paper.text(0,0,d),o=!1,p=c[0];b.y===p.y&&(o=!0);var q=0,r=0;m?(q=b.x>p.x?b.x-(b.x-p.x)/2:p.x-(p.x-b.x)/2,r=b.y>p.y?b.y-(b.y-p.y)/2:p.y-(p.y-b.y)/2,o?(q-=n.getBBox().width/2,r-=a.options["text-margin"]):(q+=a.options["text-margin"],r-=n.getBBox().height/2)):(q=b.x,r=b.y,o?(q+=a.options["text-margin"]/2,r-=a.options["text-margin"]):(q+=a.options["text-margin"]/2,r+=a.options["text-margin"])),n.attr({"text-anchor":"start","font-size":a.options["font-size"],fill:a.options["font-color"],x:q,y:r}),j&&n.attr({font:j}),k&&n.attr({"font-family":k}),l&&n.attr({"font-weight":l})}return i}function e(a,b,c,d,e,f,g,h){var i,j,k,l,m,n={x:null,y:null,onLine1:!1,onLine2:!1};return i=(h-f)*(c-a)-(g-e)*(d-b),0===i?n:(j=b-f,k=a-e,l=(g-e)*j-(h-f)*k,m=(c-a)*j-(d-b)*k,j=l/i,k=m/i,n.x=a+j*(c-a),n.y=b+j*(d-b),j>0&&1>j&&(n.onLine1=!0),k>0&&1>k&&(n.onLine2=!0),n)}function f(a,b){b=b||{},this.paper=new Raphael(a),this.options=r.defaults(b,q),this.symbols=[],this.lines=[],this.start=null}function g(a,b,c){this.chart=a,this.group=this.chart.paper.set(),this.symbol=c,this.connectedTo=[],this.symbolType=b.symbolType,this.flowstate=b.flowstate||"future",this.next_direction=b.next&&b.direction_next?b.direction_next:void 0,this.text=this.chart.paper.text(0,0,b.text),b.key&&(this.text.node.id=b.key+"t"),this.text.node.setAttribute("class",this.getAttr("class")+"t"),this.text.attr({"text-anchor":"start",x:this.getAttr("text-margin"),fill:this.getAttr("font-color"),"font-size":this.getAttr("font-size")});var d=this.getAttr("font"),e=this.getAttr("font-family"),f=this.getAttr("font-weight");d&&this.text.attr({font:d}),e&&this.text.attr({"font-family":e}),f&&this.text.attr({"font-weight":f}),b.link&&this.text.attr("href",b.link),b.target&&this.text.attr("target",b.target);var g=this.getAttr("maxWidth");if(g){for(var h=b.text.split(" "),i="",j=0,k=h.length;k>j;j++){var l=h[j];this.text.attr("text",i+" "+l),i+=this.text.getBBox().width>g?"\n"+l:" "+l}this.text.attr("text",i.substring(1))}if(this.group.push(this.text),c){var m=this.getAttr("text-margin");c.attr({fill:this.getAttr("fill"),stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),width:this.text.getBBox().width+2*m,height:this.text.getBBox().height+2*m}),c.node.setAttribute("class",this.getAttr("class")),b.link&&c.attr("href",b.link),b.target&&c.attr("target",b.target),b.key&&(c.node.id=b.key),this.group.push(c),c.insertBefore(this.text),this.text.attr({y:c.getBBox().height/2}),this.initialize()}}function h(a,b){var c=a.paper.rect(0,0,0,0,20);b=b||{},b.text=b.text||"Start",g.call(this,a,b,c)}function i(a,b){var c=a.paper.rect(0,0,0,0,20);b=b||{},b.text=b.text||"End",g.call(this,a,b,c)}function j(a,b){var c=a.paper.rect(0,0,0,0);b=b||{},g.call(this,a,b,c)}function k(a,b){var c=a.paper.rect(0,0,0,0);b=b||{},g.call(this,a,b,c),c.attr({width:this.text.getBBox().width+4*this.getAttr("text-margin")}),this.text.attr({x:2*this.getAttr("text-margin")});var d=a.paper.rect(0,0,0,0);d.attr({x:this.getAttr("text-margin"),stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),width:this.text.getBBox().width+2*this.getAttr("text-margin"),height:this.text.getBBox().height+2*this.getAttr("text-margin"),fill:this.getAttr("fill")}),b.key&&(d.node.id=b.key+"i");var e=this.getAttr("font"),f=this.getAttr("font-family"),h=this.getAttr("font-weight");e&&d.attr({font:e}),f&&d.attr({"font-family":f}),h&&d.attr({"font-weight":h}),b.link&&d.attr("href",b.link),b.target&&d.attr("target",b.target),this.group.push(d),d.insertBefore(this.text),this.initialize()}function l(a,b){b=b||{},g.call(this,a,b),this.textMargin=this.getAttr("text-margin"),this.text.attr({x:3*this.textMargin});var d=this.text.getBBox().width+4*this.textMargin,e=this.text.getBBox().height+2*this.textMargin,f=this.textMargin,h=e/2,i={x:f,y:h},j=[{x:f-this.textMargin,y:e},{x:f-this.textMargin+d,y:e},{x:f-this.textMargin+d+2*this.textMargin,y:0},{x:f-this.textMargin+2*this.textMargin,y:0},{x:f,y:h}],k=c(a,i,j);k.attr({stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),fill:this.getAttr("fill")}),b.link&&k.attr("href",b.link),b.target&&k.attr("target",b.target),b.key&&(k.node.id=b.key),k.node.setAttribute("class",this.getAttr("class")),this.text.attr({y:k.getBBox().height/2}),this.group.push(k),k.insertBefore(this.text),this.initialize()}function m(a,b){b=b||{},g.call(this,a,b),this.textMargin=this.getAttr("text-margin"),this.yes_direction="bottom",this.no_direction="right",b.yes&&b.direction_yes&&b.no&&!b.direction_no?"right"===b.direction_yes?(this.no_direction="bottom",this.yes_direction="right"):(this.no_direction="right",this.yes_direction="bottom"):b.yes&&!b.direction_yes&&b.no&&b.direction_no?"right"===b.direction_no?(this.yes_direction="bottom",this.no_direction="right"):(this.yes_direction="right",this.no_direction="bottom"):(this.yes_direction="bottom",this.no_direction="right"),this.yes_direction=this.yes_direction||"bottom",this.no_direction=this.no_direction||"right",this.text.attr({x:2*this.textMargin});var d=this.text.getBBox().width+3*this.textMargin;d+=d/2;var e=this.text.getBBox().height+2*this.textMargin;e+=e/2,e=Math.max(.5*d,e);var f=d/4,h=e/4;this.text.attr({x:f+this.textMargin/2});var i={x:f,y:h},j=[{x:f-d/4,y:h+e/4},{x:f-d/4+d/2,y:h+e/4+e/2},{x:f-d/4+d,y:h+e/4},{x:f-d/4+d/2,y:h+e/4-e/2},{x:f-d/4,y:h+e/4}],k=c(a,i,j);k.attr({stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),fill:this.getAttr("fill")}),b.link&&k.attr("href",b.link),b.target&&k.attr("target",b.target),b.key&&(k.node.id=b.key),k.node.setAttribute("class",this.getAttr("class")),this.text.attr({y:k.getBBox().height/2}),this.group.push(k),k.insertBefore(this.text),this.initialize()}function n(a){function b(a){var b=a.indexOf("(")+1,c=a.indexOf(")");return b>=0&&c>=0?d.symbols[a.substring(0,b-1)]:d.symbols[a]}function c(a){var b="next",c=a.indexOf("(")+1,d=a.indexOf(")");return c>=0&&d>=0&&(b=D.substring(c,d),b.indexOf(",")<0&&"yes"!==b&&"no"!==b&&(b="next, "+b)),b}a=a||"",a=a.trim();for(var d={symbols:{},start:null,drawSVG:function(a,b){function c(a){if(g[a.key])return g[a.key];switch(a.symbolType){case"start":g[a.key]=new h(e,a);break;case"end":g[a.key]=new i(e,a);break;case"operation":g[a.key]=new j(e,a);break;case"inputoutput":g[a.key]=new l(e,a);break;case"subroutine":g[a.key]=new k(e,a);break;case"condition":g[a.key]=new m(e,a);break;default:return new Error("Wrong symbol type!")}return g[a.key]}var d=this;this.diagram&&this.diagram.clean();var e=new f(a,b);this.diagram=e;var g={};!function n(a,b,f){var g=c(a);return d.start===a?e.startWith(g):b&&f&&!b.pathOk&&(b instanceof m?(f.yes===a&&b.yes(g),f.no===a&&b.no(g)):b.then(g)),g.pathOk?g:(g instanceof m?(a.yes&&n(a.yes,g,a),a.no&&n(a.no,g,a)):a.next&&n(a.next,g,a),g)}(this.start),e.render()},clean:function(){this.diagram.clean()}},e=[],g=0,n=1,o=a.length;o>n;n++)if("\n"===a[n]&&"\\"!==a[n-1]){var p=a.substring(g,n);g=n+1,e.push(p.replace(/\\\n/g,"\n"))}g<a.length&&e.push(a.substr(g));for(var q=1,r=e.length;r>q;){var s=e[q];s.indexOf(": ")<0&&s.indexOf("(")<0&&s.indexOf(")")<0&&s.indexOf("->")<0&&s.indexOf("=>")<0?(e[q-1]+="\n"+s,e.splice(q,1),r--):q++}for(;e.length>0;){var t=e.splice(0,1)[0];if(t.indexOf("=>")>=0){var u,v=t.split("=>"),w={key:v[0],symbolType:v[1],text:null,link:null,target:null,flowstate:null};if(w.symbolType.indexOf(": ")>=0&&(u=w.symbolType.split(": "),w.symbolType=u[0],w.text=u[1]),w.text&&w.text.indexOf(":>")>=0?(u=w.text.split(":>"),w.text=u[0],w.link=u[1]):w.symbolType.indexOf(":>")>=0&&(u=w.symbolType.split(":>"),w.symbolType=u[0],w.link=u[1]),w.symbolType.indexOf("\n")>=0&&(w.symbolType=w.symbolType.split("\n")[0]),w.link){var x=w.link.indexOf("[")+1,y=w.link.indexOf("]");x>=0&&y>=0&&(w.target=w.link.substring(x,y),w.link=w.link.substring(0,x-1))}if(w.text&&w.text.indexOf("|")>=0){var z=w.text.split("|");w.text=z[0],w.flowstate=z[1].trim()}d.symbols[w.key]=w}else if(t.indexOf("->")>=0)for(var A=t.split("->"),B=0,C=A.length;C>B;B++){var D=A[B],E=b(D),F=c(D),G=null;if(F.indexOf(",")>=0){var H=F.split(",");F=H[0],G=H[1].trim()}if(d.start||(d.start=E),C>B+1){var I=A[B+1];E[F]=b(I),E["direction_"+F]=G,G=null}}}return d}Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!==d&&1/0!=d&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=c;arguments.length>1&&(d=Number(arguments[1]),d!=d?d=0:0!==d&&d!=1/0&&d!=-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d))));for(var e=d>=0?Math.min(d,c-1):c-Math.abs(d);e>=0;e--)if(e in b&&b[e]===a)return e;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var o=this,p={};"undefined"!=typeof module&&module.exports?module.exports=p:o.flowchart=o.flowchart||p;var q={x:0,y:0,"line-width":3,"line-length":50,"text-margin":10,"font-size":14,"font-color":"black","line-color":"black","element-color":"black",fill:"white","yes-text":"yes","no-text":"no","arrow-end":"block","class":"flowchart",symbols:{start:{},end:{},condition:{},inputoutput:{},operation:{},subroutine:{}}},r={defaults:a,inherits:b};f.prototype.handle=function(a){this.symbols.indexOf(a)<=-1&&this.symbols.push(a);var b=this;return a instanceof m?(a.yes=function(c){return a.yes_symbol=c,a.no_symbol&&(a.pathOk=!0),b.handle(c)},a.no=function(c){return a.no_symbol=c,a.yes_symbol&&(a.pathOk=!0),b.handle(c)}):a.then=function(c){return a.next=c,a.pathOk=!0,b.handle(c)},a},f.prototype.startWith=function(a){return this.start=a,this.handle(a)},f.prototype.render=function(){var a,b=0,c=0,d=0,e=0,f=0,g=0;for(d=0,e=this.symbols.length;e>d;d++)a=this.symbols[d],a.width>b&&(b=a.width),a.height>c&&(c=a.height);for(d=0,e=this.symbols.length;e>d;d++)a=this.symbols[d],a.shiftX(this.options.x+(b-a.width)/2+this.options["line-width"]),a.shiftY(this.options.y+(c-a.height)/2+this.options["line-width"]);for(this.start.render(),d=0,e=this.symbols.length;e>d;d++)a=this.symbols[d],a.renderLines();for(f=this.maxXFromLine,d=0,e=this.symbols.length;e>d;d++){a=this.symbols[d];var h=a.getX()+a.width,i=a.getY()+a.height;h>f&&(f=h),i>g&&(g=i)}this.paper.setSize(f+this.options["line-width"],g+this.options["line-width"])},f.prototype.clean=function(){if(this.paper){var a=this.paper.canvas;a.parentNode.removeChild(a)}},g.prototype.getAttr=function(a){if(!this.chart)return void 0;var b,c=this.chart.options?this.chart.options[a]:void 0,d=this.chart.options.symbols?this.chart.options.symbols[this.symbolType][a]:void 0;return this.chart.options.flowstate&&this.chart.options.flowstate[this.flowstate]&&(b=this.chart.options.flowstate[this.flowstate][a]),b||d||c},g.prototype.initialize=function(){this.group.transform("t"+this.getAttr("line-width")+","+this.getAttr("line-width")),this.width=this.group.getBBox().width,this.height=this.group.getBBox().height},g.prototype.getCenter=function(){return{x:this.getX()+this.width/2,y:this.getY()+this.height/2}},g.prototype.getX=function(){return this.group.getBBox().x},g.prototype.getY=function(){return this.group.getBBox().y},g.prototype.shiftX=function(a){this.group.transform("t"+(this.getX()+a)+","+this.getY())},g.prototype.setX=function(a){this.group.transform("t"+a+","+this.getY())},g.prototype.shiftY=function(a){this.group.transform("t"+this.getX()+","+(this.getY()+a))},g.prototype.setY=function(a){this.group.transform("t"+this.getX()+","+a)},g.prototype.getTop=function(){var a=this.getY(),b=this.getX()+this.width/2;return{x:b,y:a}},g.prototype.getBottom=function(){var a=this.getY()+this.height,b=this.getX()+this.width/2;return{x:b,y:a}},g.prototype.getLeft=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX();return{x:b,y:a}},g.prototype.getRight=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.group.getBBox().width;return{x:b,y:a}},g.prototype.render=function(){if(this.next){var a=this.getAttr("line-length");if("right"===this.next_direction){var b=this.getRight();if(this.next.getLeft(),!this.next.isPositioned){this.next.setY(b.y-this.next.height/2),this.next.shiftX(this.group.getBBox().x+this.width+a);var c=this;!function e(){for(var b,d=!1,f=0,g=c.chart.symbols.length;g>f;f++){b=c.chart.symbols[f];var h=Math.abs(b.getCenter().x-c.next.getCenter().x);if(b.getCenter().y>c.next.getCenter().y&&h<=c.next.width/2){d=!0;break}}d&&(c.next.setX(b.getX()+b.width+a),e())}(),this.next.isPositioned=!0,this.next.render()}}else{var d=this.getBottom();this.next.getTop(),this.next.isPositioned||(this.next.shiftY(this.getY()+this.height+a),this.next.setX(d.x-this.next.width/2),this.next.isPositioned=!0,this.next.render())}}},g.prototype.renderLines=function(){this.next&&(this.next_direction?this.drawLineTo(this.next,"",this.next_direction):this.drawLineTo(this.next))},g.prototype.drawLineTo=function(a,b,c){this.connectedTo.indexOf(a)<0&&this.connectedTo.push(a);var f,g=this.getCenter().x,h=this.getCenter().y,i=(this.getTop(),this.getRight()),j=this.getBottom(),k=this.getLeft(),l=a.getCenter().x,m=a.getCenter().y,n=a.getTop(),o=a.getRight(),p=(a.getBottom(),a.getLeft()),q=g===l,r=h===m,s=m>h,t=h>m,u=g>l,v=l>g,w=0,x=this.getAttr("line-length"),y=this.getAttr("line-width");if(c&&"bottom"!==c||!q||!s)if(c&&"right"!==c||!r||!v)if(c&&"left"!==c||!r||!u)if(c&&"right"!==c||!q||!t)if(c&&"right"!==c||!q||!s)if(c&&"bottom"!==c||!u)if(c&&"bottom"!==c||!v)if(c&&"right"===c&&u)f=d(this.chart,i,[{x:i.x+x/2,y:i.y},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else if(c&&"right"===c&&v)f=d(this.chart,i,[{x:n.x,y:i.y},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else if(c&&"bottom"===c&&q&&t)f=d(this.chart,j,[{x:j.x,y:j.y+x/2},{x:i.x+x/2,y:j.y+x/2},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.bottomStart=!0,a.topEnd=!0,w=j.x+x/2;else if("left"===c&&q&&t){var z=k.x-x/2;p.x<k.x&&(z=p.x-x/2),f=d(this.chart,k,[{x:z,y:k.y},{x:z,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.leftStart=!0,a.topEnd=!0,w=k.x}else"left"===c&&(f=d(this.chart,k,[{x:n.x+(k.x-n.x)/2,y:k.y},{x:n.x+(k.x-n.x)/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.leftStart=!0,a.topEnd=!0,w=k.x);else f=d(this.chart,j,[{x:j.x,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.bottomStart=!0,a.topEnd=!0,w=j.x+(j.x-n.x)/2;else f=this.leftEnd&&t?d(this.chart,j,[{x:j.x,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b):d(this.chart,j,[{x:j.x,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.bottomStart=!0,a.topEnd=!0,w=j.x+(j.x-n.x)/2;else f=d(this.chart,i,[{x:i.x+x/2,y:i.y},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else f=d(this.chart,i,[{x:i.x+x/2,y:i.y},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else f=d(this.chart,k,o,b),this.leftStart=!0,a.rightEnd=!0,w=o.x;else f=d(this.chart,i,p,b),this.rightStart=!0,a.leftEnd=!0,w=p.x;else f=d(this.chart,j,n,b),this.bottomStart=!0,a.topEnd=!0,w=j.x;if(f){for(var A=0,B=this.chart.lines.length;B>A;A++)for(var C,D=this.chart.lines[A],E=D.attr("path"),F=f.attr("path"),G=0,H=E.length-1;H>G;G++){var I=[];I.push(["M",E[G][1],E[G][2]]),I.push(["L",E[G+1][1],E[G+1][2]]);for(var J=I[0][1],K=I[0][2],L=I[1][1],M=I[1][2],N=0,O=F.length-1;O>N;N++){var P=[];P.push(["M",F[N][1],F[N][2]]),P.push(["L",F[N+1][1],F[N+1][2]]);var Q=P[0][1],R=P[0][2],S=P[1][1],T=P[1][2],U=e(J,K,L,M,Q,R,S,T);if(U.onLine1&&U.onLine2){var V;R===T?Q>S?(V=["L",U.x+2*y,R],F.splice(N+1,0,V),V=["C",U.x+2*y,R,U.x,R-4*y,U.x-2*y,R],F.splice(N+2,0,V),f.attr("path",F)):(V=["L",U.x-2*y,R],F.splice(N+1,0,V),V=["C",U.x-2*y,R,U.x,R-4*y,U.x+2*y,R],F.splice(N+2,0,V),f.attr("path",F)):R>T?(V=["L",Q,U.y+2*y],F.splice(N+1,0,V),V=["C",Q,U.y+2*y,Q+4*y,U.y,Q,U.y-2*y],F.splice(N+2,0,V),f.attr("path",F)):(V=["L",Q,U.y-2*y],F.splice(N+1,0,V),V=["C",Q,U.y-2*y,Q+4*y,U.y,Q,U.y+2*y],F.splice(N+2,0,V),f.attr("path",F)),N+=2,C+=2}}}this.chart.lines.push(f)}(!this.chart.maxXFromLine||this.chart.maxXFromLine&&w>this.chart.maxXFromLine)&&(this.chart.maxXFromLine=w)},r.inherits(h,g),r.inherits(i,g),r.inherits(j,g),r.inherits(k,g),r.inherits(l,g),l.prototype.getLeft=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.textMargin;return{x:b,y:a}},l.prototype.getRight=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.group.getBBox().width-this.textMargin;return{x:b,y:a}},r.inherits(m,g),m.prototype.render=function(){this.yes_direction&&(this[this.yes_direction+"_symbol"]=this.yes_symbol),this.no_direction&&(this[this.no_direction+"_symbol"]=this.no_symbol);var a=this.getAttr("line-length");if(this.bottom_symbol){var b=this.getBottom();this.bottom_symbol.getTop(),this.bottom_symbol.isPositioned||(this.bottom_symbol.shiftY(this.getY()+this.height+a),this.bottom_symbol.setX(b.x-this.bottom_symbol.width/2),this.bottom_symbol.isPositioned=!0,this.bottom_symbol.render())}if(this.right_symbol){var c=this.getRight();if(this.right_symbol.getLeft(),!this.right_symbol.isPositioned){this.right_symbol.setY(c.y-this.right_symbol.height/2),this.right_symbol.shiftX(this.group.getBBox().x+this.width+a);var d=this;!function e(){for(var b,c=!1,f=0,g=d.chart.symbols.length;g>f;f++){b=d.chart.symbols[f];var h=Math.abs(b.getCenter().x-d.right_symbol.getCenter().x);if(b.getCenter().y>d.right_symbol.getCenter().y&&h<=d.right_symbol.width/2){c=!0;break}}c&&(d.right_symbol.setX(b.getX()+b.width+a),e())}(),this.right_symbol.isPositioned=!0,this.right_symbol.render()}}},m.prototype.renderLines=function(){this.yes_symbol&&this.drawLineTo(this.yes_symbol,this.getAttr("yes-text"),this.yes_direction),this.no_symbol&&this.drawLineTo(this.no_symbol,this.getAttr("no-text"),this.no_direction)},p.parse=n}();
</script>
<script type="text/javascript">
(function (win, doc) {
  function onReady(fn) {
    if (doc.addEventListener) {
      doc.addEventListener('DOMContentLoaded', fn);
    } else {
      doc.attachEvent('onreadystatechange', function() {
        if (doc.readyState === 'interactive')
          fn();
      });
    }
  }

  win.convertUML = function(className, converter, settings) {
    var charts = doc.querySelectorAll("pre." + className),
        arr = [],
        i, j, maxItem, diagaram, text, curNode;

    // Is there a settings object?
    if (settings === void 0) {
        settings = {};
    }

    // Make sure we are dealing with an array
    for(i = 0, maxItem = charts.length; i < maxItem; i++) arr.push(charts[i])

    // Find the UML source element and get the text
    for (i = 0, maxItem = arr.length; i < maxItem; i++) {
        childEl = arr[i].firstChild;
        parentEl = childEl.parentNode;
        text = "";
        for (j = 0; j < childEl.childNodes.length; j++) {
            curNode = childEl.childNodes[j];
            whitespace = /^\s*$/;
            if (curNode.nodeName === "#text" && !(whitespace.test(curNode.nodeValue))) {
                text = curNode.nodeValue;
                break;
            }
        }

        // Do UML conversion and replace source
        el = doc.createElement('div');
        el.className = className;
        parentEl.parentNode.insertBefore(el, parentEl);
        parentEl.parentNode.removeChild(parentEl);
        diagram = converter.parse(text);
        diagram.drawSVG(el, settings);
    }
  }

  onReady(function(){convertUML('uml-flowchart', flowchart);});
  onReady(function(){convertUML('uml-sequence-diagram', Diagram, {theme: 'simple'});});
})(window, document)
</script>
<title>IOT</title></head><body><div class="to"></div><article class="markdown-body"><div class="toc">
<ul>
<li><a href="#00">0.0 概况</a><ul>
<li><a href="#01-markdown">0.1 利其器之Markdown</a><ul>
<li><a href="#011">0.1.1 侧边栏</a></li>
</ul>
</li>
<li><a href="#02-sublime">0.2 利其器之Sublime</a><ul>
<li><a href="#021-snippet">0.2.1 添加 snippet</a></li>
</ul>
</li>
<li><a href="#03-autohotkey">0.3 AutoHotkey</a></li>
</ul>
</li>
<li><a href="#1">1 传感器 执行器</a><ul>
<li><a href="#11-arduino">1.1 Arduino传感器模块示例</a><ul>
<li><a href="#111-ir">1.1.1 IR 模块</a></li>
<li><a href="#112">1.1.2 四位数显</a></li>
<li><a href="#113">1.1.3 超声波测距</a></li>
<li><a href="#114">1.1.4 温度湿度</a></li>
<li><a href="#115">1.1.5 模拟控制器</a></li>
<li><a href="#116">1.1.6 有源蜂鸣器</a></li>
<li><a href="#117">1.1.7 亮度传感器</a></li>
<li><a href="#118-led">1.1.8 彩色LED</a></li>
<li><a href="#119">1.1.9 个位数显</a></li>
<li><a href="#1110">1.1.10 滑动变阻器实现油门</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2-arduino">2 Arduino下位机</a><ul>
<li><a href="#21-arduino-arduinojson">2.1 Arduino 格式化数据 ArduinoJson</a><ul>
<li><a href="#211-encoding-json">2.1.1 Encoding JSON</a></li>
<li><a href="#212">2.1.2 示例</a></li>
<li><a href="#213">2.1.3 计算缓冲块大小</a></li>
<li><a href="#214">2.1.4 输入数据</a></li>
<li><a href="#215">2.1.5 代码整合</a></li>
<li><a href="#216">2.1.6 时间函数库</a></li>
<li><a href="#217-arduino">2.1.7 改造并集成Arduino传感器</a></li>
</ul>
</li>
<li><a href="#22">2.2 集成多任务控制</a></li>
</ul>
</li>
<li><a href="#3">3 树莓派配置</a><ul>
<li><a href="#31">3.1 安装初始化</a><ul>
<li><a href="#311-wifi">3.1.1 WIFI</a></li>
<li><a href="#312">3.1.2 自动备份</a></li>
<li><a href="#313">3.1.3 远程屏幕登陆</a></li>
<li><a href="#314">3.1.4清理垃圾</a></li>
<li><a href="#315">3.1.5 开机运行</a></li>
<li><a href="#316">3.1.6 温度监控</a></li>
<li><a href="#317">3.1.7 中文</a></li>
</ul>
</li>
<li><a href="#32-arduino-ide">3.2 集成arduino IDE</a></li>
<li><a href="#33-ssh">3.3 远程SSH登录树莓派</a><ul>
<li><a href="#331-go">3.3.1 安装go语言环境</a></li>
<li><a href="#332">3.3.2 下载狗洞客户端并配置</a><ul>
<li><a href="#3321-raspbian">3.3.2.1 Raspbian</a></li>
<li><a href="#3322-vps">3.3.2.2 VPS</a></li>
</ul>
</li>
<li><a href="#333">3.3.3 添加开机自启动脚本</a><ul>
<li><a href="#3330">3.3.3.0 准备步骤</a></li>
<li><a href="#3331">3.3.3.1 命令行自动运行</a></li>
</ul>
</li>
<li><a href="#334-ftp">3.3.4 FTP</a></li>
<li><a href="#335">3.3.5 查看端口占用</a></li>
<li><a href="#336-nginx-web">3.3.6 Nginx web服务器</a></li>
<li><a href="#337-python-paramiko">3.3.7 python paramiko</a></li>
</ul>
</li>
<li><a href="#34-conda-python">3.4 Conda 管理 配置python环境</a><ul>
<li><a href="#341-miniconda-bundled-with-python-3">3.4.1 安装配置 Miniconda (bundled with Python 3)</a></li>
<li><a href="#342">3.4.2 参考命令</a><ul>
<li><a href="#3421">3.4.2.1 卸载</a></li>
<li><a href="#3422">3.4.2.2 常用命令</a></li>
</ul>
</li>
<li><a href="#343-python">3.4.3 python 库</a><ul>
<li><a href="#3431-simplejson">3.4.3.1 simplejson</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#35">3.5 云打印机</a></li>
</ul>
</li>
<li><a href="#_1">配置</a></li>
<li><a href="#4-raspberry-arduino">4 Raspberry 和 Arduino 串口通信</a><ul>
<li><a href="#41">4.1 配置协议</a></li>
<li><a href="#42-json">4.2 Json解码</a></li>
<li><a href="#43-mongodb">4.3 mongodb 数据库</a></li>
<li><a href="#44-django">4.4 Django 框架</a><ul>
<li><a href="#441">4.4.1 初始化</a></li>
<li><a href="#442">4.4.2 配置项目</a></li>
<li><a href="#443-app">4.4.3 App配置</a></li>
<li><a href="#444-restful-api">4.4.4 RESTful API</a></li>
<li><a href="#445-arduino">4.4.5 与Arduino对接</a></li>
<li><a href="#446-vps">4.4.6 与vps对接</a></li>
<li><a href="#447">4.4.7 图表</a></li>
<li><a href="#448">4.4.8 部署</a></li>
</ul>
</li>
<li><a href="#45-python-flask-restful-api">4.5 使用 Python 和 Flask 设计 RESTful API</a></li>
</ul>
</li>
<li><a href="#5-arduino">5 Arduino 四轴飞行器</a><ul>
<li><a href="#51-i2c">5.1 I2C通讯</a><ul>
<li><a href="#511-gy-80">5.1.1 GY-80 模块</a><ul>
<li><a href="#5111">5.1.1.1 集合库示例</a></li>
<li><a href="#5112">5.1.1.2 集合库使用说明</a></li>
</ul>
</li>
<li><a href="#512-mpu-6050">5.1.2 MPU-6050</a></li>
<li><a href="#512">5.1.2 地址冲突问题</a></li>
<li><a href="#513-multiwii">5.1.3 MultiWii</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#6-raspberry-arduino">6 Raspberry 和 Arduino 蓝牙通信</a><ul>
<li><a href="#61-pybluez">6.1 pybluez 库</a><ul>
<li><a href="#611">6.1.1 示例</a></li>
</ul>
</li>
<li><a href="#612">6.1.2代码</a></li>
<li><a href="#62-drone">6.2 连接Drone</a><ul>
<li><a href="#_2">两行可行方案</a></li>
</ul>
</li>
<li><a href="#63-pythonshell">6.3 Python运行外部shell命令</a><ul>
<li><a href="#631-subprocess">6.3.1 subprocess 库</a></li>
<li><a href="#632">6.3.2 超级管理员运行</a></li>
<li><a href="#633">6.3.3 蓝牙连接完整代码</a></li>
<li><a href="#634-python">6.3.4 注册为python自动后台运行服务</a></li>
</ul>
</li>
<li><a href="#64">6.4 交换数据</a><ul>
<li><a href="#641">6.4.1安装配置库文件</a></li>
<li><a href="#642">6.4.2 接收数据</a></li>
<li><a href="#643">6.4.3 发送数据</a></li>
<li><a href="#644">6.4.4 蓝牙数据嗅探</a></li>
<li><a href="#645">6.4.5 解锁</a></li>
<li><a href="#646">6.4.6 接收信息并显示为图像</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_3">集成串口通信和蓝牙通信</a></li>
<li><a href="#7-vps-web">7 VPS Web配置</a><ul>
<li><a href="#71">7.1 初始化配置</a></li>
<li><a href="#72-shadowsocks">7.2 ShadowSocks代理配置</a></li>
<li><a href="#73-openvpn">7.3 OpenVPN</a></li>
<li><a href="#74-nginx">7.4 nginx</a></li>
<li><a href="#75-https">7.5 https</a><ul>
<li><a href="#751-acmesh">7.5.1 安装 acme.sh并生成证书</a></li>
<li><a href="#752-copy-nginx">7.5.2 copy证书到 nginx</a></li>
<li><a href="#753-acmesh">7.5.3 更新证书 和 acme.sh</a></li>
<li><a href="#754-nginx">7.5.4 更新nginx</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#vps">自动化脚本Vps</a><ul>
<li><a href="#01">01</a></li>
<li><a href="#02">02</a></li>
<li><a href="#03">03</a></li>
</ul>
</li>
<li><a href="#8-raspbian-vps">8 Raspbian 和 VPS 站点通信</a></li>
<li><a href="#a-linux">附录A Linux 开机自动启动</a><ul>
<li><a href="#a1-rclocal">A.1 编辑 rc.local</a></li>
<li><a href="#a2">A.2 计划事务</a></li>
<li><a href="#a3">A.3 注册为服务</a></li>
<li><a href="#_4">完整实例</a></li>
<li><a href="#a4-shell">A.4 shell脚本</a></li>
<li><a href="#a5">A.5 登陆命令行时自动运行</a></li>
</ul>
</li>
<li><a href="#b-python">附录B Python</a><ul>
<li><a href="#b0-python">B.0 python学习笔记</a><ul>
<li><a href="#b01">B.0.1基础语法</a><ul>
<li><a href="#b011">B.0.1.1 输出</a></li>
<li><a href="#b012">B.0.1.2 输入</a></li>
<li><a href="#b013">B.0.1.3 数据类型</a><ul>
<li><a href="#b0131">B.0.1.3.1整数</a></li>
<li><a href="#b0132">B.0.1.3.2 浮点数/小数</a></li>
<li><a href="#b0133">B.0.1.3.3 字符串</a></li>
<li><a href="#b0134">B.0.1.3.4布尔值</a></li>
<li><a href="#b0135">B.0.1.3.5 空值</a></li>
<li><a href="#b0136-list">B.0.1.3.6 列表 list</a></li>
<li><a href="#b0137-dict">B.0.1.3.7 字典 dict</a></li>
<li><a href="#b0138-set">B.0.1.3.8 Set  无序和无重复元素的集合</a></li>
<li><a href="#b0139">B.0.1.3.9  不可变对象</a></li>
<li><a href="#b01310-tuple">B.0.1.3.10 tuple</a></li>
<li><a href="#b01311">B.0.1.3.11 变量</a></li>
<li><a href="#b01312">B.0.1.3.12 常量</a></li>
</ul>
</li>
<li><a href="#b014">B.0.1.4 运算</a></li>
<li><a href="#b015">B.0.1.5 逻辑语句</a><ul>
<li><a href="#b0151-if">B.0.1.5.1 if语句</a></li>
<li><a href="#b0152">B.0.1.5.2循环</a><ul>
<li><a href="#b01521-forin">B.0.1.5.2.1  for&hellip;in</a></li>
<li><a href="#b01522-while">B.0.1.5.2.2 while 循环</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#b02">B.0.2 函数</a><ul>
<li><a href="#b021">B.0.2.1 定义</a></li>
<li><a href="#b022">B.0.2.2 调用</a></li>
<li><a href="#b023">B.0.2.3 参数</a><ul>
<li><a href="#b0231">B.0.2.3.1 位置参数</a></li>
<li><a href="#b0232">B.0.2.3.2 默认参数</a></li>
<li><a href="#b0233">B.0.2.3.3 可变参数</a></li>
<li><a href="#b0234">B.0.2.3.4 关键字参数</a></li>
<li><a href="#b0235">B.0.2.3.5 参数组合</a></li>
</ul>
</li>
<li><a href="#b024">B.0.2.4 递归</a></li>
</ul>
</li>
<li><a href="#b03">B.0.3 高级特性</a><ul>
<li><a href="#b031">B.0.3.1 切片</a></li>
<li><a href="#b032">B.0.3.2 迭代</a></li>
<li><a href="#b033">B.0.3.3 列表生成</a></li>
<li><a href="#b034">B.0.3.4 生成器</a></li>
</ul>
</li>
<li><a href="#b04-oop-object-oriented-design">B.0.4 OOP (object-oriented design)</a><ul>
<li><a href="#b041">B.0.4.1 创建类</a></li>
<li><a href="#b042">B.0.4.2 类属性</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="00"><a name="user-content-00" href="#00" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>0.0 概况</h1>
<pre class="uml-sequence-diagram"><code>Title: The structure of Projet IOT
Sensors--&gt;&gt;Actionneur:Co-existe
Actionneur-&gt;Arduino:①Interface Numerique&amp;Analogique
Sensors-&gt;Arduino:②Interface numerique&amp;analogique
Arduino-&gt;Raspberry: ③Interface série
Raspberry-&gt;Drone: ④Bluetooth
Raspberry-&gt;Web: ⑤TCP-IP
Web--&gt;Arduino: ⑥Commande
Web--&gt;Raspberry: ⑦Commande
Web-&gt;&gt;Wechat:⑧Mobile
</code></pre>

<pre class="uml-sequence-diagram"><code>Title: 模块结构树
传感器--&gt;&gt;执行器:并存
执行器-&gt;Arduino下位机:①数字模拟接口
传感器-&gt;Arduino下位机:②数字模拟接口
Arduino下位机-&gt;树莓派: ③串口通信
树莓派-&gt;四轴: ④蓝牙通信
树莓派-&gt;Web: ⑤Web通信
Web--&gt;Arduino下位机: ⑥执行命令
Web--&gt;树莓派: ⑦控制脚本
Web-&gt;&gt;微信:⑧移动端部署
</code></pre>

<p>控制流程图</p>
<pre class="uml-flowchart"><code>st=&gt;start: Start:&gt;http://gliang.eu[http://gliang.eu]
e=&gt;end:&gt;http://gliang.eu
op1=&gt;operation: 下位机传感器收集数据
op2=&gt;operation: 树莓派Django数据库收集并处理数据
op3=&gt;inputoutput: Web页面显示数据
op4=&gt;inputoutput: 微信小程序显示数据
op5=&gt;operation: 启动四轴飞行器
op6=&gt;inputoutput: 树莓派发送实时蓝牙控制命令
sub1=&gt;subroutine: 四轴飞行器降落并待命
cond=&gt;condition: Swich
单击动作'0'(需要去重复)
为奇数次:&gt;http://gliang.eu


st-&gt;op1-&gt;op2-&gt;op3-&gt;op4-&gt;cond
cond(yes)-&gt;op6-&gt;op5-&gt;e
cond(no)-&gt;sub1(right)-&gt;op1
</code></pre>

<h2 id="01-markdown"><a name="user-content-01-markdown" href="#01-markdown" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>0.1 利其器之Markdown</h2>
<h3 id="011"><a name="user-content-011" href="#011" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>0.1.1 侧边栏</h3>
<div class="admonition note">
<p class="admonition-title">手动修改步骤</p>
<p>1.删除body样式<br />
2.添加css样式</p>
<div class="codehilite"><pre><span class="nc">.tod</span> <span class="p">{</span>
  <span class="k">height</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span> <span class="c">/*目录框的高度*/</span>
  <span class="k">float</span><span class="o">:</span><span class="k">left</span><span class="p">;</span><span class="c">/*目录框的位置*/</span>
  <span class="k">overflow-y</span><span class="o">:</span><span class="k">scroll</span><span class="p">;</span><span class="c">/*目录框添加滚动条*/</span>
  <span class="k">padding-right</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="k">position</span><span class="o">:</span> <span class="k">fixed</span><span class="p">;</span><span class="c">/*目录框相对浏览器进行定位*/</span>
  <span class="k">width</span><span class="o">:</span><span class="m">36%</span><span class="p">;</span><span class="c">/*目录框的宽度*/</span>
  <span class="k">font-family</span><span class="o">:</span> <span class="k">sans-serif</span><span class="p">;</span>
  <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="k">text</span><span class="o">-</span><span class="k">size</span><span class="o">-</span><span class="n">adjust</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="k">text</span><span class="o">-</span><span class="k">size</span><span class="o">-</span><span class="n">adjust</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="k">color</span><span class="o">:</span> <span class="m">#333333</span><span class="p">;</span>
  <span class="k">font-family</span><span class="o">:</span> <span class="s2">&quot;Helvetica Neue&quot;</span><span class="o">,</span> <span class="n">Helvetica</span><span class="o">,</span> <span class="s2">&quot;Segoe UI&quot;</span><span class="o">,</span> <span class="n">Arial</span><span class="o">,</span> <span class="n">freesans</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
  <span class="k">font-size</span><span class="o">:</span> <span class="m">16px</span><span class="p">;</span>
  <span class="k">line-height</span><span class="o">:</span> <span class="m">1</span><span class="o">.</span><span class="m">6</span><span class="p">;</span>
  <span class="n">word</span><span class="o">-</span><span class="n">wrap</span><span class="o">:</span> <span class="n">break</span><span class="o">-</span><span class="n">word</span><span class="p">;</span>
  <span class="k">text-decoration</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
    <span class="p">}</span>
<span class="nt">A</span> <span class="p">{</span> <span class="k">text-decoration</span><span class="o">:</span> <span class="k">none</span><span class="p">}</span> 
<span class="nt">A</span><span class="nd">:hover</span> <span class="p">{</span> <span class="k">text-decoration</span><span class="o">:</span><span class="k">underline</span><span class="p">;}</span> 

<span class="nc">.markdown-body</span> <span class="p">{</span>
  <span class="k">font-family</span><span class="o">:</span> <span class="k">sans-serif</span><span class="p">;</span>
  <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="k">text</span><span class="o">-</span><span class="k">size</span><span class="o">-</span><span class="n">adjust</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="k">text</span><span class="o">-</span><span class="k">size</span><span class="o">-</span><span class="n">adjust</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="k">color</span><span class="o">:</span> <span class="m">#333333</span><span class="p">;</span>
  <span class="k">overflow</span><span class="o">:</span> <span class="k">hidden</span><span class="p">;</span>
  <span class="k">font-family</span><span class="o">:</span> <span class="s2">&quot;Helvetica Neue&quot;</span><span class="o">,</span> <span class="n">Helvetica</span><span class="o">,</span> <span class="s2">&quot;Segoe UI&quot;</span><span class="o">,</span> <span class="n">Arial</span><span class="o">,</span> <span class="n">freesans</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
  <span class="k">font-size</span><span class="o">:</span> <span class="m">16px</span><span class="p">;</span>
  <span class="k">line-height</span><span class="o">:</span> <span class="m">1</span><span class="o">.</span><span class="m">6</span><span class="p">;</span>
  <span class="n">word</span><span class="o">-</span><span class="n">wrap</span><span class="o">:</span> <span class="n">break</span><span class="o">-</span><span class="n">word</span><span class="p">;</span>
  <span class="k">margin</span><span class="o">:</span> <span class="m">16px</span> <span class="k">auto</span><span class="p">;</span>
  <span class="k">max-width</span><span class="o">:</span> <span class="m">980px</span><span class="p">;</span>
  <span class="k">outline</span><span class="o">:</span> <span class="m">1300px</span> <span class="k">solid</span> <span class="m">#fff</span><span class="p">;</span>

    <span class="k">float</span><span class="o">:</span><span class="k">right</span><span class="p">;</span><span class="c">/*正文的位置*/</span>
    <span class="k">padding-left</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span><span class="c">/*边距*/</span>
    <span class="k">width</span><span class="o">:</span><span class="m">60%</span><span class="p">;</span><span class="c">/*正文的宽度*/</span>
<span class="p">}</span>
</pre></div>


<p>3.修改html<br />
<div class="codehilite"><pre><span class="p">&lt;</span><span class="nt">h1</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;0-markdown</span>
<span class="err">&lt;/</span><span class="na">article</span><span class="p">&gt;</span>
</pre></div>
<br />
搜索并将以下代码放在以上位置之前 <br />
<div class="codehilite"><pre><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;right-div&quot;</span><span class="p">&gt;</span>
    这里是正文部分
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</p>
</div>
<div class="admonition note">
<p class="admonition-title">自动修改步骤</p>
</div>
<p>① pip install beautifulsoup4<br />
  ② os.getcwd()<br />
  ③ 代码如下<br />
  <div class="codehilite"><pre><span class="c1"># -*- coding: utf-8 -*- </span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&quot;index.html&quot;</span><span class="p">)</span> <span class="p">:</span>
  <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;index.html&quot;</span><span class="p">)</span>
<span class="n">html</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;in.html&#39;</span><span class="p">,</span><span class="s">&quot;r+&quot;</span><span class="p">)</span>

<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s">&quot;html5lib&quot;</span><span class="p">)</span>
<span class="c1">#Rename</span>
<span class="n">divto</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;div&quot;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&quot;to&quot;</span><span class="p">)</span>
<span class="n">divtoc</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;div&quot;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&quot;toc&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">divto</span>
<span class="k">if</span> <span class="n">divto</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">divto</span><span class="o">!=</span><span class="s">&quot;&quot;</span><span class="p">:</span> 
    <span class="n">divto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">divtoc</span><span class="p">)</span>
<span class="n">divto</span><span class="o">.</span><span class="n">div</span><span class="p">[</span><span class="s">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;tod&#39;</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">prettify</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span>

<span class="n">keyword</span><span class="o">=</span><span class="s">&quot;outline: 1300px solid #fff;&quot;</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
<span class="k">if</span> <span class="n">post</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="p">[:</span><span class="n">post</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">keyword</span><span class="p">)]</span><span class="o">+</span><span class="s">&quot;float:right;padding-left:10px;width:60%;&quot;</span><span class="o">+</span><span class="n">html</span><span class="p">[</span><span class="n">post</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">keyword</span><span class="p">):]</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;index.html&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">(</span> <span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;in.html&quot;</span><span class="p">)</span>
</pre></div>
</p>
<h2 id="02-sublime"><a name="user-content-02-sublime" href="#02-sublime" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>0.2 利其器之Sublime</h2>
<h3 id="021-snippet"><a name="user-content-021-snippet" href="#021-snippet" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>0.2.1 添加 snippet</h3>
<div class="codehilite"><pre><span class="p">&lt;</span><span class="nt">snippet</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">content</span><span class="p">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">|${1:this}|${2}| </span>
<span class="cp">| ------------- |:---------------:| </span>
<span class="cp">|${3}|${4}| </span>
<span class="cp">|${5}|${6}|</span>
<span class="cp">]]&gt;</span><span class="p">&lt;/</span><span class="nt">content</span><span class="p">&gt;</span>
  <span class="c">&lt;!-- Optional: Set a tabTrigger to define how to trigger the snippet --&gt;</span>
   <span class="p">&lt;</span><span class="nt">tabTrigger</span><span class="p">&gt;</span>mt<span class="p">&lt;/</span><span class="nt">tabTrigger</span><span class="p">&gt;</span> 
  <span class="c">&lt;!-- Optional: Set a scope to limit where the snippet will trigger --&gt;</span>
  <span class="c">&lt;!-- &lt;scope&gt;source.python&lt;/scope&gt; --&gt;</span>
   <span class="p">&lt;</span><span class="nt">description</span><span class="p">&gt;</span>Markdown-table<span class="p">&lt;/</span><span class="nt">description</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">snippet</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">snippet</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">content</span><span class="p">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">!!! ${1:hint}${2:Attention}${3:Caution}${4:Danger}${5:Question}${6:Note}${7:Unknown} &quot;${8}&quot;</span>
<span class="cp">    ${9:content}</span>
<span class="cp">]]&gt;</span><span class="p">&lt;/</span><span class="nt">content</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">tabTrigger</span><span class="p">&gt;</span>mb<span class="p">&lt;/</span><span class="nt">tabTrigger</span><span class="p">&gt;</span> 
   <span class="p">&lt;</span><span class="nt">description</span><span class="p">&gt;</span>Markdown-hint<span class="p">&lt;/</span><span class="nt">description</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">snippet</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">snippet</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">content</span><span class="p">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">- [${1:X}] ${2:Attention}</span>
<span class="cp">  * [${3:X}] ${4:Note}</span>
<span class="cp">      + [${5:X}] ${6:Note}</span>
<span class="cp">]]&gt;</span><span class="p">&lt;/</span><span class="nt">content</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">tabTrigger</span><span class="p">&gt;</span>mal<span class="p">&lt;/</span><span class="nt">tabTrigger</span><span class="p">&gt;</span> 
   <span class="p">&lt;</span><span class="nt">description</span><span class="p">&gt;</span>Markdownlist<span class="p">&lt;/</span><span class="nt">description</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">snippet</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">snippet</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">content</span><span class="p">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">波浪符号${2:python}</span>
<span class="cp">${1:Code here}</span>
<span class="cp">波浪符号</span>
<span class="cp">]]&gt;</span><span class="p">&lt;/</span><span class="nt">content</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">tabTrigger</span><span class="p">&gt;</span>mc<span class="p">&lt;/</span><span class="nt">tabTrigger</span><span class="p">&gt;</span> 
   <span class="p">&lt;</span><span class="nt">description</span><span class="p">&gt;</span>MarkdownCodes<span class="p">&lt;/</span><span class="nt">description</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">snippet</span><span class="p">&gt;</span>


<span class="p">&lt;</span><span class="nt">snippet</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">content</span><span class="p">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">$$${1:Formular here}^{${2:upper}}$$</span>
<span class="cp">]]&gt;</span><span class="p">&lt;/</span><span class="nt">content</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">tabTrigger</span><span class="p">&gt;</span>mf<span class="p">&lt;/</span><span class="nt">tabTrigger</span><span class="p">&gt;</span> 
   <span class="p">&lt;</span><span class="nt">description</span><span class="p">&gt;</span>MarkdownFormular<span class="p">&lt;/</span><span class="nt">description</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">snippet</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">snippet</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">content</span><span class="p">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">${51:指数} ^{$1} _{$3}</span>
<span class="cp">${54:偏微分} \partial f_{\mbox{$4}}</span>
<span class="cp">${55:分数} \frac{$5}{$6}</span>
<span class="cp">${57:根号} \sqrt[{7:次数}]{$8}</span>
<span class="cp">${59:累加} \sum_{$9=1}^$10</span>
<span class="cp">${511:积分} \int_$11^$12</span>
<span class="cp">\overline{$13}</span>
<span class="cp">\underline{$14}</span>
<span class="cp">${55:上花} \overbrace{$15}^{$16}</span>
<span class="cp">\underbrace{$17}_{$18}</span>
<span class="cp">\dot{$19}</span>
<span class="cp">\ddot{$20}</span>
<span class="cp">\vec{$21}</span>
<span class="cp">\left(${21:……}\right)</span>
<span class="cp">\in</span>
<span class="cp">\mathbb{R} </span>
<span class="cp">]]&gt;</span><span class="p">&lt;/</span><span class="nt">content</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">tabTrigger</span><span class="p">&gt;</span>mu<span class="p">&lt;/</span><span class="nt">tabTrigger</span><span class="p">&gt;</span> 
   <span class="p">&lt;</span><span class="nt">description</span><span class="p">&gt;</span>MarkdownFormular<span class="p">&lt;/</span><span class="nt">description</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">snippet</span><span class="p">&gt;</span>
</pre></div>


<h2 id="03-autohotkey"><a name="user-content-03-autohotkey" href="#03-autohotkey" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>0.3 AutoHotkey</h2>
<p>示例</p>
<div class="codehilite"><pre><span class="n">msgbox</span><span class="p">,</span> <span class="err">这是我的第一个</span><span class="n">AutoHotkey脚本</span> <span class="err">`</span><span class="n">n</span> <span class="err">我既关注效率，也尊重版权</span>
<span class="n">run</span><span class="p">,</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">xbeta</span><span class="o">.</span><span class="n">info</span><span class="o">/</span><span class="n">autohotkey</span><span class="o">-</span><span class="n">guide</span><span class="o">.</span><span class="n">htm</span>
</pre></div>


<p>;ClipSaved := ClipboardAll   ; 把剪贴板的所有内容保存到您选择的变量中.<br />
;Clipboard := ClipSaved   ; 恢复剪贴板为原来的内容. 注意这里使用 Clipboard (不是 ClipboardAll).<br />
;FileAppend, %ClipboardAll%, C:\Company Logo.clip ;<br />
;ClipSaved =   ; 在原来的剪贴板含大量内容时释放内存.</p>
<div class="codehilite"><pre><span class="c c-Singleline">;将本地图片插入Markdown</span>
<span class="o">^+</span><span class="n">c</span><span class="o">::</span><span class="c c-Singleline"> ;ctrl+shift+c</span>
<span class="nv">clipboard</span><span class="o">=</span><span class="c c-Singleline"> ;清空剪贴板</span>
<span class="nb">send</span><span class="p">,</span> <span class="o">^</span><span class="n">c</span>
<span class="nb">clipwait</span>
<span class="nv">clipboard</span> <span class="o">=</span> <span class="o">!</span><span class="p">[](</span><span class="nv">%clipboard%</span><span class="p">)</span>
<span class="nb">msgbox</span><span class="p">,</span> <span class="err">图片路径已复制！</span><span class="nv">%clipboard%</span>
<span class="nb">return</span>
</pre></div>


<div class="admonition hint">
<p class="admonition-title">保存格式</p>
<p>保存格式必须选为 UTF-8 with BOM！</p>
</div>
<hr />
<h1 id="1"><a name="user-content-1" href="#1" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1 传感器 执行器</h1>
<h2 id="11-arduino"><a name="user-content-11-arduino" href="#11-arduino" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1.1 Arduino传感器模块示例</h2>
<h3 id="111-ir"><a name="user-content-111-ir" href="#111-ir" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1.1.1 IR 模块</h3>
<div class="codehilite"><pre><span class="cp"># include &lt;IRremote.h&gt;</span>
<span class="cp"># include &lt;IRremoteInt.h&gt;</span>

<span class="kt">int</span> <span class="n">receiver</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span> <span class="c1">// Signal Pin of IR receiver to Arduino Digital Pin 13</span>

<span class="cm">/*-----( Declare objects )-----*/</span>
<span class="n">IRrecv</span> <span class="nf">irrecv</span><span class="p">(</span><span class="n">receiver</span><span class="p">);</span>     <span class="c1">// create instance of &#39;irrecv&#39;</span>
<span class="n">decode_results</span> <span class="n">results</span><span class="p">;</span>      <span class="c1">// create instance of &#39;decode_results&#39;1</span>

<span class="cm">/*-----( Function )-----*/</span>
<span class="kt">void</span> <span class="nf">translateIR</span><span class="p">()</span> <span class="c1">// takes action based on IR code received</span>

<span class="c1">// describing Remote IR codes</span>

<span class="p">{</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>

  <span class="p">{</span>
  <span class="k">case</span> <span class="mh">0xFFA25D</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;POWER&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFFE21D</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;FUNC/STOP&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF629D</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;VOL+&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF22DD</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;FAST BACK&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF02FD</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;PAUSE&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFFC23D</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;FAST FORWARD&quot;</span><span class="p">);</span>   <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFFE01F</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;DOWN&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFFA857</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;VOL-&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF906F</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;UP&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF9867</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;EQ&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFFB04F</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;ST/REPT&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF6897</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF30CF</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF18E7</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;2&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF7A85</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;3&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF10EF</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;4&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF38C7</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;5&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF5AA5</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;6&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF42BD</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;7&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF4AB5</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;8&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFF52AD</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;9&quot;</span><span class="p">);</span>    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mh">0xFFFFFFFF</span><span class="o">:</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; REPEAT&quot;</span><span class="p">);</span><span class="k">break</span><span class="p">;</span>

  <span class="k">default</span><span class="o">:</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; other button   &quot;</span><span class="p">);</span>

  <span class="p">}</span><span class="c1">// End Case</span>

  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span> <span class="c1">// Do not get immediate repeat</span>


<span class="p">}</span> <span class="c1">//END translateIR</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>   <span class="cm">/*----( SETUP: RUNS ONCE )----*/</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;IR Receiver Button Decode&quot;</span><span class="p">);</span>
  <span class="n">irrecv</span><span class="p">.</span><span class="n">enableIRIn</span><span class="p">();</span> <span class="c1">// Start the receiver</span>

<span class="p">}</span><span class="cm">/*--(end setup )---*/</span>


<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>   <span class="cm">/*----( LOOP: RUNS CONSTANTLY )----*/</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">irrecv</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">results</span><span class="p">))</span> <span class="c1">// have we received an IR signal?</span>

  <span class="p">{</span>
    <span class="n">translateIR</span><span class="p">();</span>
    <span class="n">irrecv</span><span class="p">.</span><span class="n">resume</span><span class="p">();</span> <span class="c1">// receive the next value</span>
  <span class="p">}</span>
<span class="p">}</span><span class="cm">/* --(end main loop )-- */</span>
</pre></div>


<h3 id="112"><a name="user-content-112" href="#112" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1.1.2 四位数显</h3>
<div class="codehilite"><pre><span class="kt">int</span> <span class="n">latch</span><span class="o">=</span><span class="mi">9</span><span class="p">;</span>  <span class="c1">//74HC595  pin 9 STCP</span>
<span class="kt">int</span> <span class="n">clock</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span> <span class="c1">//74HC595  pin 10 SHCP</span>
<span class="kt">int</span> <span class="n">data</span><span class="o">=</span><span class="mi">8</span><span class="p">;</span>   <span class="c1">//74HC595  pin 8 DS</span>

<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table</span><span class="p">[]</span><span class="o">=</span>
<span class="p">{</span><span class="mh">0x3f</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="mh">0x5b</span><span class="p">,</span><span class="mh">0x4f</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x6d</span><span class="p">,</span><span class="mh">0x7d</span><span class="p">,</span><span class="mh">0x07</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">,</span><span class="mh">0x6f</span><span class="p">,</span><span class="mh">0xbf</span><span class="p">,</span><span class="mh">0x86</span><span class="p">,</span><span class="mh">0xdb</span><span class="p">,</span><span class="mh">0xcf</span><span class="p">,</span><span class="mh">0xe6</span><span class="p">,</span><span class="mh">0xed</span><span class="p">,</span><span class="mh">0xfd</span><span class="p">,</span><span class="mh">0x87</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xef</span><span class="p">};</span>

<span class="c1">//0x77,0x7c,0x39,0x5e,0x7b,0x71,0x3d</span>


<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">latch</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">clock</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">Display</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>

  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">latch</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
  <span class="n">shiftOut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">clock</span><span class="p">,</span><span class="n">MSBFIRST</span><span class="p">,</span><span class="n">table</span><span class="p">[</span><span class="n">num</span><span class="p">]);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">latch</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>

<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">11</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">13</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">14</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">17</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">18</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">19</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">Display</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<h3 id="113"><a name="user-content-113" href="#113" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1.1.3 超声波测距</h3>
<div class="codehilite"><pre><span class="cp"># include &lt;SR04.h&gt;</span>
<span class="cp"># define TRIG_PIN 12</span>
<span class="cp"># define ECHO_PIN 11</span>
<span class="n">SR04</span> <span class="n">sr04</span> <span class="o">=</span> <span class="n">SR04</span><span class="p">(</span><span class="n">ECHO_PIN</span><span class="p">,</span><span class="n">TRIG_PIN</span><span class="p">);</span>
<span class="kt">long</span> <span class="n">a</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
   <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">a</span><span class="o">=</span><span class="n">sr04</span><span class="p">.</span><span class="n">Distance</span><span class="p">();</span>
   <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
   <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;cm&quot;</span><span class="p">);</span>
   <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<h3 id="114"><a name="user-content-114" href="#114" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1.1.4 温度湿度</h3>
<div class="codehilite"><pre><span class="cp"># include &lt;SimpleDHT.h&gt;</span>

<span class="c1">// for DHT11,</span>
<span class="c1">//      VCC: 5V or 3V</span>
<span class="c1">//      GND: GND</span>
<span class="c1">//      DATA: 2</span>
<span class="kt">int</span> <span class="n">pinDHT11</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">SimpleDHT11</span> <span class="n">dht11</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// start working...</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;=================================&quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Sample DHT11...&quot;</span><span class="p">);</span>

  <span class="c1">// read with raw sample data.</span>
  <span class="n">byte</span> <span class="n">temperature</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">byte</span> <span class="n">humidity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">byte</span> <span class="n">data</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dht11</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">pinDHT11</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">temperature</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">humidity</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Read DHT11 failed&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Sample RAW Bits: &quot;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Sample OK: &quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">temperature</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot; ℃, &quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">humidity</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; %&quot;</span><span class="p">);</span>
    <span class="kt">int</span>
<span class="cm">/*</span>
<span class="cm">hu=data[0]*128+data[1]*64+data[2]*32+data[3]*16+data[4]*8+data[5]*4+data[6]*2+data[7];</span>
<span class="cm">  int te=data[16]*128+data[17]*64+data[18]*32+data[19]*16+data[20]*8+data[21]*4+data[22]*2+data[23];</span>
<span class="cm">  Serial.print(te);</span>
<span class="cm">  Serial.print(&#39; &#39;);</span>
<span class="cm">  Serial.print(hu);</span>
<span class="cm">  Serial.println(&quot;&quot;);*/</span>

  <span class="c1">// DHT11 sampling rate is 1HZ.</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<h3 id="115"><a name="user-content-115" href="#115" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1.1.5 模拟控制器</h3>
<div class="codehilite"><pre><span class="c1">// Arduino pin numbers</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">SW_pin</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// digital pin connected to switch output</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">X_pin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// analog pin connected to X output</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">Y_pin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// analog pin connected to Y output</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">SW_pin</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SW_pin</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Switch:  &quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">SW_pin</span><span class="p">));</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;X-axis: &quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="n">X_pin</span><span class="p">));</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Y-axis: &quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="n">Y_pin</span><span class="p">));</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<h3 id="116"><a name="user-content-116" href="#116" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1.1.6 有源蜂鸣器</h3>
<div class="codehilite"><pre><span class="kt">int</span> <span class="n">buzzer</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span><span class="c1">//the pin of the active buzzer</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
 <span class="n">pinMode</span><span class="p">(</span><span class="n">buzzer</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span><span class="c1">//initialize the buzzer pin as an output</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
 <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">i</span><span class="p">;</span>
 <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
 <span class="p">{</span>
   <span class="c1">//output an frequency</span>
   <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">80</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
   <span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">buzzer</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="c1">//wait for 1ms</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">buzzer</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="c1">//wait for 1ms</span>
    <span class="p">}</span>
    <span class="c1">//output another frequency</span>
     <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">buzzer</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
        <span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="c1">//wait for 2ms</span>
        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">buzzer</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
        <span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="c1">//wait for 2ms</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="117"><a name="user-content-117" href="#117" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1.1.7 亮度传感器</h3>
<div class="codehilite"><pre><span class="kt">int</span> <span class="n">lightPin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">reading</span>  <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">lightPin</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">reading</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<h3 id="118-led"><a name="user-content-118-led" href="#118-led" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1.1.8 彩色LED</h3>
<div class="codehilite"><pre><span class="c1">// Define Pins</span>
<span class="cp"># define BLUE 3</span>
<span class="cp"># define GREEN 5</span>
<span class="cp"># define RED 6</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">RED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">GREEN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">BLUE</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="n">digitalWrite</span><span class="p">(</span><span class="n">RED</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="n">digitalWrite</span><span class="p">(</span><span class="n">GREEN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
<span class="n">digitalWrite</span><span class="p">(</span><span class="n">BLUE</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// define variables</span>
<span class="kt">int</span> <span class="n">redValue</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">greenValue</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">blueValue</span><span class="p">;</span>

<span class="c1">// main loop</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
<span class="cp"># define delayTime 10 </span><span class="c1">// fading time between colors</span>

<span class="n">redValue</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="c1">// choose a value between 1 and 255 to change the color.</span>
<span class="n">greenValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">blueValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// this is unnecessary as we&#39;ve either turned on RED in SETUP</span>
<span class="c1">// or in the previous loop ... regardless, this turns RED off</span>
<span class="c1">// analogWrite(RED, 0);</span>
<span class="c1">// delay(1000);</span>

<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// fades out red bring green full when i=255</span>
<span class="p">{</span>
<span class="n">redValue</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">greenValue</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">// The following was reversed, counting in the wrong directions</span>
<span class="c1">// analogWrite(RED, 255 - redValue);</span>
<span class="c1">// analogWrite(GREEN, 255 - greenValue);</span>
<span class="n">analogWrite</span><span class="p">(</span><span class="n">RED</span><span class="p">,</span> <span class="n">redValue</span><span class="p">);</span>
<span class="n">analogWrite</span><span class="p">(</span><span class="n">GREEN</span><span class="p">,</span> <span class="n">greenValue</span><span class="p">);</span>
<span class="n">delay</span><span class="p">(</span><span class="n">delayTime</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">redValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">greenValue</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
<span class="n">blueValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// fades out green bring blue full when i=255</span>
<span class="p">{</span>
<span class="n">greenValue</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">blueValue</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">// The following was reversed, counting in the wrong directions</span>
<span class="c1">// analogWrite(GREEN, 255 - greenValue);</span>
<span class="c1">// analogWrite(BLUE, 255 - blueValue);</span>
<span class="n">analogWrite</span><span class="p">(</span><span class="n">GREEN</span><span class="p">,</span> <span class="n">greenValue</span><span class="p">);</span>
<span class="n">analogWrite</span><span class="p">(</span><span class="n">BLUE</span><span class="p">,</span> <span class="n">blueValue</span><span class="p">);</span>
<span class="n">delay</span><span class="p">(</span><span class="n">delayTime</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">redValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">greenValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">blueValue</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>

<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// fades out blue bring red full when i=255</span>
<span class="p">{</span>
<span class="c1">// The following code has been rearranged to match the other two similar sections</span>
<span class="n">blueValue</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">redValue</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">// The following was reversed, counting in the wrong directions</span>
<span class="c1">// analogWrite(BLUE, 255 - blueValue);</span>
<span class="c1">// analogWrite(RED, 255 - redValue);</span>
<span class="n">analogWrite</span><span class="p">(</span><span class="n">BLUE</span><span class="p">,</span> <span class="n">blueValue</span><span class="p">);</span>
<span class="n">analogWrite</span><span class="p">(</span><span class="n">RED</span><span class="p">,</span> <span class="n">redValue</span><span class="p">);</span>
<span class="n">delay</span><span class="p">(</span><span class="n">delayTime</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="119"><a name="user-content-119" href="#119" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1.1.9 个位数显</h3>
<div class="codehilite"><pre><span class="c1">// define the LED digit patterns, from 0 - 9</span>
<span class="c1">// 1 = LED on, 0 = LED off, in this order:</span>
<span class="c1">//                74HC595 pin     Q0,Q1,Q2,Q3,Q4,Q5,Q6,Q7</span>
<span class="c1">//                Mapping to      a,b,c,d,e,f,g of Seven-Segment LED</span>
<span class="n">byte</span> <span class="n">seven_seg_digits</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span>   <span class="p">{</span>
                            <span class="n">B11111100</span><span class="p">,</span>  <span class="c1">// = 0      0</span>
                            <span class="n">B01100000</span><span class="p">,</span>  <span class="c1">// = 1      1</span>
                            <span class="n">B11011010</span><span class="p">,</span>  <span class="c1">// = 2      2</span>
                            <span class="n">B11110010</span><span class="p">,</span>  <span class="c1">// = 3      3</span>
                            <span class="n">B01100110</span><span class="p">,</span>  <span class="c1">// = 4      4</span>
                            <span class="n">B10110110</span><span class="p">,</span>  <span class="c1">// = 5      5</span>
                            <span class="n">B10111110</span><span class="p">,</span>  <span class="c1">// = 6      6</span>
                            <span class="n">B11100000</span><span class="p">,</span>  <span class="c1">// = 7      7</span>
                            <span class="n">B11111110</span><span class="p">,</span>  <span class="c1">// = 8      8</span>
                            <span class="n">B11110110</span><span class="p">,</span>  <span class="c1">// = 9      9</span>
                            <span class="n">B00001110</span><span class="p">,</span>  <span class="c1">// = |-     10</span>
                            <span class="n">B01100010</span><span class="p">,</span>  <span class="c1">// = -|     11</span>
                            <span class="n">B10001100</span><span class="p">,</span>  <span class="c1">// = ┌     12</span>
                            <span class="n">B00011100</span><span class="p">,</span>  <span class="c1">// = └     13</span>
                            <span class="n">B10000000</span><span class="p">,</span>  <span class="c1">// = ┬     14</span>
                            <span class="n">B00010000</span><span class="p">,</span>  <span class="c1">// = ┴     15</span>
                            <span class="n">B11001110</span><span class="p">,</span>  <span class="c1">// = p      16</span>
                            <span class="n">B11001111</span><span class="p">,</span>  <span class="c1">// = p.     17</span>
                            <span class="n">B11100110</span><span class="p">,</span>  <span class="c1">// = q      18</span>
                            <span class="n">B11100111</span><span class="p">,</span>  <span class="c1">// = q.     19</span>
                            <span class="n">B10011110</span><span class="p">,</span>   <span class="c1">// = E     20</span>
                            <span class="n">B11100111</span><span class="p">,</span> <span class="c1">// = e    21</span>
                            <span class="n">B11111111</span>  <span class="c1">// = 8.   22</span>
                             <span class="p">};</span>

<span class="c1">// connect to the ST_CP of 74HC595 (pin 3,latch pin)</span>
<span class="kt">int</span> <span class="n">latchPin</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="c1">// connect to the SH_CP of 74HC595 (pin 4, clock pin)</span>
<span class="kt">int</span> <span class="n">clockPin</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="c1">// connect to the DS of 74HC595 (pin 2)</span>
<span class="kt">int</span> <span class="n">dataPin</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Set latchPin, clockPin, dataPin as output</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">latchPin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">clockPin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">dataPin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// display a number on the digital segment display</span>
<span class="kt">void</span> <span class="nf">sevenSegWrite</span><span class="p">(</span><span class="n">byte</span> <span class="n">digit</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// set the latchPin to low potential, before sending data</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">latchPin</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>

  <span class="c1">// the original data (bit pattern)</span>
  <span class="n">shiftOut</span><span class="p">(</span><span class="n">dataPin</span><span class="p">,</span> <span class="n">clockPin</span><span class="p">,</span> <span class="n">LSBFIRST</span><span class="p">,</span> <span class="n">seven_seg_digits</span><span class="p">[</span><span class="n">digit</span><span class="p">]);</span>

  <span class="c1">// set the latchPin to high potential, after sending data</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">latchPin</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// count from 22 to 0</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">byte</span> <span class="n">digit</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span> <span class="n">digit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">digit</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="n">sevenSegWrite</span><span class="p">(</span><span class="n">digit</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// suspend 4 seconds</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<h3 id="1110"><a name="user-content-1110" href="#1110" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1.1.10 滑动变阻器实现油门</h3>
<p>模拟信号读取</p>
<div class="codehilite"><pre><span class="kt">double</span> <span class="n">predata</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">readPin</span> <span class="o">=</span> <span class="n">A5</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">sensorValue</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// initialize serial communication at 9600 bits per second:</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>

<span class="p">}</span>

<span class="c1">// the loop routine runs over and over again forever:</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// read the input on analog pin 0:</span>
  <span class="n">sensorValue</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">readPin</span><span class="p">);</span>
    <span class="c1">// print out the value you read:</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">sensorValue</span> <span class="o">!=</span>  <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">sensorValue</span> <span class="o">&lt;</span> <span class="n">predata</span><span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">sensorValue</span> <span class="o">&gt;</span> <span class="n">predata</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">sensorValue</span><span class="p">);</span>
    <span class="n">predata</span> <span class="o">=</span> <span class="n">sensorValue</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>


<div class="admonition hint"></div>
<ul>
<li>接模拟量输入口</li>
<li>读取的是电压数值，数据取值范围是从0-1024</li>
</ul>
<hr />
<h1 id="2-arduino"><a name="user-content-2-arduino" href="#2-arduino" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2 Arduino下位机</h1>
<h2 id="21-arduino-arduinojson"><a name="user-content-21-arduino-arduinojson" href="#21-arduino-arduinojson" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2.1 Arduino 格式化数据 ArduinoJson</h2>
<h3 id="211-encoding-json"><a name="user-content-211-encoding-json" href="#211-encoding-json" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2.1.1 Encoding JSON</h3>
<p><div class="codehilite"><pre><span class="nt">graph</span> <span class="nt">TD</span><span class="o">;</span>
<span class="nt">A</span><span class="o">(</span><span class="nt">1</span><span class="nc">.Reserve</span> <span class="nt">memory</span> <span class="nt">space</span><span class="nd">:StaticJsonBuffer</span><span class="o">)</span><span class="nt">--</span><span class="o">&gt;</span><span class="nt">B</span><span class="o">(</span><span class="nt">2</span><span class="nc">.Build</span> <span class="nt">object</span> <span class="nt">tree</span> <span class="nt">in</span> <span class="nt">memory</span><span class="o">);</span>
<span class="nt">B--</span><span class="o">&gt;</span><span class="nt">C</span><span class="o">(</span><span class="nt">3</span><span class="nc">.Generate</span> <span class="nt">the</span> <span class="nt">JSON</span> <span class="nt">string</span><span class="o">);</span>
</pre></div>
<br />
<code>StaticJsonBuffer&lt;200&gt; jsonBuffer;</code></p>
<h3 id="212"><a name="user-content-212" href="#212" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2.1.2 示例</h3>
<div class="codehilite"><pre><span class="c1">// Copyright Benoit Blanchon 2014-2017</span>
<span class="c1">// MIT License</span>
<span class="c1">//</span>
<span class="c1">// Arduino JSON library</span>
<span class="c1">// https://bblanchon.github.io/ArduinoJson/</span>
<span class="c1">// If you like this project, please add a star!</span>

<span class="cp"># include &lt;ArduinoJson.h&gt;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">Serial</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// wait serial port initialization</span>
  <span class="p">}</span>

  <span class="c1">// Memory pool for JSON object tree.</span>
  <span class="c1">//</span>
  <span class="c1">// Inside the brackets, 200 is the size of the pool in bytes.</span>
  <span class="c1">// If the JSON object is more complex, you need to increase that value.</span>
  <span class="c1">// See https://bblanchon.github.io/ArduinoJson/assistant/</span>
  <span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="mi">200</span><span class="o">&gt;</span> <span class="n">jsonBuffer</span><span class="p">;</span>

  <span class="c1">// StaticJsonBuffer allocates memory on the stack, it can be</span>
  <span class="c1">// replaced by DynamicJsonBuffer which allocates in the heap.</span>
  <span class="c1">//DynamicJsonBuffer jsonBuffer;</span>

  <span class="c1">// Create the root of the object tree.</span>
  <span class="c1">//</span>
  <span class="c1">// It&#39;s a reference to the JsonObject, the actual bytes are inside the</span>
  <span class="c1">// JsonBuffer with all the other nodes of the object tree.</span>
  <span class="c1">// Memory is freed when jsonBuffer goes out of scope.</span>
  <span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">jsonBuffer</span><span class="p">.</span><span class="n">createObject</span><span class="p">();</span>

  <span class="c1">// Add values in the object</span>
  <span class="c1">//</span>
  <span class="c1">// Most of the time, you can rely on the implicit casts.</span>
  <span class="c1">// In other case, you can do root.set&lt;long&gt;(&quot;time&quot;, 1351824120);</span>
  <span class="n">root</span><span class="p">[</span><span class="s">&quot;sensor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;gps&quot;</span><span class="p">;</span>
  <span class="n">root</span><span class="p">[</span><span class="s">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1351824120</span><span class="p">;</span>

  <span class="c1">// Add a nested array.</span>
  <span class="c1">//</span>
  <span class="c1">// It&#39;s also possible to create the array separately and add it to the</span>
  <span class="c1">// JsonObject but it&#39;s less efficient.</span>
  <span class="n">JsonArray</span><span class="o">&amp;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">root</span><span class="p">.</span><span class="n">createNestedArray</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">);</span>
  <span class="n">data</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mf">48.756080</span><span class="p">);</span>
  <span class="n">data</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mf">2.302038</span><span class="p">);</span>

  <span class="n">root</span><span class="p">.</span><span class="n">printTo</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
  <span class="c1">// This prints:</span>
  <span class="c1">// {&quot;sensor&quot;:&quot;gps&quot;,&quot;time&quot;:1351824120,&quot;data&quot;:[48.756080,2.302038]}</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>

  <span class="n">root</span><span class="p">.</span><span class="n">prettyPrintTo</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
  <span class="c1">// This prints:</span>
  <span class="c1">// {</span>
  <span class="c1">//   &quot;sensor&quot;: &quot;gps&quot;,</span>
  <span class="c1">//   &quot;time&quot;: 1351824120,</span>
  <span class="c1">//   &quot;data&quot;: [</span>
  <span class="c1">//     48.756080,</span>
  <span class="c1">//     2.302038</span>
  <span class="c1">//   ]</span>
  <span class="c1">// }</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// not used in this example</span>
<span class="p">}</span>
</pre></div>


<h3 id="213"><a name="user-content-213" href="#213" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2.1.3 计算缓冲块大小</h3>
<div class="codehilite"><pre><span class="k">const</span> <span class="kt">int</span> <span class="n">BUFFER_SIZE1</span> <span class="o">=</span> <span class="n">JSON_OBJECT_SIZE</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">BUFFER_SIZE2</span> <span class="o">=</span> <span class="n">JSON_OBJECT_SIZE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">JSON_ARRAY_SIZE</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">BUFFER_SIZE1</span><span class="p">);</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">BUFFER_SIZE2</span><span class="p">);</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">BUFFER_SIZE</span> <span class="o">=</span> <span class="n">JSON_OBJECT_SIZE</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">JSON_ARRAY_SIZE</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="n">BUFFER_SIZE</span><span class="o">&gt;</span> <span class="n">jsonBuffer</span><span class="p">;</span>
</pre></div>


<h3 id="214"><a name="user-content-214" href="#214" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2.1.4 输入数据</h3>
<div class="codehilite"><pre>  <span class="n">String</span> <span class="n">input</span> <span class="o">=</span><span class="s">&quot;{</span><span class="se">\&quot;</span><span class="s">sensor</span><span class="se">\&quot;</span><span class="s">:</span><span class="se">\&quot;</span><span class="s">gps</span><span class="se">\&quot;</span><span class="s">,</span><span class="se">\&quot;</span><span class="s">time</span><span class="se">\&quot;</span><span class="s">:1351824120,</span><span class="se">\&quot;</span><span class="s">data</span><span class="se">\&quot;</span><span class="s">:[48.756080,2.302038]}&quot;</span><span class="p">;</span>
  <span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">jsonBuffer</span><span class="p">.</span><span class="n">parseObject</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
</pre></div>


<h3 id="215"><a name="user-content-215" href="#215" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2.1.5 代码整合</h3>
<div class="codehilite"><pre><span class="cp"># include &lt;ArduinoJson.h&gt;</span>

<span class="kt">void</span> <span class="nf">jsonBuffer</span><span class="p">(</span><span class="kt">long</span> <span class="n">ti</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ir</span><span class="p">,</span><span class="kt">int</span> <span class="n">di</span><span class="p">,</span> <span class="kt">int</span> <span class="n">te</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hu</span><span class="p">,</span> <span class="kt">int</span> <span class="n">li</span><span class="p">)</span> <span class="p">{</span>
<span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="mi">70</span><span class="o">&gt;</span> <span class="n">jsonBuffer</span><span class="p">;</span>
<span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">rootB</span> <span class="o">=</span> <span class="n">jsonBuffer</span><span class="p">.</span><span class="n">createObject</span><span class="p">();</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Time&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">ti</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;IR&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">ir</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">di</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Temperature&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">te</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Humity&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">hu</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Light&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">li</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">.</span><span class="n">prettyPrintTo</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">joyStick</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">){</span>
<span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="mi">40</span><span class="o">&gt;</span> <span class="n">joyStick</span><span class="p">;</span>
<span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">rootS</span> <span class="o">=</span> <span class="n">joyStick</span><span class="p">.</span><span class="n">createObject</span><span class="p">();</span>
<span class="n">JsonArray</span><span class="o">&amp;</span> <span class="n">Stick</span><span class="o">=</span> <span class="n">rootS</span><span class="p">.</span><span class="n">createNestedArray</span><span class="p">(</span><span class="s">&quot;Stick&quot;</span><span class="p">);</span>
<span class="n">Stick</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="n">Stick</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="n">rootS</span><span class="p">.</span><span class="n">prettyPrintTo</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// put your setup code here, to run once:</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">Serial</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">// wait serial port initialization</span>

<span class="n">jsonBuffer</span><span class="p">(</span><span class="mi">1351824120</span><span class="p">,</span><span class="mo">01</span><span class="p">,</span><span class="mi">311</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="mi">999</span><span class="p">);</span>
<span class="n">joyStick</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">999</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// put your main code here, to run repeatedly:</span>

<span class="p">}</span>
</pre></div>


<h3 id="216"><a name="user-content-216" href="#216" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2.1.6 时间函数库</h3>
<div class="codehilite"><pre><span class="cp"># include &lt;Time.h&gt;</span>
<span class="cp"># include &lt;TimeLib.h&gt;</span>

<span class="c1">//The functions available in the library include</span>
<span class="n">hour</span><span class="p">();</span>            <span class="c1">// the hour now  (0-23)</span>
<span class="n">minute</span><span class="p">();</span>          <span class="c1">// the minute now (0-59)</span>
<span class="n">second</span><span class="p">();</span>          <span class="c1">// the second now (0-59)</span>
<span class="n">day</span><span class="p">();</span>             <span class="c1">// the day now (1-31)</span>
<span class="n">weekday</span><span class="p">();</span>         <span class="c1">// day of the week (1-7), Sunday is day 1</span>
<span class="n">month</span><span class="p">();</span>           <span class="c1">// the month now (1-12)</span>
<span class="n">year</span><span class="p">();</span>            <span class="c1">// the full four digit year: (2009, 2010 etc)</span>

<span class="n">hourFormat12</span><span class="p">();</span>    <span class="c1">// the hour now in 12 hour format</span>
<span class="n">isAM</span><span class="p">();</span>            <span class="c1">// returns true if time now is AM</span>
<span class="n">isPM</span><span class="p">();</span>            <span class="c1">// returns true if time now is PM</span>

<span class="n">now</span><span class="p">();</span>             <span class="c1">// returns the current time as seconds since Jan 1 1970</span>


<span class="kt">time_t</span> <span class="n">t</span> <span class="o">=</span> <span class="n">now</span><span class="p">();</span> <span class="c1">// store the current time in time variable t</span>
<span class="n">hour</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>          <span class="c1">// returns the hour for the given time t</span>
<span class="n">minute</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>        <span class="c1">// returns the minute for the given time t</span>
<span class="n">second</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>        <span class="c1">// returns the second for the given time t</span>
<span class="n">day</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>           <span class="c1">// the day for the given time t</span>
<span class="n">weekday</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>       <span class="c1">// day of the week for the given time t</span>
<span class="n">month</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>         <span class="c1">// the month for the given time t</span>
<span class="n">year</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>          <span class="c1">// the year for the given time t</span>

<span class="n">setTime</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>                      <span class="c1">// set the system time to the give time t</span>
<span class="n">setTime</span><span class="p">(</span><span class="n">hr</span><span class="p">,</span><span class="n">min</span><span class="p">,</span><span class="n">sec</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">mnth</span><span class="p">,</span><span class="n">yr</span><span class="p">);</span> <span class="c1">// alternative to above, yr is 2 or 4 digit yr</span>
                                 <span class="c1">// (2010 or 10 sets year to 2010)</span>
<span class="n">adjustTime</span><span class="p">(</span><span class="n">adjustment</span><span class="p">);</span>          <span class="c1">// adjust system time by adding the adjustment value</span>
<span class="n">timeStatus</span><span class="p">();</span>                    <span class="c1">// indicates if time has been set and recently synchronized</span>
                                 <span class="c1">// returns one of the following enumerations:</span>
<span class="n">timeNotSet</span>                       <span class="c1">// the time has never been set, the clock started at Jan 1 1970</span>
<span class="n">timeNeedsSync</span>                    <span class="c1">// the time had been set but a sync attempt did not succeed</span>
<span class="n">timeSet</span>                          <span class="c1">// the time is set and is synced</span>
</pre></div>


<h3 id="217-arduino"><a name="user-content-217-arduino" href="#217-arduino" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2.1.7 改造并集成Arduino传感器</h3>
<div class="codehilite"><pre><span class="cp"># include &lt;Time.h&gt;</span>
<span class="cp"># include &lt;TimeLib.h&gt;</span>

<span class="cp"># include &lt;ArduinoJson.h&gt;</span>

<span class="cp"># include &lt;IRremote.h&gt;</span>
<span class="cp"># include &lt;IRremoteInt.h&gt;</span>

<span class="cp"># include &lt;SR04.h&gt;</span>
<span class="cp"># define TRIG_PIN 12</span>
<span class="cp"># define ECHO_PIN 11</span>
<span class="n">SR04</span> <span class="n">sr04</span> <span class="o">=</span> <span class="n">SR04</span><span class="p">(</span><span class="n">ECHO_PIN</span><span class="p">,</span><span class="n">TRIG_PIN</span><span class="p">);</span>

<span class="c1">//# include &lt;SimpleDHT.h&gt; int pinDHT11 = 2; SimpleDHT11 dht11;</span>
<span class="cp"># include &lt;DHT.h&gt;</span>
<span class="n">DHT</span> <span class="n">dht</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">lightPin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">SW_pin</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// digital pin connected to switch output</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">X_pin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// analog pin connected to X output</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">Y_pin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// analog pin connected to Y output</span>

<span class="cm">/*全局变量*/</span>
<span class="kt">long</span> <span class="n">ti</span><span class="o">=</span><span class="mi">1351824120</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">ir</span><span class="o">=</span><span class="mo">01</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">di</span><span class="o">=</span><span class="mi">311</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">te</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">hu</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">li</span><span class="o">=</span><span class="mi">999</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="mi">888</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">y</span><span class="o">=-</span><span class="mi">999</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>


<span class="cm">/*构建缓冲区并生成JSON*/</span>
<span class="kt">void</span> <span class="nf">jsonBuffer</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ti</span><span class="p">,</span> <span class="kt">int</span> <span class="n">di</span><span class="p">,</span> <span class="kt">int</span> <span class="n">te</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hu</span><span class="p">,</span> <span class="kt">int</span> <span class="n">li</span><span class="p">)</span> <span class="p">{</span>
<span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="mi">60</span><span class="o">&gt;</span> <span class="n">jsonBuffer</span><span class="p">;</span>
<span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">rootB</span> <span class="o">=</span> <span class="n">jsonBuffer</span><span class="p">.</span><span class="n">createObject</span><span class="p">();</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Time&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">ti</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">di</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Temperature&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">te</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Humity&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">hu</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Light&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">li</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">.</span><span class="n">prettyPrintTo</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">joyStick</span><span class="p">(</span><span class="kt">int</span> <span class="n">swich</span><span class="p">,</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">ir</span><span class="p">){</span>
<span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="mi">60</span><span class="o">&gt;</span> <span class="n">joyStick</span><span class="p">;</span>
<span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">rootS</span> <span class="o">=</span> <span class="n">joyStick</span><span class="p">.</span><span class="n">createObject</span><span class="p">();</span>
<span class="n">rootS</span><span class="p">[</span><span class="s">&quot;IR&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">ir</span><span class="p">;</span>
<span class="n">rootS</span><span class="p">[</span><span class="s">&quot;Swich&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">swich</span><span class="p">;</span>
<span class="n">JsonArray</span><span class="o">&amp;</span> <span class="n">Stick</span><span class="o">=</span> <span class="n">rootS</span><span class="p">.</span><span class="n">createNestedArray</span><span class="p">(</span><span class="s">&quot;Stick&quot;</span><span class="p">);</span>
<span class="n">Stick</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="n">Stick</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="n">rootS</span><span class="p">.</span><span class="n">prettyPrintTo</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/*===============================================*/</span>
<span class="cm">/*IR控制模块*/</span>
<span class="kt">int</span> <span class="n">receiver</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span> <span class="c1">// Signal Pin of IR receiver to Arduino Digital Pin 13</span>
<span class="cm">/*-----( Declare objects )-----*/</span>
<span class="n">IRrecv</span> <span class="nf">irrecv</span><span class="p">(</span><span class="n">receiver</span><span class="p">);</span>     <span class="c1">// create instance of &#39;irrecv&#39;</span>
<span class="n">decode_results</span> <span class="n">results</span><span class="p">;</span>      <span class="c1">// create instance of &#39;decode_results&#39;</span>

<span class="kt">int</span> <span class="nf">transIR</span><span class="p">()</span> <span class="c1">// takes action based on IR code received</span>
<span class="p">{</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <span class="mh">0xFFA25D</span><span class="o">:</span> <span class="p">{</span><span class="k">return</span> <span class="mi">1</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//break; //Serial.println(&quot;POWER&quot;)</span>
  <span class="k">case</span> <span class="mh">0xFFE21D</span><span class="o">:</span> <span class="p">{</span><span class="k">return</span> <span class="mi">2</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//break; //Serial.println(&quot;FUNC/STOP&quot;)</span>
  <span class="k">case</span> <span class="mh">0xFF629D</span><span class="o">:</span> <span class="p">{</span><span class="k">return</span> <span class="mi">3</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//break; //Serial.println(&quot;VOL+&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF22DD</span><span class="o">:</span> <span class="p">{</span><span class="k">return</span> <span class="mi">4</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//   break; //Serial.println(&quot;FAST BACK&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF02FD</span><span class="o">:</span> <span class="p">{</span><span class="k">return</span> <span class="mi">5</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//   break; //Serial.println(&quot;PAUSE&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFFC23D</span><span class="o">:</span> <span class="p">{</span><span class="k">return</span> <span class="mi">6</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//  break; //Serial.println(&quot;FAST FORWARD&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFFE01F</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">7</span><span class="p">;</span>   <span class="p">}</span>    <span class="c1">//   break; //Serial.println(&quot;DOWN&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFFA857</span><span class="o">:</span> <span class="p">{</span><span class="k">return</span> <span class="mi">8</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//  break; //Serial.println(&quot;VOL-&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF906F</span><span class="o">:</span> <span class="p">{</span><span class="k">return</span> <span class="mi">9</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//  break; //Serial.println(&quot;UP&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF9867</span><span class="o">:</span> <span class="p">{</span><span class="k">return</span> <span class="mi">10</span><span class="p">;</span>   <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;EQ&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFFB04F</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">11</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;ST/REPT&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF6897</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">12</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//   break;  //Serial.println(&quot;0&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF30CF</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">13</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//   break; // Serial.println(&quot;1&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF18E7</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">14</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;2&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF7A85</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">15</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//   break; //Serial.println(&quot;3&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF10EF</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">16</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;4&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF38C7</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">17</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;5&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF5AA5</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">18</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;6&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF42BD</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">19</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;7&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF4AB5</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">20</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; // Serial.println(&quot;8&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF52AD</span><span class="o">:</span>  <span class="p">{</span><span class="k">return</span> <span class="mi">21</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;9&quot;);</span>
  <span class="c1">//case 0xFFFFFFFF: {irrecv.resume();return 22;  }    //   break;  //Serial.println(&quot; REPEAT&quot;)</span>
  <span class="c1">//default:</span>
    <span class="c1">//{irrecv.resume();return 23; } //Serial.println(&quot; other button   &quot;);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*===============================================*/</span>
<span class="cm">/*温度和湿度</span>
<span class="cm">int detTH(){</span>
<span class="cm">  byte temperature = 0;</span>
<span class="cm">  byte humidity = 0;</span>
<span class="cm">  byte data[40] = {0};</span>
<span class="cm">  if (dht11.read(pinDHT11, &amp;temperature, &amp;humidity, data)) {</span>
<span class="cm">    Serial.print(&quot;Read DHT11 failed&quot;);</span>
<span class="cm">    return;</span>
<span class="cm">  }</span>
<span class="cm">  hu=data[0]*128+data[1]*64+data[2]*32+data[3]*16+data[4]*8+data[5]*4+data[6]*2+data[7];</span>
<span class="cm">  te=data[16]*128+data[17]*64+data[18]*32+data[19]*16+data[20]*8+data[21]*4+data[22]*2+data[23];</span>
<span class="cm">}</span>
<span class="cm">*/</span>

<span class="kt">void</span> <span class="nf">detTH</span><span class="p">()</span>

<span class="p">{</span>

  <span class="n">delay</span><span class="p">(</span><span class="n">dht</span><span class="p">.</span><span class="n">getMinimumSamplingPeriod</span><span class="p">());</span>
  <span class="n">hu</span><span class="o">=</span><span class="n">dht</span><span class="p">.</span><span class="n">getHumidity</span><span class="p">();</span>
  <span class="n">te</span><span class="o">=</span><span class="n">dht</span><span class="p">.</span><span class="n">getTemperature</span><span class="p">();</span>

<span class="p">}</span>




<span class="cm">/*===============================================*/</span>
<span class="cm">/*亮度*/</span>
<span class="kt">int</span> <span class="nf">detlight</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">lig</span><span class="o">=</span><span class="n">analogRead</span><span class="p">(</span><span class="n">lightPin</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">lig</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*===============================================*/</span>
<span class="cm">/*模拟控制器*/</span>

<span class="kt">int</span> <span class="nf">detX</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">analogRead</span><span class="p">(</span><span class="n">X_pin</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">xaxis</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">detY</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">yaxis</span><span class="o">=</span><span class="n">analogRead</span><span class="p">(</span><span class="n">Y_pin</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">yaxis</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">detSw</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">sw</span><span class="o">=</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">SW_pin</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">sw</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="n">irrecv</span><span class="p">.</span><span class="n">enableIRIn</span><span class="p">();</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">SW_pin</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
<span class="n">digitalWrite</span><span class="p">(</span><span class="n">SW_pin</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="n">dht</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// data pin 2</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">Serial</span><span class="p">)</span> <span class="p">{}</span> <span class="c1">// wait serial port initialization</span>


<span class="c1">//jsonBuffer(1351824120,01,311,24,52,999);</span>
<span class="c1">//joyStick(1000, 999);</span>
<span class="n">setTime</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">2017</span><span class="p">);</span>
<span class="c1">//setTime(hr,min,sec,day,month,yr);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="n">irrecv</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">results</span><span class="p">))</span>

  <span class="p">{</span>
    <span class="n">detTH</span><span class="p">();</span>
    <span class="n">di</span><span class="o">=</span><span class="n">sr04</span><span class="p">.</span><span class="n">Distance</span><span class="p">();</span>
    <span class="n">li</span><span class="o">=</span><span class="n">detlight</span><span class="p">();</span>
    <span class="n">jsonBuffer</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="n">di</span><span class="p">,</span><span class="n">te</span><span class="p">,</span><span class="n">hu</span><span class="p">,</span><span class="n">li</span><span class="p">);</span>
    <span class="n">irrecv</span><span class="p">.</span><span class="n">resume</span><span class="p">();</span>

    <span class="n">ir</span><span class="o">=</span><span class="n">transIR</span><span class="p">();</span>
    <span class="n">joyStick</span><span class="p">(</span><span class="n">detSw</span><span class="p">(),</span><span class="n">detX</span><span class="p">(),</span><span class="n">detY</span><span class="p">(),</span><span class="n">ir</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h2 id="22"><a name="user-content-22" href="#22" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2.2 集成多任务控制</h2>
<div class="codehilite"><pre><span class="cp"># include &lt;Time.h&gt;</span>
<span class="cp"># include &lt;TimeLib.h&gt;</span>

<span class="cp"># include &lt;TimedAction.h&gt;</span>

<span class="cp"># include &lt;ArduinoJson.h&gt;</span>

<span class="cp"># include &lt;IRremote.h&gt;</span>
<span class="cp"># include &lt;IRremoteInt.h&gt;</span>

<span class="cp"># include &lt;SR04.h&gt;</span>
<span class="cp"># define TRIG_PIN 12</span>
<span class="cp"># define ECHO_PIN 11</span>
<span class="n">SR04</span> <span class="n">sr04</span> <span class="o">=</span> <span class="n">SR04</span><span class="p">(</span><span class="n">ECHO_PIN</span><span class="p">,</span><span class="n">TRIG_PIN</span><span class="p">);</span>

<span class="c1">//# include &lt;SimpleDHT.h&gt; int pinDHT11 = 2; SimpleDHT11 dht11;</span>
<span class="cp"># include &lt;DHT.h&gt;</span>
<span class="n">DHT</span> <span class="n">dht</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">lightPin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">SW_pin</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// digital pin connected to switch output</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">X_pin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// analog pin connected to X output</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">Y_pin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// analog pin connected to Y output</span>

<span class="kt">int</span> <span class="n">latchPin</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span> <span class="c1">// connect to the ST_CP of 74HC595 (pin 3,latch pin)</span>
<span class="kt">int</span> <span class="n">clockPin</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// connect to the SH_CP of 74HC595 (pin 4, clock pin)</span>
<span class="kt">int</span> <span class="n">dataPin</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// connect to the DS of 74HC595 (pin 2)</span>



<span class="cm">/*全局变量*/</span>
<span class="kt">long</span> <span class="n">ti</span><span class="o">=</span><span class="mi">1351824120</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">ir</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">di</span><span class="o">=</span><span class="mi">311</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">te</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">hu</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">li</span><span class="o">=</span><span class="mi">999</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="mi">888</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">y</span><span class="o">=-</span><span class="mi">999</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>


<span class="cm">/*构建缓冲区并生成JSON*/</span>
<span class="kt">void</span> <span class="nf">jsonBuffer</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ti</span><span class="p">,</span> <span class="kt">int</span> <span class="n">di</span><span class="p">,</span> <span class="kt">int</span> <span class="n">te</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hu</span><span class="p">,</span> <span class="kt">int</span> <span class="n">li</span><span class="p">)</span> <span class="p">{</span>
<span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="mi">66</span><span class="o">&gt;</span> <span class="n">jsonBuffer</span><span class="p">;</span>
<span class="c1">//const int BUFFER_SIZE1 = JSON_OBJECT_SIZE(6); 64</span>
<span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">rootB</span> <span class="o">=</span> <span class="n">jsonBuffer</span><span class="p">.</span><span class="n">createObject</span><span class="p">();</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Triger&quot;</span><span class="p">]</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Time&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">ti</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">di</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Temperature&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">te</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Humity&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">hu</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Light&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">li</span><span class="p">;</span>
<span class="c1">//rootB.prettyPrintTo(Serial);</span>
<span class="n">rootB</span><span class="p">.</span><span class="n">printTo</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">joyStick</span><span class="p">(</span><span class="kt">int</span> <span class="n">swich</span><span class="p">,</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span><span class="kt">int</span> <span class="n">power</span><span class="p">,</span><span class="kt">int</span> <span class="n">ir</span><span class="p">){</span>
<span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="mi">77</span><span class="o">&gt;</span> <span class="n">joyStick</span><span class="p">;</span>
<span class="c1">//const int BUFFER_SIZE2 = JSON_OBJECT_SIZE(5) + JSON_ARRAY_SIZE(2); 74</span>
<span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">rootS</span> <span class="o">=</span> <span class="n">joyStick</span><span class="p">.</span><span class="n">createObject</span><span class="p">();</span>
<span class="n">rootS</span><span class="p">[</span><span class="s">&quot;Triger&quot;</span><span class="p">]</span> <span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">rootS</span><span class="p">[</span><span class="s">&quot;IR&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">ir</span><span class="p">;</span>
<span class="n">rootS</span><span class="p">[</span><span class="s">&quot;Swich&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">swich</span><span class="p">;</span>
<span class="n">rootS</span><span class="p">[</span><span class="s">&quot;Power&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">power</span><span class="p">;</span>
<span class="n">JsonArray</span><span class="o">&amp;</span> <span class="n">Stick</span><span class="o">=</span> <span class="n">rootS</span><span class="p">.</span><span class="n">createNestedArray</span><span class="p">(</span><span class="s">&quot;Stick&quot;</span><span class="p">);</span>
<span class="n">Stick</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="n">Stick</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="c1">//rootS.prettyPrintTo(Serial);</span>
<span class="n">rootS</span><span class="p">.</span><span class="n">printTo</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>
<span class="cm">/*===============================================*/</span>
<span class="cm">/*个位数显*/</span>
<span class="n">byte</span> <span class="n">seven_seg_digits</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span>   <span class="p">{</span> 
                            <span class="n">B11111100</span><span class="p">,</span>  <span class="c1">// = 0      0</span>
                            <span class="n">B01100000</span><span class="p">,</span>  <span class="c1">// = 1      1</span>
                            <span class="n">B11011010</span><span class="p">,</span>  <span class="c1">// = 2      2</span>
                            <span class="n">B11110010</span><span class="p">,</span>  <span class="c1">// = 3      3</span>
                            <span class="n">B01100110</span><span class="p">,</span>  <span class="c1">// = 4      4</span>
                            <span class="n">B10110110</span><span class="p">,</span>  <span class="c1">// = 5      5</span>
                            <span class="n">B10111110</span><span class="p">,</span>  <span class="c1">// = 6      6</span>
                            <span class="n">B11100000</span><span class="p">,</span>  <span class="c1">// = 7      7</span>
                            <span class="n">B11111110</span><span class="p">,</span>  <span class="c1">// = 8      8</span>
                            <span class="n">B11110110</span><span class="p">,</span>  <span class="c1">// = 9      9</span>
                            <span class="n">B00001110</span><span class="p">,</span>  <span class="c1">// = |-     10</span>
                            <span class="n">B01100010</span><span class="p">,</span>  <span class="c1">// = -|     11</span>
                            <span class="n">B10001100</span><span class="p">,</span>  <span class="c1">// = ┌     12</span>
                            <span class="n">B00011100</span><span class="p">,</span>  <span class="c1">// = └     13</span>
                            <span class="n">B10000000</span><span class="p">,</span>  <span class="c1">// = ┬     14</span>
                            <span class="n">B00010000</span><span class="p">,</span>  <span class="c1">// = ┴     15</span>
                            <span class="n">B11001110</span><span class="p">,</span>  <span class="c1">// = p      16</span>
                            <span class="n">B11001111</span><span class="p">,</span>  <span class="c1">// = p.     17</span>
                            <span class="n">B11100110</span><span class="p">,</span>  <span class="c1">// = q      18</span>
                            <span class="n">B11000110</span><span class="p">,</span>  <span class="c1">// = o     19</span>
                            <span class="n">B10011110</span><span class="p">,</span>   <span class="c1">// = E     20</span>
                            <span class="n">B11011110</span><span class="p">,</span> <span class="c1">// = e    21</span>
                            <span class="n">B11111111</span>  <span class="c1">// = 8.   22</span>
                             <span class="p">};</span>

<span class="kt">void</span> <span class="nf">sevenSegWrite</span><span class="p">(</span><span class="n">byte</span> <span class="n">digit</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">latchPin</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span> <span class="c1">// set the latchPin to low potential, before sending data</span>
  <span class="n">shiftOut</span><span class="p">(</span><span class="n">dataPin</span><span class="p">,</span> <span class="n">clockPin</span><span class="p">,</span> <span class="n">LSBFIRST</span><span class="p">,</span> <span class="n">seven_seg_digits</span><span class="p">[</span><span class="n">digit</span><span class="p">]);</span>     <span class="c1">// the original data (bit pattern)</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">latchPin</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>   <span class="c1">// set the latchPin to high potential, after sending data</span>
<span class="p">}</span>


<span class="cm">/*===============================================*/</span>
<span class="cm">/*IR控制模块*/</span>
<span class="kt">int</span> <span class="n">receiver</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span> <span class="c1">// Signal Pin of IR receiver to Arduino Digital Pin 13</span>
<span class="cm">/*-----( Declare objects )-----*/</span>
<span class="n">IRrecv</span> <span class="nf">irrecv</span><span class="p">(</span><span class="n">receiver</span><span class="p">);</span>     <span class="c1">// create instance of &#39;irrecv&#39;</span>
<span class="n">decode_results</span> <span class="n">results</span><span class="p">;</span>      <span class="c1">// create instance of &#39;decode_results&#39;</span>

<span class="kt">int</span> <span class="nf">transIR</span><span class="p">()</span> <span class="c1">// takes action based on IR code received</span>
<span class="p">{</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <span class="mh">0xFFA25D</span><span class="o">:</span> <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">17</span><span class="p">);</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//break; //Serial.println(&quot;POWER&quot;)</span>
  <span class="k">case</span> <span class="mh">0xFFE21D</span><span class="o">:</span> <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">18</span><span class="p">);</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//break; //Serial.println(&quot;FUNC/STOP&quot;)</span>
  <span class="k">case</span> <span class="mh">0xFF629D</span><span class="o">:</span> <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">14</span><span class="p">);</span> <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//break; //Serial.println(&quot;VOL+&quot;); </span>
  <span class="k">case</span> <span class="mh">0xFF22DD</span><span class="o">:</span> <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="k">return</span> <span class="mi">4</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//   break; //Serial.println(&quot;FAST BACK&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF02FD</span><span class="o">:</span> <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span> <span class="k">return</span> <span class="mi">5</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//   break; //Serial.println(&quot;PAUSE&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFFC23D</span><span class="o">:</span> <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">11</span><span class="p">);</span> <span class="k">return</span> <span class="mi">6</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//  break; //Serial.println(&quot;FAST FORWARD&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFFE01F</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">13</span><span class="p">);</span> <span class="k">return</span> <span class="mi">7</span><span class="p">;</span>   <span class="p">}</span>    <span class="c1">//   break; //Serial.println(&quot;DOWN&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFFA857</span><span class="o">:</span> <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span> <span class="k">return</span> <span class="mi">8</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//  break; //Serial.println(&quot;VOL-&quot;); </span>
  <span class="k">case</span> <span class="mh">0xFF906F</span><span class="o">:</span> <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span> <span class="k">return</span> <span class="mi">9</span><span class="p">;</span>    <span class="p">}</span>    <span class="c1">//  break; //Serial.println(&quot;UP&quot;); </span>
  <span class="k">case</span> <span class="mh">0xFF9867</span><span class="o">:</span> <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span> <span class="k">return</span> <span class="mi">10</span><span class="p">;</span>   <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;EQ&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFFB04F</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">21</span><span class="p">);</span> <span class="k">return</span> <span class="mi">11</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;ST/REPT&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF6897</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="k">return</span> <span class="mi">12</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//   break;  //Serial.println(&quot;0&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF30CF</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="k">return</span> <span class="mi">13</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//   break; // Serial.println(&quot;1&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF18E7</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="k">return</span> <span class="mi">14</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;2&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF7A85</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="k">return</span> <span class="mi">15</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//   break; //Serial.println(&quot;3&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF10EF</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="k">return</span> <span class="mi">16</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;4&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF38C7</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="k">return</span> <span class="mi">17</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;5&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF5AA5</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span> <span class="k">return</span> <span class="mi">18</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;6&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF42BD</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span> <span class="k">return</span> <span class="mi">19</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;7&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF4AB5</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span> <span class="k">return</span> <span class="mi">20</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; // Serial.println(&quot;8&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFF52AD</span><span class="o">:</span>  <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span> <span class="k">return</span> <span class="mi">21</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//    break; //Serial.println(&quot;9&quot;);</span>
  <span class="k">case</span> <span class="mh">0xFFFFFFFF</span><span class="o">:</span> <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">19</span><span class="p">);</span><span class="k">return</span> <span class="mi">22</span><span class="p">;</span>  <span class="p">}</span>    <span class="c1">//   break;  //Serial.println(&quot; REPEAT&quot;)</span>
  <span class="c1">//default: </span>
    <span class="p">{</span><span class="n">sevenSegWrite</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span><span class="k">return</span> <span class="mi">0</span><span class="p">;}</span> <span class="c1">//Serial.println(&quot; other button   &quot;);irrecv.resume();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*===============================================*/</span>
<span class="cm">/*温度和湿度</span>
<span class="cm">int detTH(){</span>
<span class="cm">  byte temperature = 0;</span>
<span class="cm">  byte humidity = 0;</span>
<span class="cm">  byte data[40] = {0};</span>
<span class="cm">  if (dht11.read(pinDHT11, &amp;temperature, &amp;humidity, data)) {</span>
<span class="cm">    Serial.print(&quot;Read DHT11 failed&quot;);</span>
<span class="cm">    return;</span>
<span class="cm">  }</span>
<span class="cm">  hu=data[0]*128+data[1]*64+data[2]*32+data[3]*16+data[4]*8+data[5]*4+data[6]*2+data[7];</span>
<span class="cm">  te=data[16]*128+data[17]*64+data[18]*32+data[19]*16+data[20]*8+data[21]*4+data[22]*2+data[23];</span>
<span class="cm">}</span>
<span class="cm">*/</span>

<span class="kt">void</span> <span class="nf">detTH</span><span class="p">()</span>

<span class="p">{</span>

  <span class="c1">//delay(dht.getMinimumSamplingPeriod());</span>
  <span class="n">hu</span><span class="o">=</span><span class="n">dht</span><span class="p">.</span><span class="n">getHumidity</span><span class="p">();</span>
  <span class="n">te</span><span class="o">=</span><span class="n">dht</span><span class="p">.</span><span class="n">getTemperature</span><span class="p">();</span>

<span class="p">}</span>




<span class="cm">/*===============================================*/</span>
<span class="cm">/*亮度*/</span>
<span class="kt">int</span> <span class="nf">detlight</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">lig</span><span class="o">=</span><span class="n">analogRead</span><span class="p">(</span><span class="n">lightPin</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">lig</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*===============================================*/</span>
<span class="cm">/*模拟控制器*/</span>

<span class="kt">int</span> <span class="nf">detX</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">analogRead</span><span class="p">(</span><span class="n">X_pin</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">xaxis</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">detY</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">yaxis</span><span class="o">=</span><span class="n">analogRead</span><span class="p">(</span><span class="n">Y_pin</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">yaxis</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">detSw</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">sw</span><span class="o">=</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">SW_pin</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">sw</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*===============================================*/</span>
<span class="cm">/*油门控制器*/</span>

<span class="kt">int</span> <span class="nf">power</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">A3</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">power</span><span class="o">-</span><span class="mi">9</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*===============================================*/</span>
<span class="cm">/*多任务*/</span>
<span class="kt">void</span> <span class="nf">sensor</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">detTH</span><span class="p">();</span>
    <span class="n">di</span><span class="o">=</span><span class="n">sr04</span><span class="p">.</span><span class="n">Distance</span><span class="p">();</span>
    <span class="n">li</span><span class="o">=</span><span class="n">detlight</span><span class="p">();</span>
    <span class="n">jsonBuffer</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="n">di</span><span class="p">,</span><span class="n">te</span><span class="p">,</span><span class="n">hu</span><span class="p">,</span><span class="n">li</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">control</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">irrecv</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">results</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">ir</span><span class="o">=</span><span class="n">transIR</span><span class="p">();</span> 
    <span class="p">}</span>
    <span class="k">else</span> <span class="n">ir</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">joyStick</span><span class="p">(</span><span class="n">detSw</span><span class="p">(),</span><span class="n">detX</span><span class="p">(),</span><span class="n">detY</span><span class="p">(),</span><span class="n">power</span><span class="p">(),</span> <span class="n">ir</span><span class="p">);</span>
    <span class="n">irrecv</span><span class="p">.</span><span class="n">resume</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">TimedAction</span> <span class="n">sensorThread</span> <span class="o">=</span> <span class="n">TimedAction</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span><span class="n">sensor</span><span class="p">);</span>
<span class="n">TimedAction</span> <span class="n">controlThread</span> <span class="o">=</span> <span class="n">TimedAction</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="n">control</span><span class="p">);</span>

<span class="cm">/*===============================================*/</span>
<span class="cm">/*主程序开始*/</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="n">irrecv</span><span class="p">.</span><span class="n">enableIRIn</span><span class="p">();</span>

<span class="n">pinMode</span><span class="p">(</span><span class="n">SW_pin</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
<span class="n">digitalWrite</span><span class="p">(</span><span class="n">SW_pin</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>

<span class="n">pinMode</span><span class="p">(</span><span class="n">latchPin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">clockPin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">dataPin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>

<span class="n">dht</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// data pin 2</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">Serial</span><span class="p">)</span> <span class="p">{}</span> <span class="c1">// wait serial port initialization</span>
<span class="c1">//jsonBuffer(1351824120,01,311,24,52,999);</span>
<span class="c1">//joyStick(1000, 999);</span>
<span class="n">setTime</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">2017</span><span class="p">);</span>
<span class="c1">//setTime(hr,min,sec,day,month,yr);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">sensorThread</span><span class="p">.</span><span class="n">check</span><span class="p">();</span>
    <span class="n">controlThread</span><span class="p">.</span><span class="n">check</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<hr />
<h1 id="3"><a name="user-content-3" href="#3" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3 树莓派配置</h1>
<h2 id="31"><a name="user-content-31" href="#31" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.1 安装初始化</h2>
<div class="codehilite"><pre>sudo apt-get update <span class="o">&amp;&amp;</span> sudo apt-get upgrade <span class="o">&amp;&amp;</span> sudo apt-get dist-upgrade

sudo passwd pi

@Pi
</pre></div>


<h3 id="311-wifi"><a name="user-content-311-wifi" href="#311-wifi" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.1.1 WIFI</h3>
<p>sudo apt-get install wireless-tools wpasupplicant</p>
<p>sudo nano /etc/wpa_supplicant/wpa_supplicant.conf</p>
<div class="codehilite"><pre>network=
{
  ssid=&quot;X*X*X*X*X*X &quot;
  psk=&quot;X*X*X*X*X*X &quot;
}
</pre></div>


<p>sudo nano /etc/dhcpcd.conf</p>
<p>interface eth0<br />
  static ip_address=192.168.1.222/24<br />
  static routers=192.168.1.1<br />
  static domain_name_servers=192.168.1.1<br />
  interface wlan0<br />
  static ip_address=192.168.1.111/24<br />
  static routers=192.168.1.1<br />
  static domain_name_servers=192.168.1.1</p>
<p>sudo raspi-config</p>
<p>sudo reboot</p>
<h3 id="312"><a name="user-content-312" href="#312" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.1.2 自动备份</h3>
<p>插上优盘，执行命令。<br />
<strong>sudo sh b.sh</strong></p>
<div class="codehilite"><pre><span class="ch">#!/bin/sh</span>
<span class="c1"># install tools</span>
sudo apt-get -y install rsync dosfstools parted kpartx exfat-fuse
<span class="c1"># mount USB device</span>
<span class="nv">usbmount</span><span class="o">=</span>/mnt
mkdir -p <span class="nv">$usbmount</span>
<span class="k">if</span> <span class="o">[</span> -z <span class="nv">$1</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;no argument, assume the mount device is /dev/sda1 ? Y/N&quot;</span>
  <span class="nb">read </span>key
  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$key</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span> -o <span class="s2">&quot;</span><span class="nv">$key</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;Y&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    sudo mount -o <span class="nv">uid</span><span class="o">=</span><span class="m">1000</span> /dev/sda1 <span class="nv">$usbmount</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2"> [backup dest device name], e.g. </span><span class="nv">$0</span><span class="s2"> /dev/sda1&quot;</span>
    <span class="nb">exit </span>0
  <span class="k">fi</span>
<span class="k">else</span>
  sudo mount -o <span class="nv">uid</span><span class="o">=</span><span class="m">1000</span> <span class="nv">$1</span> <span class="nv">$usbmount</span>
<span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;`grep </span><span class="nv">$usbmount</span><span class="s2"> /etc/mtab`&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;mount fail, exit now&quot;</span>
  <span class="nb">exit </span>0
<span class="k">fi</span>
<span class="nv">img</span><span class="o">=</span><span class="nv">$usbmount</span>/rpi-<span class="sb">`</span>date +%Y%m%d-%H%M<span class="sb">`</span>.img
<span class="c1"># img=$usbmount/rpi.img</span>
<span class="nb">echo</span> <span class="o">=====================</span> part 1, create a new blank <span class="nv">img</span> <span class="o">===============================</span>
<span class="c1"># New img file</span>
<span class="c1"># sudo rm $img</span>
<span class="nv">bootsz</span><span class="o">=</span><span class="sb">`</span>df -P <span class="p">|</span> grep /boot <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>
<span class="nv">rootsz</span><span class="o">=</span><span class="sb">`</span>df -P <span class="p">|</span> grep /dev/root <span class="p">|</span> awk <span class="s1">&#39;{print $3}&#39;</span><span class="sb">`</span>
<span class="nv">totalsz</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$bootsz</span> <span class="nv">$rootsz</span> <span class="p">|</span> awk <span class="s1">&#39;{print int(($1+$2)*1.3)}&#39;</span><span class="sb">`</span>
sudo dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span><span class="nv">$img</span> <span class="nv">bs</span><span class="o">=</span>1K <span class="nv">count</span><span class="o">=</span><span class="nv">$totalsz</span>
<span class="c1"># format virtual disk</span>
<span class="nv">bootstart</span><span class="o">=</span><span class="sb">`</span>sudo fdisk -l /dev/mmcblk0 <span class="p">|</span> grep mmcblk0p1 <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>
<span class="nv">bootend</span><span class="o">=</span><span class="sb">`</span>sudo fdisk -l /dev/mmcblk0 <span class="p">|</span> grep mmcblk0p1 <span class="p">|</span> awk <span class="s1">&#39;{print $3}&#39;</span><span class="sb">`</span>
<span class="nv">rootstart</span><span class="o">=</span><span class="sb">`</span>sudo fdisk -l /dev/mmcblk0 <span class="p">|</span> grep mmcblk0p2 <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>
<span class="nb">echo</span> <span class="s2">&quot;boot: </span><span class="nv">$bootstart</span><span class="s2"> &gt;&gt;&gt; </span><span class="nv">$bootend</span><span class="s2">, root: </span><span class="nv">$rootstart</span><span class="s2"> &gt;&gt;&gt; end&quot;</span>
<span class="c1"># rootend=`sudo fdisk -l /dev/mmcblk0 | grep mmcblk0p2 | awk &#39;{print $3}&#39;`</span>
sudo parted <span class="nv">$img</span> --script -- mklabel msdos
sudo parted <span class="nv">$img</span> --script -- mkpart primary fat32 <span class="si">${</span><span class="nv">bootstart</span><span class="si">}</span>s <span class="si">${</span><span class="nv">bootend</span><span class="si">}</span>s
sudo parted <span class="nv">$img</span> --script -- mkpart primary ext4 <span class="si">${</span><span class="nv">rootstart</span><span class="si">}</span>s -1
<span class="nv">loopdevice</span><span class="o">=</span><span class="sb">`</span>sudo losetup -f --show <span class="nv">$img</span><span class="sb">`</span>
<span class="nv">device</span><span class="o">=</span>/dev/mapper/<span class="sb">`</span>sudo kpartx -va <span class="nv">$loopdevice</span> <span class="p">|</span> sed -E <span class="s1">&#39;s/.*(loop[0-9])p.*/\1/g&#39;</span> <span class="p">|</span> head -1<span class="sb">`</span>
sleep 5
sudo mkfs.vfat <span class="si">${</span><span class="nv">device</span><span class="si">}</span>p1 -n boot
sudo mkfs.ext4 <span class="si">${</span><span class="nv">device</span><span class="si">}</span>p2
<span class="nb">echo</span> <span class="o">=====================</span> part 2, fill the data to <span class="nv">img</span> <span class="o">=========================</span>
<span class="c1"># mount partitions</span>
<span class="nv">mountb</span><span class="o">=</span><span class="nv">$usbmount</span>/backup_boot/
<span class="nv">mountr</span><span class="o">=</span><span class="nv">$usbmount</span>/backup_root/
mkdir -p <span class="nv">$mountb</span> <span class="nv">$mountr</span>
<span class="c1"># backup /boot</span>
sudo mount -t vfat <span class="si">${</span><span class="nv">device</span><span class="si">}</span>p1 <span class="nv">$mountb</span>
sudo cp -rfp /boot/* <span class="nv">$mountb</span>
sync
<span class="nb">echo</span> <span class="s2">&quot;...Boot partition done&quot;</span>
<span class="c1"># backup /root</span>
sudo mount -t ext4 <span class="si">${</span><span class="nv">device</span><span class="si">}</span>p2 <span class="nv">$mountr</span>
<span class="k">if</span> <span class="o">[</span> -f /etc/dphys-swapfile <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">SWAPFILE</span><span class="o">=</span><span class="sb">`</span>cat /etc/dphys-swapfile <span class="p">|</span> grep ^CONF_SWAPFILE <span class="p">|</span> cut -f <span class="m">2</span> -d<span class="o">=</span><span class="sb">`</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$SWAPFILE</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">SWAPFILE</span><span class="o">=</span>/var/swap
  <span class="k">fi</span>
  <span class="nv">EXCLUDE_SWAPFILE</span><span class="o">=</span><span class="s2">&quot;--exclude </span><span class="nv">$SWAPFILE</span><span class="s2">&quot;</span>
<span class="k">fi</span>
sudo rsync --force -rltWDEgop --delete --stats --progress <span class="se">\</span>
  <span class="nv">$EXCLUDE_SWAPFILE</span> <span class="se">\</span>
  --exclude <span class="s1">&#39;.gvfs&#39;</span> <span class="se">\</span>
  --exclude <span class="s1">&#39;/dev&#39;</span> <span class="se">\</span>
        --exclude <span class="s1">&#39;/media&#39;</span> <span class="se">\</span>
  --exclude <span class="s1">&#39;/mnt&#39;</span> <span class="se">\</span>
  --exclude <span class="s1">&#39;/proc&#39;</span> <span class="se">\</span>
        --exclude <span class="s1">&#39;/run&#39;</span> <span class="se">\</span>
  --exclude <span class="s1">&#39;/sys&#39;</span> <span class="se">\</span>
  --exclude <span class="s1">&#39;/tmp&#39;</span> <span class="se">\</span>
        --exclude <span class="s1">&#39;lost\+found&#39;</span> <span class="se">\</span>
  --exclude <span class="s1">&#39;$usbmount&#39;</span> <span class="se">\</span>
  // <span class="nv">$mountr</span>
<span class="c1"># special dirs</span>
<span class="k">for</span> i in dev media mnt proc run sys boot<span class="p">;</span> <span class="k">do</span>
  <span class="k">if</span> <span class="o">[</span> ! -d <span class="nv">$mountr</span>/<span class="nv">$i</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    sudo mkdir <span class="nv">$mountr</span>/<span class="nv">$i</span>
  <span class="k">fi</span>
<span class="k">done</span>
<span class="k">if</span> <span class="o">[</span> ! -d <span class="nv">$mountr</span>/tmp <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  sudo mkdir <span class="nv">$mountr</span>/tmp
  sudo chmod a+w <span class="nv">$mountr</span>/tmp
<span class="k">fi</span>
<span class="c1"># sudo rm -f $mountr/etc/udev/rules.d/70-persistent-net.rules</span>
sync
ls -lia <span class="nv">$mountr</span>/home/pi/
<span class="nb">echo</span> <span class="s2">&quot;...Root partition done&quot;</span>
<span class="c1"># if using the dump/restore</span>
<span class="c1"># tmp=$usbmount/root.ext4</span>
<span class="c1"># sudo chattr +d $img $mountb $mountr $tmp</span>
<span class="c1"># sudo mount -t ext4 ${device}p2 $mountr</span>
<span class="c1"># cd $mountr</span>
<span class="c1"># sudo dump -0uaf - / | sudo restore -rf -</span>
<span class="c1"># cd</span>
<span class="c1"># replace PARTUUID</span>
<span class="nv">opartuuidb</span><span class="o">=</span><span class="sb">`</span>blkid -o <span class="nb">export</span> /dev/mmcblk0p1 <span class="p">|</span> grep PARTUUID<span class="sb">`</span>
<span class="nv">opartuuidr</span><span class="o">=</span><span class="sb">`</span>blkid -o <span class="nb">export</span> /dev/mmcblk0p2 <span class="p">|</span> grep PARTUUID<span class="sb">`</span>
<span class="nv">npartuuidb</span><span class="o">=</span><span class="sb">`</span>blkid -o <span class="nb">export</span> <span class="si">${</span><span class="nv">device</span><span class="si">}</span>p1 <span class="p">|</span> grep PARTUUID<span class="sb">`</span>
<span class="nv">npartuuidr</span><span class="o">=</span><span class="sb">`</span>blkid -o <span class="nb">export</span> <span class="si">${</span><span class="nv">device</span><span class="si">}</span>p2 <span class="p">|</span> grep PARTUUID<span class="sb">`</span>
sudo sed -i <span class="s2">&quot;s/</span><span class="nv">$opartuuidr</span><span class="s2">/</span><span class="nv">$npartuuidr</span><span class="s2">/g&quot;</span> <span class="nv">$mountb</span>/cmdline.txt
sudo sed -i <span class="s2">&quot;s/</span><span class="nv">$opartuuidb</span><span class="s2">/</span><span class="nv">$npartuuidb</span><span class="s2">/g&quot;</span> <span class="nv">$mountr</span>/etc/fstab
sudo sed -i <span class="s2">&quot;s/</span><span class="nv">$opartuuidr</span><span class="s2">/</span><span class="nv">$npartuuidr</span><span class="s2">/g&quot;</span> <span class="nv">$mountr</span>/etc/fstab
sudo umount <span class="nv">$mountb</span>
sudo umount <span class="nv">$mountr</span>
<span class="c1"># umount loop device</span>
sudo kpartx -d <span class="nv">$loopdevice</span>
sudo losetup -d <span class="nv">$loopdevice</span>
sudo umount <span class="nv">$usbmount</span>
rm -rf <span class="nv">$mountb</span> <span class="nv">$mountr</span>
<span class="nb">echo</span> <span class="s2">&quot;==== All done. You can un-plug the backup device&quot;</span>
</pre></div>


<h3 id="313"><a name="user-content-313" href="#313" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.1.3 远程屏幕登陆</h3>
<p>在树莓派上安装VNC Server：</p>
<p>sudo apt-get install tightvncserver<br />
启动树莓派VNC Server<br />
  sudo tightvncserver :1 -geometry 1600x900<br />
  tightvncserver -kill :1   //终止控制台</p>
<p>X<em>X</em>X<em>X</em>X*X </p>
<p>重置密码</p>
<p>sudo tightvncpasswd</p>
<p>自动启动</p>
<p>sudo nano /etc/init.d/tightvncserver</p>
<div class="codehilite"><pre><span class="ch">#!/bin/sh</span>
<span class="c1">### BEGIN INIT INFO</span>
<span class="c1"># Provides:          tightvncserver</span>
<span class="c1"># Required-Start:    $local_fs</span>
<span class="c1"># Required-Stop:     $local_fs</span>
<span class="c1"># Default-Start:     2 3 4 5</span>
<span class="c1"># Default-Stop:      0 1 6</span>
<span class="c1"># Short-Description: Start/stop tightvncserver</span>
<span class="c1">### END INIT INFO</span>

<span class="c1"># More details see:</span>
<span class="c1"># http://www.penguintutor.com/linux/tightvnc</span>

<span class="c1">### Customize this entry</span>
<span class="c1"># Set the USER variable to the name of the user to start tightvncserver under</span>
<span class="nb">export </span><span class="nv">USER</span><span class="o">=</span><span class="s1">&#39;pi&#39;</span>
<span class="c1">### End customization required</span>

<span class="nb">eval cd</span> ~<span class="nv">$USER</span>

<span class="k">case</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> in
  start<span class="o">)</span>
    <span class="c1"># 启动命令行。此处自定义分辨率、控制台号码或其它参数。</span>
    su <span class="nv">$USER</span> -c <span class="s1">&#39;/usr/bin/tightvncserver -depth 16 -geometry 1600x900 :1&#39;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Starting TightVNC server for </span><span class="nv">$USER</span><span class="s2"> &quot;</span>
    <span class="p">;;</span>
  stop<span class="o">)</span>
    <span class="c1"># 终止命令行。此处控制台号码与启动一致。</span>
    su <span class="nv">$USER</span> -c <span class="s1">&#39;/usr/bin/tightvncserver -kill :1&#39;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Tightvncserver stopped&quot;</span>
    <span class="p">;;</span>
  *<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Usage: /etc/init.d/tightvncserver {start|stop}&quot;</span>
    <span class="nb">exit </span>1
    <span class="p">;;</span>
<span class="k">esac</span>
<span class="nb">exit </span>0
</pre></div>


<p>sudo chmod +755 /etc/init.d/tightvncserver<br />
sudo update-rc.d tightvncserver defaults</p>
<p><strong>桌面端登录</strong></p>
<div class="codehilite"><pre>192.168.1.111:1
X*X*X*X*X*X 
</pre></div>


<h3 id="314"><a name="user-content-314" href="#314" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.1.4清理垃圾</h3>
<p>sudo apt-get autoclean<br />
sudo apt-get clean<br />
sudo apt-get autoremove</p>
<h3 id="315"><a name="user-content-315" href="#315" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.1.5 开机运行</h3>
<p>nano /etc/rc.local<br />
在最后一行 exit 0 之上加入</p>
<p>su txt.sh start</p>
<h3 id="316"><a name="user-content-316" href="#316" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.1.6 温度监控</h3>
<p>创建新sh文档</p>
<p>nano tempera.sh<br />
<div class="codehilite"><pre>cpu=$(&lt;/sys/class/thermal/thermal_zone0/temp)
echo &quot;$(date) @ $(hostname)&quot;
echo &quot;-------------------------------------------&quot;
echo &quot;GPU =&gt; $(/opt/vc/bin/vcgencmd measure_temp)&quot;
echo &quot;CPU =&gt; $((cpu/1000))&#39;C&quot;
</pre></div>
<br />
更改文件权限</p>
<blockquote>
<p>chmod +x tempera.sh</p>
</blockquote>
<p>运行<br />
./my-pi-temp.sh</p>
<div class="codehilite"><pre>结果如下
Sun 10 Sep 21:15:11 CEST 2017 @ Vi_raspberry
-------------------------------------------
GPU =&gt; temp=31.1&#39;C
CPU =&gt; 30&#39;C
</pre></div>


<h3 id="317"><a name="user-content-317" href="#317" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.1.7 中文</h3>
<p>显示</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">ttf</span><span class="o">-</span><span class="n">wqy</span><span class="o">-</span><span class="n">zenhei</span>
</pre></div>


<h2 id="32-arduino-ide"><a name="user-content-32-arduino-ide" href="#32-arduino-ide" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.2 集成arduino IDE</h2>
<p>安装arduino IDE</p>
<p>sudo apt-get update &amp;&amp; sudo apt-get install arduino</p>
<h2 id="33-ssh"><a name="user-content-33-ssh" href="#33-ssh" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3 远程SSH登录树莓派</h2>
<p>Dogtunnel</p>
<h3 id="331-go"><a name="user-content-331-go" href="#331-go" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3.1 安装go语言环境</h3>
<div class="codehilite"><pre>wget https://storage.googleapis.com/golang/go1.9.linux-armv6l.tar.gz
sudo tar -C /usr/local -xzf go1.9.linux-armv6l.tar.gz
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/go/bin
<span class="nb">source</span> ~/.profile
</pre></div>


<p>新建名为hello.go的文件来测试是否安装成功</p>
<div class="codehilite"><pre><span class="kn">package</span> <span class="nx">main</span>
<span class="kn">import</span> <span class="s">&quot;fmt&quot;</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Hello World\n&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>在终端运行</p>
<div class="codehilite"><pre>go run hello.go
</pre></div>


<ul>
<li>VPS</li>
</ul>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">golang</span><span class="o">-</span><span class="n">go</span>
<span class="n">export</span> <span class="n">GOROOT</span><span class="o">=</span><span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="n">go</span>
<span class="c1"># export PATH=$GOROOT/bin:$PATHU</span>
<span class="n">sudo</span> <span class="n">mkdir</span> <span class="n">Applications</span><span class="o">/</span><span class="n">go</span>
<span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="s">&quot;/usr/bin:$PATH&quot;</span>
</pre></div>


<h3 id="332"><a name="user-content-332" href="#332" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3.2 下载狗洞客户端并配置</h3>
<p>共同的配置</p>
<ul>
<li>安装依赖</li>
</ul>
<div class="codehilite"><pre><span class="nt">go</span> <span class="nt">get</span> <span class="nt">github</span><span class="nc">.com</span><span class="o">/</span><span class="nt">go-sql-driver</span><span class="o">/</span><span class="nt">mysql</span>
<span class="nt">go</span> <span class="nt">get</span> <span class="nt">github</span><span class="nc">.com</span><span class="o">/</span><span class="nt">klauspost</span><span class="o">/</span><span class="nt">reedsolomon</span>
<span class="nt">go</span> <span class="nt">get</span> <span class="nt">github</span><span class="nc">.com</span><span class="o">/</span><span class="nt">cznic</span><span class="o">/</span><span class="nt">zappy</span>
<span class="nt">git</span> <span class="nt">clone</span> <span class="nt">https</span><span class="o">://</span><span class="nt">github</span><span class="nc">.com</span><span class="o">/</span><span class="nt">vzex</span><span class="o">/</span><span class="nt">dog-tunnel</span><span class="nc">.git</span>
<span class="nt">go</span> <span class="nt">get</span> <span class="nt">github</span><span class="nc">.com</span><span class="o">/</span><span class="nt">go-sql-driver</span><span class="o">/</span><span class="nt">mysql</span>
<span class="nt">make</span>
<span class="nt">mv</span> <span class="nt">dtunnel</span> <span class="o">/</span><span class="nt">usr</span><span class="o">/</span><span class="nt">bin</span><span class="o">/</span><span class="nt">dtunnel</span>
</pre></div>


<p>说明：</p>
<p>下载对应您系统的dtunnel客户端(win/linux/mac/arm),程序需要在狗洞两端运行，服务的一方叫远端，连接的一方叫近端。</p>
<p><strong>远端</strong> Raspbian</p>
<p>./dtunnel -reg name -local :80 -clientkey qwerty</p>
<p>reg:注册服务名,</p>
<p>local:监听端口，填socks5则为socks5代理服务，</p>
<p>clientkey:默认空，近端访问用的密码</p>
<p><strong>近端</strong> </p>
<p>./dtunnel -link name -local :8888 -clientkey qwerty</p>
<p>link:注册服务名,</p>
<p>local:服务端口，用于近端其他应用连接，</p>
<p>clientkey:默认空，要和远端一致</p>
<p>近端:待出现service start success字样后代表狗洞准备就绪，请连接local指定的端口测试</p>
<p>注意:对于多公网ip的终端，请用-stun参数指定stun服务器辅助连接，或者用-addip参数手工指定出口ip列表</p>
<p><strong>常规版本</strong></p>
<div class="codehilite"><pre><span class="nt">dtunnel_s</span> <span class="nt">-addr</span> <span class="nt">0</span><span class="nc">.0.0.0</span><span class="nd">:8000</span> <span class="nt">-addrudp</span> <span class="nt">0</span><span class="nc">.0.0.0</span><span class="nd">:8018</span> <span class="nt">-admin</span> <span class="nt">127</span><span class="nc">.0.0.1</span><span class="nd">:1234</span> <span class="nt">-https</span> <span class="nt">-ssl</span> <span class="nt">-cert</span> <span class="o">/</span><span class="nt">path</span><span class="o">/</span><span class="nt">to</span><span class="o">/</span><span class="nt">https</span><span class="nc">.crt</span> <span class="nt">-key</span> <span class="o">/</span><span class="nt">path</span><span class="o">/</span><span class="nt">to</span><span class="o">/</span><span class="nt">https</span><span class="nc">.key</span> <span class="nt">-dbhost</span> <span class="nt">1</span><span class="nc">.2.3.4</span><span class="nd">:3306</span> <span class="nt">-dbpass</span> <span class="nt">mysqlpass</span> <span class="nt">-dbuser</span> <span class="nt">mysqluser</span> <span class="nt">-replace</span>

<span class="nf">#参数说明</span>
<span class="nt">-addr</span><span class="err">：</span><span class="nt">TCP端口地址</span>
<span class="nt">-addrudp</span><span class="err">：</span><span class="nt">UDP端口地址</span><span class="err">，</span><span class="nt">用于P2P辅助打洞</span>
<span class="nt">-admin</span><span class="err">：</span><span class="nt">管理接口</span><span class="err">，</span><span class="nt">用于提供API方便管理</span>
<span class="nt">-https</span><span class="err">：</span><span class="nt">启用管理接口的HTTPS支持</span><span class="err">，</span><span class="nt">需要指定-cert和-cert参数</span><span class="err">，</span><span class="nt">默认关闭</span>
<span class="nt">-ssl</span><span class="err">：</span><span class="nt">启用ssl支持</span><span class="err">，</span><span class="nt">启用需要指定-cert和-cert参数</span><span class="err">，</span><span class="nt">默认关闭</span>
<span class="nt">-cert</span><span class="err">：</span><span class="nt">证书路径</span>
<span class="nt">-key</span><span class="err">：</span><span class="nt">证书密钥路径</span>
<span class="nt">-dbhost</span><span class="err">：</span><span class="nt">数据库服务器</span>
<span class="nt">-dbpass</span><span class="err">：</span><span class="nt">数据库密码</span>
<span class="nt">-dbuser</span><span class="err">：</span><span class="nt">数据库用户</span>
<span class="nt">-replace</span><span class="err">：</span><span class="nt">如果客户端注册名冲突</span><span class="err">，</span><span class="nt">踢掉之前的</span><span class="err">，</span><span class="nt">默认关闭</span>
<span class="nt">-version</span><span class="err">：</span><span class="nt">显示版本</span>
</pre></div>


<p><strong>客户端</strong></p>
<div class="codehilite"><pre><span class="nt">远端</span><span class="o">:</span> <span class="nt">dtunnel</span> <span class="nt">-addip</span> <span class="nt">127</span><span class="nc">.0.0.1</span> <span class="nt">-buster</span> <span class="nt">1</span><span class="nc">.2.3.4</span><span class="nd">:8018</span> <span class="nt">-remote</span> <span class="nt">1</span><span class="nc">.2.3.4</span><span class="o">:</span><span class="nd">:8000</span> <span class="nt">-clientkey</span> <span class="nt">testkey</span> <span class="nt">-compress</span> <span class="nt">-delay</span> <span class="nt">2</span> <span class="nt">-dnscache</span> <span class="nt">20</span> <span class="nt">-encrypt</span> <span class="nt">-kcp</span> <span class="nt">k2</span><span class="nd">:v2</span> <span class="nt">-reg</span> <span class="nt">test</span> <span class="nt">-local</span> <span class="nd">:80</span> <span class="nt">-mode</span> <span class="nt">0</span> <span class="nt">-ssl</span>

<span class="nt">近端</span><span class="o">:</span> <span class="nt">dtunnel</span> <span class="nt">-addip</span> <span class="nt">127</span><span class="nc">.0.0.1</span> <span class="nt">-buster</span> <span class="nt">1</span><span class="nc">.2.3.4</span><span class="nd">:8018</span> <span class="nt">-remote</span> <span class="nt">1</span><span class="nc">.2.3.4</span><span class="o">:</span><span class="nd">:8000</span> <span class="nt">-clientkey</span> <span class="nt">testkey</span> <span class="nt">-compress</span> <span class="nt">-delay</span> <span class="nt">2</span> <span class="nt">-dnscache</span> <span class="nt">20</span> <span class="nt">-encrypt</span> <span class="nt">-kcp</span> <span class="nt">k2</span><span class="nd">:v2</span> <span class="nt">-link</span> <span class="nt">test</span> <span class="nt">-local</span> <span class="nd">:8888</span> <span class="nt">-mode</span> <span class="nt">0</span> <span class="nt">-ssl</span>

<span class="nf">#参数说明</span>
<span class="nt">-addip</span><span class="err">：</span><span class="nt">出口IP</span><span class="o">(</span><span class="nt">单个或列表</span><span class="o">)</span>
<span class="nt">-buster</span><span class="err">：</span><span class="nt">打洞服务器</span><span class="err">，</span><span class="nt">用于P2P模式</span>
<span class="nt">-remote</span><span class="err">：</span><span class="nt">远程服务器</span><span class="err">，</span><span class="nt">用于C</span><span class="o">/</span><span class="nt">S模式</span>
<span class="nt">-clientkey</span><span class="err">：</span><span class="nt">客户端Key</span><span class="err">，</span><span class="nt">用于远端和近端认证</span><span class="err">，</span><span class="nt">需一致</span>
<span class="nt">-compress</span><span class="err">：</span><span class="nt">压缩数据</span><span class="err">，</span><span class="nt">远端和近端需一致</span>
<span class="nt">-debug</span><span class="err">：</span><span class="nt">调试模式</span>
<span class="nt">-delay</span><span class="err">：</span><span class="nt">打洞失败后重试延迟</span><span class="err">，</span><span class="nt">秒</span>
<span class="nt">-dnscache</span><span class="err">：</span><span class="nt">DNS缓存有效期</span><span class="err">，</span><span class="nt">如果大于0将定时清空DNS缓存</span><span class="err">，</span><span class="nt">分钟</span>
<span class="nt">-encrypt</span><span class="err">：</span><span class="nt">P2P模式加密</span>
<span class="nt">-f</span><span class="err">：</span><span class="nt">从文件中加载配置</span>
<span class="nt">-kcp</span><span class="err">：</span><span class="nt">kcp配置</span><span class="err">，</span><span class="nt">远端和近端需一致</span>
<span class="nt">-key</span><span class="err">：</span><span class="nt">访问Key</span><span class="o">(</span><span class="nt">服务端数据库中的AuthKey</span><span class="o">)</span>
<span class="nt">-reg</span><span class="err">：</span><span class="nt">注册名</span><span class="err">，</span><span class="nt">远端使用</span>
<span class="nt">-link</span><span class="err">：</span><span class="nt">连接的注册名</span><span class="err">，</span><span class="nt">近端使用</span><span class="err">，</span><span class="nt">用于识别连接远端</span>
<span class="nt">-local</span><span class="err">：</span><span class="nt">本地监听端口</span><span class="err">，</span><span class="nt">填socks5则为socks5代理服务</span>
<span class="nt">-mode</span><span class="err">：</span><span class="nt">连接模式</span><span class="o">(</span><span class="nt">0</span><span class="nd">:P2P打洞失败后切换为C</span><span class="o">/</span><span class="nt">S</span> <span class="nt">1</span><span class="nd">:只使用P2P</span> <span class="nt">2</span><span class="nd">:只使用C</span><span class="o">/</span><span class="nt">S</span><span class="o">)</span>
<span class="nt">-pipen</span><span class="err">：</span><span class="nt">管道数</span>
<span class="nt">-ds</span><span class="err">：</span><span class="nt">数据纠错</span><span class="err">？？</span><span class="nt">仅在P2P模式有效</span><span class="err">，</span><span class="nt">远端和近端需一致</span>
<span class="nt">-ps</span><span class="err">：</span><span class="nt">奇偶校验</span><span class="err">？？</span><span class="nt">仅在P2P模式有效</span><span class="err">，</span><span class="nt">远端和近端需一致</span>
<span class="nt">-ssl</span><span class="err">：</span><span class="nt">启用ssl支持</span><span class="err">，</span><span class="nt">默认启用</span><span class="err">，</span><span class="nt">服务端没有启用的话请使用-ssl</span><span class="o">=</span><span class="nt">false来关闭</span>
<span class="nt">-v</span><span class="err">：</span><span class="nt">输出详细日志</span>
<span class="nt">-version</span><span class="err">：</span><span class="nt">显示版本</span>
</pre></div>


<p>​</p>
<h4 id="3321-raspbian"><a name="user-content-3321-raspbian" href="#3321-raspbian" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3.2.1 Raspbian</h4>
<p>下载</p>
<div class="codehilite"><pre>mkdir dogtunnel
cd dogtunnel
wget http://dog-tunnel.tk/down/dtunnel_linux_arm_0.80.tgz
mkdir dt
sudo tar -C ~/dogtunnel/dt -xzf dtunnel_linux_arm_0.80.tgz
</pre></div>


<p>更改权限并运行</p>
<div class="codehilite"><pre>cd dt
chmod +x ./dtunnel
./dtunnel -reg X*X*X*X*X*X  -local :22 -clientkey X*X*X*X*X*X 
# 任意目录可执行命令
/home/pi/dogtunnel/dt/dtunnel -reg X*X*X*X*X*X  -local :22 -clientkey X*X*X*X*X*X 
</pre></div>


<h4 id="3322-vps"><a name="user-content-3322-vps" href="#3322-vps" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3.2.2 VPS</h4>
<p>下载</p>
<div class="codehilite"><pre>mkdir dogtunnel
cd dogtunnel
wget http://dog-tunnel.tk/down/dtunnel_linux_x64_0.80.tgz
mkdir dt
sudo tar -C /home/liang/dogtunnel/dt -xzf dtunnel_linux_x64_0.80.tgz
</pre></div>


<p>更改权限并运行</p>
<div class="codehilite"><pre>cd dt
chmod +x ./dtunnel
./dtunnel -link X*X*X*X*X*X  -local :X*X*X*X*X*X  -clientkey X*X*X*X*X*X 
# 任意目录可执行
/home/liang/dogtunnel/dt/dtunnel -link X*X*X*X*X*X  -local :X*X*X*X*X*X  -clientkey X*X*X*X*X*X 
</pre></div>


<h3 id="333"><a name="user-content-333" href="#333" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3.3 添加开机自启动脚本</h3>
<h4 id="3330"><a name="user-content-3330" href="#3330" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3.3.0 准备步骤</h4>
<p><strong>将命令更改为后台运行并且任意目录可执行</strong></p>
<div class="codehilite"><pre><span class="c1"># 服务端 Raspbian</span>
<span class="n">sudo</span> <span class="n">nohup</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">dogtunnel</span><span class="o">/</span><span class="n">dt</span><span class="o">/</span><span class="n">dtunnel</span> <span class="o">-</span><span class="n">reg</span> <span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span>  <span class="o">-</span><span class="n">local</span> <span class="p">:</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span>  <span class="o">-</span><span class="n">clientkey</span> <span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span>  <span class="o">-</span><span class="n">v</span> <span class="mi">2</span><span class="o">&gt;&amp;</span> <span class="mi">1</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">dtunnel</span><span class="o">.</span><span class="n">log</span> <span class="o">&amp;</span>
<span class="c1"># 客户端 66</span>
<span class="n">sudo</span> <span class="n">nohup</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">dogtunnel</span><span class="o">/</span><span class="n">dt</span><span class="o">/</span><span class="n">dtunnel</span> <span class="o">-</span><span class="n">link</span> <span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span>  <span class="o">-</span><span class="n">local</span> <span class="p">:</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span>  <span class="o">-</span><span class="n">clientkey</span> <span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span>  <span class="o">-</span><span class="n">v</span> <span class="mi">2</span><span class="o">&gt;&amp;</span> <span class="mi">1</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">dtunnel</span><span class="o">.</span><span class="n">log</span> <span class="o">&amp;</span>
<span class="c1"># 日志文件目录权限问题</span>
<span class="n">nohup</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">dogtunnel</span><span class="o">/</span><span class="n">dt</span><span class="o">/</span><span class="n">dtunnel</span> <span class="o">-</span><span class="n">reg</span> <span class="n">xxx</span> <span class="o">-</span><span class="n">local</span> <span class="p">:</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span>  <span class="o">-</span><span class="n">clientkey</span> <span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span>  <span class="o">-</span><span class="n">v</span> <span class="mi">2</span><span class="o">&gt;&amp;</span> <span class="mi">1</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">dogtunnel</span><span class="o">.</span><span class="n">log</span> <span class="o">&amp;</span>
</pre></div>


<p>后重启<br />
<code>/var/log/dtunnel.log</code> 是输出日志</p>
<p>因为dtunnel本身不是后台命令，直接这样执行的话，可能是会阻塞住那个启动脚本的，上面是改成了后台执行，还是启动不了的话就看看输出日志里有没有异常</p>
<h4 id="3331"><a name="user-content-3331" href="#3331" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3.3.1 命令行自动运行</h4>
<p><code>sudo nano /etc/init.d/dogtunnel</code></p>
<div class="codehilite"><pre><span class="ch">#! /bin/sh</span>
<span class="c1"># /etc/init.d/noip </span>

<span class="c1">### BEGIN INIT INFO</span>
<span class="c1"># Provides:          noip</span>
<span class="c1"># Required-Start:    $remote_fs $syslog</span>
<span class="c1"># Required-Stop:     $remote_fs $syslog</span>
<span class="c1"># Default-Start:     2 3 4 5</span>
<span class="c1"># Default-Stop:      0 1 6</span>
<span class="c1"># Short-Description: Simple script to start a program at boot</span>
<span class="c1"># Description:       A simple script which will start / stop a program a boot / shutdown.</span>
<span class="c1">### END INIT INFO</span>

<span class="c1"># If you want a command to always run, put it here</span>

<span class="c1"># Carry out specific functions when asked to by the system</span>
<span class="n">case</span> <span class="s">&quot;$1&quot;</span> <span class="ow">in</span>
  <span class="n">start</span><span class="p">)</span>
    <span class="n">echo</span> <span class="s">&quot;Starting DogTunnel&quot;</span>
    <span class="c1"># run application you want to start</span>
    <span class="c1">#服务端</span>
    <span class="c1">#/home/pi/dogtunnel/dt/dtunnel -reg lencshu -local :X*X*X*X*X*X  -clientkey X*X*X*X*X*X </span>
    <span class="c1">#客户端</span>
    <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">dogtunnel</span><span class="o">/</span><span class="n">dt</span><span class="o">/</span><span class="n">dtunnel</span> <span class="o">-</span><span class="n">link</span> <span class="n">lencshu</span> <span class="o">-</span><span class="n">local</span> <span class="p">:</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span>  <span class="o">-</span><span class="n">clientkey</span> <span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span> 
    <span class="p">;;</span>
  <span class="n">stop</span><span class="p">)</span>
    <span class="n">echo</span> <span class="s">&quot;Stopping DogTunnel&quot;</span>
    <span class="c1"># kill application you want to stop</span>
    <span class="n">killall</span> <span class="n">dtunnel</span>
    <span class="p">;;</span>
  <span class="o">*</span><span class="p">)</span>
    <span class="n">echo</span> <span class="s">&quot;Usage: /etc/init.d/dtunnel {start|stop}&quot;</span>
    <span class="nb">exit</span> <span class="mi">1</span>
    <span class="p">;;</span>
<span class="n">esac</span>

<span class="nb">exit</span> <span class="mi">0</span>
</pre></div>


<p>Make the script executable:</p>
<div class="codehilite"><pre>sudo chmod +755 /etc/init.d/dogtunnel
</pre></div>


<p>测试</p>
<div class="codehilite"><pre>sudo /etc/init.d/dogtunnel start  
sudo /etc/init.d/dogtunnel stop
</pre></div>


<p>Register script to be run at startup:</p>
<div class="codehilite"><pre>cd /etc/init.d/
sudo update-rc.d dogtunnel defaults
</pre></div>


<p>清除 remove the script from start-up</p>
<div class="codehilite"><pre>sudo update-rc.d -f dogtunnel remove
</pre></div>


<h3 id="334-ftp"><a name="user-content-334-ftp" href="#334-ftp" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3.4 FTP</h3>
<div class="codehilite"><pre>sudo apt install -y proftpd

sudo nano /etc/proftpd/proftpd.conf

sudo service proftpd reload
</pre></div>


<h3 id="335"><a name="user-content-335" href="#335" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3.5 查看端口占用</h3>
<p><code>sudo apt-get update &amp;&amp; sudo apt-get install lsof</code></p>
<div class="codehilite"><pre>ps –ef<span class="p">|</span>grep 进程名
netstat -anp<span class="p">|</span>grep pid
sudo lsof -i :80

  nginx   <span class="m">520</span>     root    6u  IPv4  <span class="m">11792</span>      0t0  TCP *:http <span class="o">(</span>LISTEN<span class="o">)</span>
  nginx   <span class="m">520</span>     root    7u  IPv6  <span class="m">11793</span>      0t0  TCP *:http <span class="o">(</span>LISTEN<span class="o">)</span>
  nginx   <span class="m">521</span> www-data    6u  IPv4  <span class="m">11792</span>      0t0  TCP *:http <span class="o">(</span>LISTEN<span class="o">)</span>
  nginx   <span class="m">521</span> www-data    7u  IPv6  <span class="m">11793</span>      0t0  TCP *:http <span class="o">(</span>LISTEN<span class="o">)</span>
  nginx   <span class="m">522</span> www-data    6u  IPv4  <span class="m">11792</span>      0t0  TCP *:http <span class="o">(</span>LISTEN<span class="o">)</span>
  nginx   <span class="m">522</span> www-data    7u  IPv6  <span class="m">11793</span>      0t0  TCP *:http <span class="o">(</span>LISTEN<span class="o">)</span>
  nginx   <span class="m">523</span> www-data    6u  IPv4  <span class="m">11792</span>      0t0  TCP *:http <span class="o">(</span>LISTEN<span class="o">)</span>
  nginx   <span class="m">523</span> www-data    7u  IPv6  <span class="m">11793</span>      0t0  TCP *:http <span class="o">(</span>LISTEN<span class="o">)</span>
  nginx   <span class="m">524</span> www-data    6u  IPv4  <span class="m">11792</span>      0t0  TCP *:http <span class="o">(</span>LISTEN<span class="o">)</span>
  nginx   <span class="m">524</span> www-data    7u  IPv6  <span class="m">11793</span>      0t0  TCP *:http <span class="o">(</span>LISTEN<span class="o">)</span>



Utilisation de commande lsof :

lsof -i           <span class="o">(</span>tous services internet TCP/UDP<span class="o">)</span>
lsof -i tcp      <span class="o">(</span>tous services TCP<span class="o">)</span>
lsof -i udp     <span class="o">(</span>tous services UDP<span class="o">)</span>
lsof -i tcp:80 <span class="o">(</span>services TCP sur port 80<span class="o">)</span>
lsof -i @56.85.68.98   <span class="o">(</span>liaison internet de mon poste avec 56.85.68.98<span class="o">)</span>
Afficher les fichiers ouverts par un processus :

lsof -p 1456
Afficher les connexions internet ouvertes par un processus :

lsof -i -p 1234
Pour connaître tous les ports réseau ouvert par le processus qui a le pid <span class="m">1234</span> <span class="o">(</span>-a est interprété comme AND<span class="o">)</span>

lsof -i -a -p 1234
La forme suivante de la commande permet de connaître tous les fichiers ouverts par l’utilisateur <span class="m">500</span> ou toto ou par le processus <span class="m">1234</span> ou <span class="m">12345</span> :

lsof -p 1234,12345 -u 500,toto
</pre></div>


<h3 id="336-nginx-web"><a name="user-content-336-nginx-web" href="#336-nginx-web" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3.6 Nginx web服务器</h3>
<p><code>service nginx {start|stop|status|restart|reload|configtest}</code></p>
<p><code>sudo nano /etc/nginx/sites-available/default</code></p>
<h3 id="337-python-paramiko"><a name="user-content-337-python-paramiko" href="#337-python-paramiko" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.3.7 python paramiko</h3>
<p>paramiko 遵循SSH2协议，支持以加密和认证的方式，进行远程服务器的连接，可以实现远程文件的上传，下载或通过ssh远程执行命令。<br />
<code>sudo apt-get install build-essential libssl-dev libffi-dev python3-dev</code></p>
<h2 id="34-conda-python"><a name="user-content-34-conda-python" href="#34-conda-python" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.4 Conda 管理 配置python环境</h2>
<h3 id="341-miniconda-bundled-with-python-3"><a name="user-content-341-miniconda-bundled-with-python-3" href="#341-miniconda-bundled-with-python-3" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.4.1 安装配置 Miniconda (bundled with Python 3)</h3>
<div class="codehilite"><pre>wget http://repo.continuum.io/miniconda/Miniconda3-latest-Linux-armv7l.sh
sudo md5sum Miniconda3-latest-Linux-armv7l.sh
sudo /bin/bash Miniconda3-latest-Linux-armv7l.sh
</pre></div>


<p>Prepending PATH=/home/pi/miniconda3/bin to PATH in /root/.bashrc<br />
A backup will be made to: /root/.bashrc-miniconda3.bak</p>
<p>将默认安装目录更改为</p>
<div class="codehilite"><pre><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">miniconda3</span>
<span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/.</span><span class="n">bashrc</span>
<span class="c1"># Bdd the following line to the end of the file</span>
<span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="s">&quot;/home/pi/miniconda3/bin:$PATH&quot;</span>

<span class="c1"># Save and close this file</span>
<span class="n">source</span> <span class="o">~/.</span><span class="n">bashrc</span>
<span class="n">python</span> <span class="o">-</span><span class="n">version</span>
<span class="c1"># Python 3.4.3 :: Continuum Analytics, Inc.</span>

<span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">pi</span> <span class="n">miniconda3</span>
<span class="n">conda</span> <span class="n">config</span> <span class="o">--</span><span class="nb">set</span> <span class="n">show_channel_urls</span> <span class="bp">True</span>
<span class="n">conda</span> <span class="n">config</span> <span class="o">--</span><span class="n">add</span> <span class="n">channels</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span>
<span class="n">conda</span> <span class="n">config</span> <span class="o">--</span><span class="n">add</span> <span class="n">channels</span> <span class="n">poppy</span><span class="o">-</span><span class="n">project</span>
<span class="n">conda</span> <span class="n">update</span> <span class="o">--</span><span class="nb">all</span> <span class="o">--</span><span class="n">yes</span>
<span class="n">conda</span> <span class="n">install</span> <span class="n">conda</span><span class="o">-</span><span class="n">build</span>
<span class="n">conda</span> <span class="n">install</span> <span class="n">anaconda</span><span class="o">-</span><span class="n">client</span>
<span class="n">conda</span> <span class="n">clean</span> <span class="o">-</span><span class="n">tipy</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">--</span><span class="n">yes</span> <span class="n">jinja2</span>
<span class="n">conda</span> <span class="n">config</span> <span class="o">--</span><span class="nb">set</span> <span class="n">anaconda_upload</span> <span class="n">yes</span>
<span class="n">conda</span> <span class="n">config</span> <span class="o">--</span><span class="nb">set</span> <span class="n">use_pip</span> <span class="n">false</span>
<span class="n">conda</span> <span class="n">config</span> <span class="o">--</span><span class="nb">set</span> <span class="n">show_channel_urls</span> <span class="n">true</span>
</pre></div>


<p><strong>配置Pyserial</strong></p>
<div class="codehilite"><pre><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">py2</span><span class="o">.</span><span class="mi">7</span> <span class="n">python</span><span class="o">=</span><span class="mf">2.7</span>
<span class="n">source</span> <span class="n">activate</span> <span class="n">py27</span>
<span class="c1"># 通过-c指定通过某个channel安装</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">pyserial</span>
</pre></div>


<p><strong>配置IPython Notebook</strong></p>
<div class="codehilite"><pre><span class="n">conda</span> <span class="n">install</span> <span class="n">ipython</span>
<span class="n">conda</span> <span class="n">install</span> <span class="n">jupyter</span>
<span class="n">jupyter</span> <span class="n">notebook</span>
</pre></div>


<h3 id="342"><a name="user-content-342" href="#342" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.4.2 参考命令</h3>
<h4 id="3421"><a name="user-content-3421" href="#3421" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.4.2.1 卸载</h4>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">~/</span><span class="n">miniconda3</span> <span class="o">~/.</span><span class="n">condarc</span> <span class="o">~/.</span><span class="n">conda</span> <span class="o">~/.</span><span class="n">continuum</span>
<span class="c1"># remove the anaconda directory from your PATH environment variable</span>
<span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/.</span><span class="n">bashrc</span>
<span class="n">source</span> <span class="o">~/.</span><span class="n">bashrc</span>
</pre></div>


<h4 id="3422"><a name="user-content-3422" href="#3422" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.4.2.2 常用命令</h4>
<div class="codehilite"><pre><span class="c1"># 查看列表</span>
<span class="n">conda</span> <span class="nb">list</span>

<span class="c1"># 更新</span>
<span class="n">conda</span> <span class="n">update</span> <span class="n">conda</span>

<span class="c1"># 环境</span>
<span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">env_vi</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.4</span><span class="o">.</span><span class="mi">3</span>
<span class="n">conda</span> <span class="n">env</span> <span class="nb">list</span>

<span class="c1"># 切换新环境</span>
<span class="n">source</span> <span class="n">activate</span> <span class="n">py27</span>
<span class="c1"># 退出环境，也可以使用`activate root`切回root环境</span>
<span class="n">source</span> <span class="n">activate</span> <span class="n">root</span>
<span class="n">source</span> <span class="n">deactivate</span> <span class="n">py27</span>
<span class="c1"># 移除环境</span>
<span class="n">conda</span> <span class="n">remove</span> <span class="o">--</span><span class="nb">all</span> <span class="o">-</span><span class="n">n</span> <span class="n">py27</span>
<span class="c1"># 创建只有django的python2环境，名字py2-dj，注意，python=2 django是连续参数</span>
<span class="n">conda</span> <span class="n">create</span> <span class="n">python</span><span class="o">=</span><span class="mi">2</span> <span class="n">django</span> <span class="o">-</span><span class="n">n</span> <span class="n">py2</span><span class="o">-</span><span class="n">dj</span>
</pre></div>


<hr />
<h3 id="343-python"><a name="user-content-343-python" href="#343-python" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.4.3 python 库</h3>
<h4 id="3431-simplejson"><a name="user-content-3431-simplejson" href="#3431-simplejson" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.4.3.1 simplejson</h4>
<div class="codehilite"><pre> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">simplejson</span><span class="o">/</span><span class="n">simplejson</span><span class="o">.</span><span class="n">git</span>
 <span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>


<h2 id="35"><a name="user-content-35" href="#35" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3.5 云打印机</h2>
<p>installing CUPS</p>
<div class="codehilite"><pre>sudo apt-get update
sudo apt-get install cups
<span class="c1"># The usergroup created by CUPS is “lpadmin”. The default Rasbian user (and the user we’re logged into) is “pi” (adjust the following command accordingly if you want a different user to have access to the printer).</span>
sudo usermod -a -G lpadmin pi
</pre></div>


<p>For the curious, the “-a” switch allows us to add an existing user (pi) to an existing group (lpadmin), specified by the “-G” switch.</p>
<p>The rest of the configuration can be completed via the web browser on the Pi, but if you’re not actually sitting right at the Pi and would prefer to use, say, the browser on your Windows desktop to complete the configuration, you’ll need to toggle a small value in /etc/cups/cupsd.conf. At the terminal, enter the following command:</p>
<div class="codehilite"><pre>sudo nano /etc/cups/cupsd.conf
</pre></div>


<p>Comment out the “Listen localhost:631” line and replace it with the following:</p>
<div class="codehilite"><pre><span class="c1"># Only listen for connections from the local machine</span>
<span class="c1"># Listen localhost:631</span>
<span class="n">Port</span> <span class="mi">631</span>
</pre></div>


<p>Inside the file, look for this section:</p>
<div class="codehilite"><pre><span class="o">&lt;</span> <span class="n">Location</span> <span class="o">/</span> <span class="o">&gt;</span>
<span class="c1"># Restrict access to the server...</span>
<span class="n">Order</span> <span class="n">allow</span><span class="p">,</span><span class="n">deny</span>
<span class="n">Allow</span> <span class="nd">@local</span>
<span class="o">&lt;</span> <span class="o">/</span><span class="n">Location</span> <span class="o">&gt;</span>

<span class="o">&lt;</span> <span class="n">Location</span> <span class="o">/</span><span class="n">admin</span> <span class="o">&gt;</span>
<span class="c1"># Restrict access to the admin pages...</span>
<span class="n">Order</span> <span class="n">allow</span><span class="p">,</span><span class="n">deny</span>
<span class="n">Allow</span> <span class="nd">@local</span>
<span class="n">Allow</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>
<span class="o">&lt;</span> <span class="o">/</span><span class="n">Location</span> <span class="o">&gt;</span>

<span class="o">&lt;</span> <span class="n">Location</span> <span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">conf</span> <span class="o">&gt;</span>
<span class="n">AuthType</span> <span class="n">Default</span>
<span class="n">Require</span> <span class="n">user</span> <span class="nd">@SYSTEM</span>

<span class="c1"># Restrict access to the configuration files...</span>
<span class="n">Order</span> <span class="n">allow</span><span class="p">,</span><span class="n">deny</span>
<span class="n">Allow</span> <span class="nd">@local</span>
<span class="o">&lt;</span> <span class="o">/</span><span class="n">Location</span> <span class="o">&gt;</span>
</pre></div>


<p>The addition of the “allow @local” line allows access to CUPS from any computer on your local network. Anytime you make changes to the CUPS configuration file, you’ll need to restart the CUPS server. Do so with the following command:</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">cups</span> <span class="n">restart</span>

<span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="n">INPUT</span> <span class="o">-</span><span class="n">i</span> <span class="n">wlan0</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">m</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">631</span> <span class="o">-</span><span class="n">j</span> <span class="n">ACCEPT</span>
<span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="n">INPUT</span> <span class="o">-</span><span class="n">i</span> <span class="n">wlan0</span> <span class="o">-</span><span class="n">p</span> <span class="n">udp</span> <span class="o">-</span><span class="n">m</span> <span class="n">udp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">631</span> <span class="o">-</span><span class="n">j</span> <span class="n">ACCEPT</span>
</pre></div>


<p>电脑连接<br />
<a href="http://192.168.1.111:631/printers/Vi.Canon">http://192.168.1.111:631/printers/Vi.Canon</a></p>
<p>注册为谷歌print</p>
<div class="codehilite"><pre><span class="c1"># 安装</span>
git clone https://github.com/armooo/cloudprint.git
sudo apt-get install libcups2-dev
sudo pip3 install pycups
apt-get install python-cups
sudo apt-get install python3-dev
sudo pip install daemon
<span class="c1"># sudo python setup.py install</span>
sudo pip install cloudprint
</pre></div>


<p>cloudprint-service</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">cloudprint</span><span class="o">-</span><span class="n">service</span>
<span class="n">echo</span> <span class="s">&quot;deb http://davesteele.github.io/cloudprint-service/repo cloudprint-jessie main&quot;</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">tee</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">sources</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">cloudprint</span><span class="o">.</span><span class="n">list</span>
<span class="n">wget</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">O</span> <span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">davesteele</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">key</span><span class="o">-</span><span class="mi">366150</span><span class="n">CE</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">txt</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">key</span> <span class="n">add</span> <span class="o">-</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
</pre></div>


<p>Install the software. This will likely involve more than 40 packages.</p>
<div class="codehilite"><pre>sudo apt-get -y upgrade
sudo apt-get -y install cloudprint-service
</pre></div>


<p>Make the CUPS web page externally accessible.</p>
<div class="codehilite"><pre>sudo cupsctl --remote-admin
sudo usermod -a -G lpadmin pi
sudo systemctl restart cups
</pre></div>


<h1 id="_1"><a name="user-content-_1" href="#_1" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>配置</h1>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">cps</span><span class="o">-</span><span class="n">auth</span>
</pre></div>


<p>The output of the cps_auth command will include a URL. Copy this URL to your browser, and use it to establish authentication.</p>
<p>Now restart the cloudprint service to use this account.</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">cloudprintd</span>
<span class="n">sudo</span> <span class="n">cupsctl</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">remote</span><span class="o">-</span><span class="n">admin</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">cups</span>
</pre></div>


<div class="codehilite"><pre>sudo nano /etc/resolv.conf.head
nano /etc/resolv.conf
</pre></div>


<p>in your terminal. You will have a blank slate to work with. Next copy and paste the following code:</p>
<div class="codehilite"><pre><span class="c1"># Google Servers</span>
<span class="n">nameserver</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span>
<span class="n">nameserver</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">4.4</span>
</pre></div>


<p>click on cntrl + x to exit out and select y for the following options to save. Restart your Raspberry Pi with</p>
<p><div class="codehilite"><pre>sudo reboot
sudo systemctl restart cloudprintd
</pre></div>
<br />
ios<br />
sudo apt-get install avahi-discover</p>
<p>扫描</p>
<div class="codehilite"><pre><span class="n">scanimage</span> <span class="o">-</span><span class="n">L</span>
<span class="n">sudo</span> <span class="n">aptitude</span> <span class="n">install</span> <span class="n">xsane</span>
<span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sane</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">saned</span><span class="o">.</span><span class="n">conf</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">xsane</span> <span class="n">skanlite</span>
</pre></div>


<p>sudo nano /etc/sane.d/saned.conf<br />
192.168.1.0/24<br />
sudo nano /etc/default/saned<br />
RUN=no</p>
<p>sane-find-scanner<br />
sudo adduser saned lp</p>
<p>sudo systemctl start saned.socket<br />
sudo systemctl enable saned.socket<br />
sudo systemctl status saned.socket</p>
<p>关于打印速度的讨论</p>
<p>在实际使用中，发现Windows PC打印速度快，即提交打印任务后打印立即开始，而使用iOS设备发送打印任务之后存在较长的等待时间才会开始打印。在研究造成该问题的原因之前，我们需要知道CUPS共享打印机的原理是什么。 CUPS使用原生驱动，可将多种类型的文件，如PDF，PostScript文件直接渲染成打印机支持的二进制文件。CUPS同时也支持将原始二进制流直接传送至打印机，而无需做本地文件渲染。CUPS对于输入文件流类型的支持可在mime.convs与mime.types两个文件中进行设置。 由于在Windows上安装了打印机的原生驱动，渲染操作在客户端已经完成，CUPS只需要将原始二进制流不经更改地传送给打印机，因此基本无需等待时间。而iOS使用AirPrint的原理则为将各种类型的文本图像先生成PDF文档，再将PDF传送至AirPrint打印服务器。而AirPrint服务器在收到该PDF文档后仍需要将文件渲染成打印机支持的二进制流，再将该流传送至打印机设备。因此在使用iOS进行AirPrint时实际需要对原始文件进行两次转换。同时，受到iOS与Raspberry Pi的处理能力限制，两次转换的效率很大程度上取决于原始文件的大小与复杂度。</p>
<hr />
<h1 id="4-raspberry-arduino"><a name="user-content-4-raspberry-arduino" href="#4-raspberry-arduino" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4 Raspberry 和 Arduino 串口通信</h1>
<h2 id="41"><a name="user-content-41" href="#41" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.1 配置协议</h2>
<p>安装python</p>
<p>sudo aptitude install python-dev</p>
<p>安装python的GPIO模块</p>
<p>sudo apt-get install python-dev python-rpi.gpio</p>
<p>安装serial用于串口通信及USB通信</p>
<p>sudo apt-get install python-serial</p>
<p>在树莓派安装串口调试工具</p>
<p>sudo apt-get install minicom<br />
配置minicom：</p>
<p>sudo minicom -s<br />
启动出现配置菜单选 <strong>serial port setup</strong> 进入串口配置<br />
输入A 配置串口驱动为</p>
<p>/dev/ttyAMA0<br />
输入E 配置速率为</p>
<p>9600 8N1<br />
输入F 将 Hardware Flow Control 设为 NO<br />
回车 退出</p>
<p>由于我们使用minicom作为超级终端控制路由器等设备, 而不是控制modem, 所以需要修改 <strong>Modem and dialing</strong></p>
<p>将以下设置为空<br />
  A. Init string,<br />
  B. Reset string,<br />
  k. Hang-up string.<br />
设置完成后选择Save setup as dfl将当前设置保存为默认设置</p>
<p>Exit from minicon<br />
命令minicom是进入串口超级终端画面，而minicom -s为配置minicom。说明/dev/ttyAMA0 对应为串口0 为你连接开发板的端口<br />
接下来测一下环境是否都OK：</p>
<p>sudo nano test.py<br />
输入内容为：</p>
<p>import serial<br />
  import RPi.GPIO</p>
<p>Ctrl +X 保存退出执行</p>
<p>python test.py<br />
没有报错，说明正确安装python-serial等。</p>
<p>插上arduino与树莓派USB口：</p>
<div class="codehilite"><pre><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: latin-1 -*-</span>

<span class="kn">import</span> <span class="nn">serial</span>
<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s">&#39;/dev/ttyACM0&#39;</span><span class="p">,</span> <span class="mi">9600</span><span class="p">)</span>
<span class="k">while</span> <span class="mi">1</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
</pre></div>


<h2 id="42-json"><a name="user-content-42-json" href="#42-json" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.2 Json解码</h2>
<p>添加一个开关Triger object，方便判断json文件的来源</p>
<div class="codehilite"><pre><span class="n">void</span> <span class="n">jsonBuffer</span><span class="p">(</span><span class="n">unsigned</span> <span class="nb">long</span> <span class="n">ti</span><span class="p">,</span> <span class="nb">int</span> <span class="n">di</span><span class="p">,</span> <span class="nb">int</span> <span class="n">te</span><span class="p">,</span> <span class="nb">int</span> <span class="n">hu</span><span class="p">,</span> <span class="nb">int</span> <span class="n">li</span><span class="p">)</span> <span class="p">{</span>
<span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="mi">66</span><span class="o">&gt;</span> <span class="n">jsonBuffer</span><span class="p">;</span>
<span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">rootB</span> <span class="o">=</span> <span class="n">jsonBuffer</span><span class="o">.</span><span class="n">createObject</span><span class="p">();</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Triger&quot;</span><span class="p">]</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Time&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">ti</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">di</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Temperature&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">te</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Humity&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">hu</span><span class="p">;</span>
<span class="n">rootB</span><span class="p">[</span><span class="s">&quot;Light&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">li</span><span class="p">;</span>
<span class="n">rootB</span><span class="o">.</span><span class="n">prettyPrintTo</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
<span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">joyStick</span><span class="p">(</span><span class="nb">int</span> <span class="n">swich</span><span class="p">,</span><span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">,</span><span class="nb">int</span> <span class="n">ir</span><span class="p">){</span>
<span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="mi">66</span><span class="o">&gt;</span> <span class="n">joyStick</span><span class="p">;</span>
<span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">rootS</span> <span class="o">=</span> <span class="n">joyStick</span><span class="o">.</span><span class="n">createObject</span><span class="p">();</span>
<span class="n">rootS</span><span class="p">[</span><span class="s">&quot;Triger&quot;</span><span class="p">]</span> <span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">rootS</span><span class="p">[</span><span class="s">&quot;IR&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">ir</span><span class="p">;</span>
<span class="n">rootS</span><span class="p">[</span><span class="s">&quot;Swich&quot;</span><span class="p">]</span> <span class="o">=</span><span class="n">swich</span><span class="p">;</span>
<span class="n">JsonArray</span><span class="o">&amp;</span> <span class="n">Stick</span><span class="o">=</span> <span class="n">rootS</span><span class="o">.</span><span class="n">createNestedArray</span><span class="p">(</span><span class="s">&quot;Stick&quot;</span><span class="p">);</span>
<span class="n">Stick</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="n">Stick</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="n">rootS</span><span class="o">.</span><span class="n">prettyPrintTo</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
<span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<p>从串口获取数据</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">serial</span>
<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s">&#39;/dev/ttyACM0&#39;</span><span class="p">,</span> <span class="mi">9600</span><span class="p">)</span>
<span class="k">while</span> <span class="mi">1</span> <span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
</pre></div>


<p>解码Json</p>
<p>If we prefer working with files instead of strings, we may want to use json.dump() / json.load() to encode / decode JSON data</p>
<p>示例</p>
<div class="codehilite"><pre><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: unicode -*-</span>

<span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="c1"># Port s  rie ttyACM0</span>
<span class="c1"># Vitesse de baud : 9600</span>
<span class="c1"># Timeout en lecture : 1 sec</span>
<span class="c1"># Timeout en   criture : 1 sec</span>

<span class="k">with</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="s">&quot;/dev/ttyACM0&quot;</span><span class="p">,</span> <span class="n">baudrate</span><span class="o">=</span><span class="mi">9600</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">writeTimeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">poSer</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">poSer</span><span class="o">.</span><span class="n">isOpen</span><span class="p">():</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="c1">#poSer.write([time.time()])</span>
            <span class="n">rawLigne</span> <span class="o">=</span> <span class="n">poSer</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">rawLigne</span><span class="p">)</span>
            <span class="n">tempData</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">rawLigne</span><span class="p">)</span>
            <span class="c1">#tempData[&quot;Triger&quot;] # will return &#39;blabla&#39;</span>
            <span class="k">print</span><span class="p">(</span><span class="n">tempData</span><span class="p">)</span>

<span class="c1"># data[&quot;masks&quot;][&quot;id&quot;]    # will return &#39;valore&#39;</span>
<span class="c1"># data[&quot;om_points&quot;]      # will return &#39;value&#39;</span>
</pre></div>


<p>尝试</p>
<p>从串口获取的数据类型</p>
<div class="codehilite"><pre><span class="p">{</span>
  <span class="nt">&quot;Triger&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;Time&quot;</span><span class="p">:</span> <span class="mi">1504611032</span><span class="p">,</span>
  <span class="nt">&quot;Distance&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="nt">&quot;Temperature&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
  <span class="nt">&quot;Humity&quot;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
  <span class="nt">&quot;Light&quot;</span><span class="p">:</span> <span class="mi">103</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="nt">&quot;Triger&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;IR&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;Swich&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;Stick&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="mi">499</span><span class="p">,</span>
    <span class="mi">510</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>


<div class="codehilite"><pre><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s">&#39;/dev/ttyACM0&#39;</span><span class="p">,</span> <span class="mi">9600</span><span class="p">)</span>
<span class="k">while</span> <span class="n">ser</span><span class="o">.</span><span class="n">isOpen</span><span class="p">():</span>
    <span class="n">rawLigne</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="c1">#print len(rawLigne)</span>
    <span class="n">stringLength</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rawLigne</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">stringLength</span><span class="o">==</span><span class="mi">57</span> <span class="ow">or</span> <span class="n">stringLength</span><span class="o">==</span><span class="mi">58</span> <span class="ow">or</span> <span class="n">stringLength</span><span class="o">==</span><span class="mi">59</span> <span class="ow">or</span> <span class="n">stringLength</span><span class="o">==</span><span class="mi">60</span> <span class="ow">or</span> <span class="n">stringLength</span><span class="o">==</span><span class="mi">61</span> <span class="ow">or</span> <span class="n">stringLength</span><span class="o">==</span><span class="mi">62</span> <span class="ow">or</span> <span class="n">stringLength</span><span class="o">==</span><span class="mi">86</span><span class="p">):</span>
      <span class="n">tempeData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">rawLigne</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tempeData</span><span class="p">[</span><span class="s">&quot;Triger&quot;</span><span class="p">]):</span>
        <span class="k">print</span> <span class="n">tempeData</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;6 variables&#39;</span><span class="p">)</span>
</pre></div>


<p>改进代码</p>
<div class="codehilite"><pre><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s">&#39;/dev/ttyACM0&#39;</span><span class="p">,</span> <span class="mi">9600</span><span class="p">)</span>
<span class="k">while</span> <span class="n">ser</span><span class="o">.</span><span class="n">isOpen</span><span class="p">():</span>
    <span class="n">rawLigne</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="c1">#print len(rawLigne)</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">tempeData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">rawLigne</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tempeData</span><span class="p">[</span><span class="s">&quot;Triger&quot;</span><span class="p">]):</span>
        <span class="k">print</span> <span class="n">tempeData</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;==&gt;&#39;</span><span class="p">,</span> <span class="n">tempeData</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="c1"># do nothing, not a valid JSON</span>
      <span class="k">pass</span>
</pre></div>


<h2 id="43-mongodb"><a name="user-content-43-mongodb" href="#43-mongodb" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.3 mongodb 数据库</h2>
<div class="codehilite"><pre><span class="hll">&lt;!-- win --&gt;
</span>choco install mongodb

&lt;!-- Raspbian --&gt;
sudo apt install mongodb
</pre></div>


<h2 id="44-django"><a name="user-content-44-django" href="#44-django" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.4 Django 框架</h2>
<h3 id="441"><a name="user-content-441" href="#441" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.4.1 初始化</h3>
<ul>
<li>安装各种框架</li>
</ul>
<div class="codehilite"><pre><span class="hll"><span class="c1">#最后支持py2.7的版本</span>
</span><span class="n">pip</span> <span class="n">install</span> <span class="n">Django</span><span class="o">==</span><span class="mf">1.11</span><span class="o">.</span><span class="mi">10</span>

<span class="c1">#Restful API</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">djangorestframework</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">markdown</span>
<span class="c1"># Filtering support</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">django</span><span class="o">-</span><span class="nb">filter</span>

<span class="c1">#mongodb database</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">mongoengine</span>

<span class="c1">#PY time zone</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">pytz</span>
</pre></div>


<ul>
<li>创建项目和app</li>
</ul>
<div class="codehilite"><pre><span class="hll"><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">startproject</span> <span class="n">pi</span>
</span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">startapp</span> <span class="n">sensors</span>

<span class="c1"># 管理员用户</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">createsuperuser</span>
</pre></div>


<ul>
<li>初始化数据库链表</li>
</ul>
<div class="codehilite"><pre><span class="hll"><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>
</span></pre></div>


<ul>
<li>初始化app链表</li>
</ul>
<div class="codehilite"><pre><span class="hll"><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span> <span class="n">sensors</span>
</span></pre></div>


<div class="admonition hint">
<p>If you ：<br />
- edit your models.py file in order to add, remove, <br />
- change fields of existing models, <br />
- add new models, <br />
You will have to: <br />
- 1. make a new migration using the <code>python manage.py makemigrations sensors</code>. The migration will allow Django to keep track of model changes. <br />
- 2. Then you will have to apply it with the <code>python manage.py migrate</code> to keep the database in sync with your models.</p>
</div>
<ul>
<li>运行调试</li>
</ul>
<div class="codehilite"><pre><span class="hll"><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">runserver</span>
</span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">shell</span>
</pre></div>


<p>curl.exe -u lencshu:169088@Dj -X POST -d &ldquo;temperature=1&amp;distance=1&rdquo; <a href="http://127.0.0.1:8000/api/subjects/">http://127.0.0.1:8000/api/subjects/</a></p>
<h3 id="442"><a name="user-content-442" href="#442" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.4.2 配置项目</h3>
<div class="codehilite"><pre><span class="hll"><span class="c1">#apps</span>
</span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s">&#39;rest_framework&#39;</span><span class="p">,</span>
    <span class="s">&#39;sensors&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="hll"><span class="c1">#Timezone</span>
</span><span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s">&#39;Europe/Paris&#39;</span>

<span class="hll"><span class="c1">#Restframework</span>
</span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Use Django&#39;s standard `django.contrib.auth` permissions,</span>
    <span class="c1"># or allow read-only access for unauthenticated users.</span>
    <span class="s">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">&#39;rest_framework.permissions.DjangoModelPermissionsOrAnonReadOnly&#39;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>


<h3 id="443-app"><a name="user-content-443-app" href="#443-app" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.4.3 App配置</h3>
<p><strong>models.py</strong></p>
<div class="codehilite"><pre><span class="hll"><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span class="c1"># from __future__ import unicode_literals</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Create your models here.</span>

<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="c1"># from django.contrib.auth.models import User</span>
<span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">humity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">light</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;-title&#39;</span><span class="p">,</span><span class="s">&#39;-temperature&#39;</span><span class="p">)</span>
</pre></div>


<p><strong>views.py</strong></p>
<div class="codehilite"><pre><span class="hll"><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="c1"># Create your views here.</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span> 
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Data</span>

<span class="k">def</span> <span class="nf">data_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">posts</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> 
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s">&#39;list.html&#39;</span><span class="p">,{</span><span class="s">&#39;posts&#39;</span><span class="p">:</span> <span class="n">posts</span><span class="p">})</span>
</pre></div>


<p><strong>模板配置—list.html&amp;base.html</strong></p>
<p><strong>配置—urls.py</strong></p>
<p><strong>App Urls</strong></p>
<div class="codehilite"><pre><span class="hll"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span> 
</span><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># post views</span>
        <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">data_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;data_list&#39;</span><span class="p">),</span> 
<span class="p">]</span>
</pre></div>


<p><strong>项目urls</strong></p>
<div class="codehilite"><pre><span class="hll"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
</span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="c1"># url(r&#39;^api-auth/&#39;, include(&#39;rest_framework.urls&#39;)),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^s/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;sensors.urls&#39;</span><span class="p">,</span><span class="n">namespace</span><span class="o">=</span><span class="s">&#39;sensors&#39;</span><span class="p">,</span><span class="n">app_name</span><span class="o">=</span><span class="s">&#39;sensors&#39;</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^api/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;sensors.api.urls&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">&#39;api&#39;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>


<p><strong>配置admin.py</strong></p>
<div class="codehilite"><pre><span class="hll"><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="c1"># Register your models here.</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Data</span>

<span class="k">class</span> <span class="nc">DataAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;distance&#39;</span><span class="p">,</span> <span class="s">&#39;temperature&#39;</span><span class="p">,</span> <span class="s">&#39;humity&#39;</span><span class="p">,</span> <span class="s">&#39;light&#39;</span><span class="p">)</span>
    <span class="n">date_hierarchy</span> <span class="o">=</span> <span class="s">&#39;title&#39;</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;-title&#39;</span><span class="p">,</span><span class="s">&#39;-temperature&#39;</span><span class="p">]</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">DataAdmin</span><span class="p">)</span>
</pre></div>


<h3 id="444-restful-api"><a name="user-content-444-restful-api" href="#444-restful-api" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.4.4 RESTful API</h3>
<p><strong>Views</strong></p>
<div class="codehilite"><pre><span class="hll"><span class="ch">#!/usr/bin/env python</span>
</span><span class="c1">#-*- coding: utf-8 -*- </span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">JsonResponse</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_exempt</span>
<span class="kn">from</span> <span class="nn">rest_framework.renderers</span> <span class="kn">import</span> <span class="n">JSONRenderer</span>
<span class="kn">from</span> <span class="nn">rest_framework.parsers</span> <span class="kn">import</span> <span class="n">JSONParser</span>
<span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Data</span>
<span class="kn">from</span> <span class="nn">.serializers</span> <span class="kn">import</span> <span class="n">SubjectSerializer</span>

<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">data_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># List all code snippets, or create a new data.</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">datas</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">SubjectSerializer</span><span class="p">(</span><span class="n">datas</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">JSONParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">SubjectSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">data_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="c1"># Retrieve, update or delete a code datas.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">datas</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Data</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">SubjectSerializer</span><span class="p">(</span><span class="n">datas</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;PUT&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">JSONParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">SubjectSerializer</span><span class="p">(</span><span class="n">datas</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;DELETE&#39;</span><span class="p">:</span>
        <span class="n">datas</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">204</span><span class="p">)</span>
</pre></div>


<p><strong>序列化</strong></p>
<div class="codehilite"><pre><span class="hll"><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span> 
</span><span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Data</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">datetime</span><span class="o">,</span><span class="nn">pytz</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="c1"># def parisnow():</span>
    <span class="c1"># return datetime.datetime.now(tz=pytz.timezone(&quot;Europe/Paris&quot;)).isoformat()1</span>

<span class="k">class</span> <span class="nc">SubjectSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span> 
    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">humity</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">light</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="c1">#Create and return a new `Subject` instance, given the validated data.</span>
        <span class="k">return</span> <span class="n">Data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>

        <span class="c1"># Update and return an existing `Snippet` instance, given the validated data.</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="c1"># instance.title = validated_data.get(&#39;title&#39;, parisnow())</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;distance&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;temperature&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">humity</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;humity&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">humity</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">light</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;light&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">light</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">instance</span>
</pre></div>


<p><strong>URLs</strong></p>
<div class="codehilite"><pre><span class="hll"><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span> 
</span><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^api/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">data_list</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^api/(?P&lt;pk&gt;[0-9]+)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">data_detail</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>


<h3 id="445-arduino"><a name="user-content-445-arduino" href="#445-arduino" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.4.5 与Arduino对接</h3>
<div class="codehilite"><pre><span class="hll"><span class="ch">#!/usr/bin/env python</span>
</span><span class="c1">#-*- coding: utf-8 -*- </span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">datetime</span><span class="o">,</span><span class="nn">pytz</span>
<span class="kn">import</span> <span class="nn">django</span>
<span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s">&quot;pi.settings&quot;</span><span class="p">)</span>
<span class="n">django</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">sensors.models</span> <span class="kn">import</span> <span class="n">Data</span>
<span class="k">def</span> <span class="nf">parisnow</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s">&quot;Europe/Paris&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="n">timeDelay</span><span class="o">=</span><span class="mi">0</span>

<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s">&#39;/dev/ttyACM0&#39;</span><span class="p">,</span> <span class="mi">9600</span><span class="p">)</span>
<span class="k">while</span> <span class="n">ser</span><span class="o">.</span><span class="n">isOpen</span><span class="p">():</span>
    <span class="n">rawLigne</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="c1">#print len(rawLigne)</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">tempeData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">rawLigne</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tempeData</span><span class="p">[</span><span class="s">&quot;Triger&quot;</span><span class="p">]):</span>
        <span class="k">print</span> <span class="n">tempeData</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tempeData</span><span class="p">[</span><span class="s">&quot;Humity&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">timeDelay</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">timeDelay</span><span class="o">&gt;=</span><span class="mi">10</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Saved to database&#39;</span>
                <span class="n">Data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">parisnow</span><span class="p">(),</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">tempeData</span><span class="p">[</span><span class="s">&quot;Distance&quot;</span><span class="p">],</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">tempeData</span><span class="p">[</span><span class="s">&quot;Temperature&quot;</span><span class="p">],</span><span class="n">humity</span> <span class="o">=</span> <span class="n">tempeData</span><span class="p">[</span><span class="s">&quot;Humity&quot;</span><span class="p">],</span><span class="n">light</span> <span class="o">=</span> <span class="n">tempeData</span><span class="p">[</span><span class="s">&quot;Light&quot;</span><span class="p">])</span>
                <span class="n">timeDelay</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="c1"># do nothing, not a valid JSON</span>
      <span class="k">pass</span>
</pre></div>


<h3 id="446-vps"><a name="user-content-446-vps" href="#446-vps" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.4.6 与vps对接</h3>
<p>数据格式<br />
<code>{"title": "2018-02-20T23:49:16.202497+01:00", "distance": 2, "temperature": 16, "humity": 37, "light": 47}</code></p>
<div class="codehilite"><pre><span class="hll"><span class="ch">#!/usr/bin/env python</span>
</span><span class="c1">#-*- coding: utf-8 -*- </span>

<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://127.0.0.1:8000/api/&quot;</span>
<span class="n">payload</span> <span class="o">=</span> <span class="s">&#39;{&quot;title&quot;: &quot;2018-02-20T23:52:16.202497+01:00&quot;, &quot;distance&quot;: 2, &quot;temperature&quot;: 16, &quot;humity&quot;: 37, &quot;light&quot;: 47}&#39;</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span>
    <span class="s">&#39;Cache-Control&#39;</span><span class="p">:</span> <span class="s">&quot;no-cache&quot;</span><span class="p">,</span>
    <span class="s">&#39;Postman-Token&#39;</span><span class="p">:</span> <span class="s">&quot;64fb7111-5dfd-de0d-cc5e-eb4c063a9486&quot;</span>
    <span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>


<h3 id="447"><a name="user-content-447" href="#447" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.4.7 图表</h3>
<p>pip install django-highcharts</p>
<h3 id="448"><a name="user-content-448" href="#448" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.4.8 部署</h3>
<p>sudo apt-get install nginx <br />
pip install gunicorn  </p>
<p>sudo nginx -t</p>
<div class="codehilite"><pre><span class="hll"><span class="nt">events</span> <span class="p">{</span>
</span>  <span class="n">worker_connections</span> <span class="m">1024</span><span class="p">;</span> 
  <span class="n">accept_mutex</span> <span class="n">off</span><span class="p">;</span> 
<span class="p">}</span>
<span class="nt">http</span> <span class="p">{</span>
    <span class="n">server</span> <span class="err">{</span>
        <span class="n">listen</span> <span class="m">80</span><span class="p">;</span>
        <span class="n">access_log</span>  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">example</span><span class="o">.</span><span class="n">log</span><span class="p">;</span>

        <span class="n">location</span> <span class="o">/</span> <span class="err">{</span>
            <span class="n">proxy_pass</span> <span class="n">http</span><span class="o">://</span><span class="m">127</span><span class="o">.</span><span class="m">0</span><span class="o">.</span><span class="m">0</span><span class="o">.</span><span class="m">1</span><span class="o">:</span><span class="m">8000</span><span class="p">;</span>
            <span class="n">proxy_set_header</span> <span class="n">Host</span> <span class="err">$</span><span class="n">host</span><span class="p">;</span>
            <span class="n">proxy_set_header</span> <span class="n">X</span><span class="o">-</span><span class="n">Real</span><span class="o">-</span><span class="n">IP</span> <span class="err">$</span><span class="n">remote_addr</span><span class="p">;</span>
            <span class="n">proxy_set_header</span> <span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">For</span> <span class="err">$</span><span class="n">proxy_add_x_forwarded_for</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nt">location</span> <span class="o">/</span><span class="nt">static</span><span class="o">/</span> <span class="p">{</span>
            <span class="n">root</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">Django</span><span class="o">/</span><span class="p">;</span> 
        <span class="p">}</span>
    <span class="err">}</span>
<span class="err">}</span>
</pre></div>


<div class="codehilite"><pre><span class="hll"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
</span>    <span class="c1"># ...</span>
    <span class="s">&#39;gunicorn&#39;</span><span class="p">,</span>
<span class="p">)</span>



<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.111</span><span class="p">]</span>
</pre></div>


<p>gunicorn &ndash;chdir /home/pi/Django/ pi.wsgi:application</p>
<p>sudo nano /etc/init.d/rc.local<br />
nohup gunicorn &ndash;chdir /home/pi/Django/ pi.wsgi:application &amp;</p>
<h2 id="45-python-flask-restful-api"><a name="user-content-45-python-flask-restful-api" href="#45-python-flask-restful-api" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4.5 使用 Python 和 Flask 设计 RESTful API</h2>
<p>什么是 REST？<br />
六条设计规范定义了一个 REST 系统的特点:</p>
<p>客户端-服务器: 客户端和服务器之间隔离，服务器提供服务，客户端进行消费。<br />
无状态: 从客户端到服务器的每个请求都必须包含理解请求所必需的信息。换句话说， 服务器不会存储客户端上一次请求的信息用来给下一次使用。<br />
可缓存: 服务器必须明示客户端请求能否缓存。<br />
分层系统: 客户端和服务器之间的通信应该以一种标准的方式，就是中间层代替服务器做出响应的时候，客户端不需要做任何变动。<br />
统一的接口: 服务器和客户端的通信方法必须是统一的。<br />
按需编码: 服务器可以提供可执行代码或脚本，为客户端在它们的环境中执行。这个约束是唯一一个是可选的。<br />
什么是一个 RESTful 的 web service？<br />
REST 架构的最初目的是适应万维网的 HTTP 协议。</p>
<p>RESTful web services 概念的核心就是“资源”。 资源可以用 URI 来表示。客户端使用 HTTP 协议定义的方法来发送请求到这些 URIs，当然可能会导致这些被访问的”资源“状态的改变。</p>
<p>HTTP 标准的方法有如下:</p>
<p>==========  =====================  ==================================<br />
HTTP 方法   行为                   示例<br />
==========  =====================  ==================================<br />
GET         获取资源的信息         <a href="http://example.com/api/orders">http://example.com/api/orders</a><br />
GET         获取某个特定资源的信息 <a href="http://example.com/api/orders/123">http://example.com/api/orders/123</a><br />
POST        创建新资源             <a href="http://example.com/api/orders">http://example.com/api/orders</a><br />
PUT         更新资源               <a href="http://example.com/api/orders/123">http://example.com/api/orders/123</a><br />
DELETE      删除资源               <a href="http://example.com/api/orders/123">http://example.com/api/orders/123</a><br />
==========  ====================== ==================================<br />
REST 设计不需要特定的数据格式。在请求中数据可以以 JSON 形式, 或者有时候作为 url 中查询参数项。</p>
<p>安装flask</p>
<div class="codehilite"><pre><span class="hll"><span class="n">pip</span> <span class="n">install</span> <span class="n">flask</span>
</span></pre></div>


<hr />
<h1 id="5-arduino"><a name="user-content-5-arduino" href="#5-arduino" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>5 Arduino 四轴飞行器</h1>
<h2 id="51-i2c"><a name="user-content-51-i2c" href="#51-i2c" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>5.1 I2C通讯</h2>
<p>内部集成电路（I2C）协议是双向双线串行总线，其提供集成电路之间的通信链路。</p>
<p>I2C是使主设备（例如处理器，微控制器（MCU）或专用集成电路（ASIC））能够与同一双线总线上的其它外围设备通信的流行通信协议。一条线专用于数据传输，而另一条用于时钟信号。想象它就像一个双车道公路：每个车道都有汽车从一端流向另一端，就像数据包将从主设备（处理器、MCU、ASIC）传输到外围设备（温度传感器、湿度传感器及其它设备）。</p>
<p>I2C可以在同一总线上轻松实现多个外设 - 例如，使用各种传感器来监视服务器的温度。I2C协议实际上设计用于在单个总线上支持多个设备，而如串行外设接口（SPI）的其他协议的设计用于点对点单设备支持。双线I2C接口还可以帮助简化对四线SPI接口的布线，并减少通用输入/输出（GPIO）。</p>
<p>I2C使系统设计人员能够轻松实现鲁棒的系统控制。</p>
<h3 id="511-gy-80"><a name="user-content-511-gy-80" href="#511-gy-80" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>5.1.1 GY-80 模块</h3>
<p>There are four sensors on this board: <br />
-角速度计 3 axis gyroscope from ST (L3G4200D), I2C Address: 0x69 <br />
-加速度计 3 axis accelerometer from Analog Devices (ADXL345), I2C Address:  0x53 <br />
-罗盘数据 3 axis digital Magnetometer (compass) from Honeywell (HMC5883L), I2C Address:  0x1E <br />
-气压计 Barometric Pressure and Temperature Sensor from Bosch (BMP085), I2C Address:  0x77 </p>
<h4 id="5111"><a name="user-content-5111" href="#5111" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>5.1.1.1 集合库示例</h4>
<div class="codehilite"><pre><span class="cp"># include &lt;Wire.h&gt;</span>
<span class="cp"># include &lt;GY80.h&gt;</span>

<span class="n">GY80</span> <span class="n">sensor</span> <span class="o">=</span> <span class="n">GY80</span><span class="p">();</span> <span class="c1">//create GY80 instance</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// initialize serial communication at 115200 bits per second:</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
    <span class="n">sensor</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>       <span class="c1">//initialize sensors</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">GY80_scaled</span> <span class="n">val</span> <span class="o">=</span> <span class="n">sensor</span><span class="p">.</span><span class="n">read_scaled</span><span class="p">();</span>       <span class="c1">//get values from all sensors</span>
    <span class="c1">// print out values</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Mag:&quot;</span><span class="p">);</span>                         <span class="c1">//magnetometer values</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">m_x</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">m_y</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">m_z</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Acc:&quot;</span><span class="p">);</span>                         <span class="c1">//accelerometer values</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">a_x</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">a_y</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">a_z</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Gyro:&quot;</span><span class="p">);</span>                        <span class="c1">//gyroscope values</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">g_x</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">g_y</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">g_z</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;P:&quot;</span><span class="p">);</span>                           <span class="c1">//pressure values</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">p</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;T:&quot;</span><span class="p">);</span>                           <span class="c1">//temperature values</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>


    <span class="n">delay</span><span class="p">(</span><span class="mi">250</span><span class="p">);</span>        <span class="c1">// delay in between reads for stability</span>
<span class="p">}</span>
</pre></div>


<h4 id="5112"><a name="user-content-5112" href="#5112" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>5.1.1.2 集合库使用说明</h4>
<p>Copy Folder to Arduino/libraries</p>
<div class="codehilite"><pre><span class="cp"># include &lt;GY80.h&gt;</span>

<span class="c1">//Create the GY80 class (here named sensor):</span>
<span class="n">GY80</span> <span class="n">sensor</span> <span class="o">=</span> <span class="n">GY80</span><span class="p">();</span>

<span class="c1">//For initialization call once:</span>
<span class="n">sensor</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>

<span class="c1">//To get values from all sensors:</span>
<span class="n">GY80_scaled</span> <span class="n">values</span> <span class="o">=</span> <span class="n">sensor</span><span class="p">.</span><span class="n">read_scaled</span><span class="p">;</span>

<span class="c1">//See below for the GY80_scaled type.</span>

<span class="cm">/*======Measuring functions=======*/</span>

<span class="n">GY80_scaled</span> <span class="nf">read_scaled</span><span class="p">();</span>
<span class="c1">//returns scaled values from all sensors</span>

<span class="n">GY80_single_scaled</span> <span class="nf">m_read_scaled</span><span class="p">();</span>
<span class="c1">//returns scaled values from magnetometer in microTesla [µT]</span>

<span class="n">GY80_single_scaled</span> <span class="nf">a_read_scaled</span><span class="p">();</span>
<span class="c1">//returns scaled accelerometer values in G, 1G = 9.81 m/s2</span>

<span class="n">GY80_single_scaled</span> <span class="nf">g_read_scaled</span><span class="p">();</span>
<span class="c1">//returns scaled gyroscope values in dps, 6dps = 1rpm</span>

<span class="kt">float</span> <span class="nf">p_read_scaled</span><span class="p">();</span>
<span class="c1">//returns pressure value in bar</span>

<span class="kt">float</span> <span class="nf">p_read_altitude</span><span class="p">();</span>
<span class="cm">/*returns altitude in m - not accurate, </span>
<span class="cm">better used only for measuring altitude differences </span>
<span class="cm">and over a short time as air pressure changes with time*/</span>

<span class="kt">float</span> <span class="nf">t_read_scaled</span><span class="p">();</span>
<span class="c1">//get temperature value in degree celsius</span>


<span class="cm">/*======Measuring functions [raw values]=======*/</span>

<span class="n">GY80_raw</span> <span class="nf">read_raw</span><span class="p">();</span>
<span class="c1">//returns raw values from all sensors</span>

<span class="n">GY80_single_raw</span> <span class="nf">m_read_raw</span><span class="p">();</span>
<span class="c1">//returns raw values from magnetometer</span>

<span class="n">GY80_single_raw</span> <span class="nf">a_read_raw</span><span class="p">();</span>
<span class="c1">//returns raw accelerometer values</span>

<span class="n">GY80_single_raw</span> <span class="nf">g_read_raw</span><span class="p">();</span>
<span class="c1">//returns raw gyroscope values </span>

<span class="kt">uint32_t</span> <span class="nf">p_read_raw</span><span class="p">();</span>
<span class="c1">//returns raw pressure value</span>

<span class="kt">uint16_t</span> <span class="nf">t_read_raw</span><span class="p">();</span>
<span class="c1">//get raw temperature value</span>


<span class="cm">/*======Functions for configuration=======*/</span>

<span class="kt">void</span> <span class="nf">m_set_scale</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">scale</span><span class="p">);</span>
<span class="c1">//set magnetometer full scale range [values in µT]</span>
  <span class="n">GY80_m_scale_88</span>
  <span class="n">GY80_m_scale_130</span>
  <span class="n">GY80_m_scale_190</span>
  <span class="n">GY80_m_scale_250</span>
  <span class="n">GY80_m_scale_400</span>
  <span class="n">GY80_m_scale_470</span>
  <span class="n">GY80_m_scale_560</span>
  <span class="n">GY80_m_scale_810</span> <span class="o">&lt;-</span><span class="k">default</span>

<span class="kt">void</span> <span class="n">a_set_scale</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">scale</span><span class="p">);</span>
<span class="c1">//set accelerometer full scale range in G</span>
  <span class="n">GY80_a_scale_2</span>
  <span class="n">GY80_a_scale_4</span>
  <span class="n">GY80_a_scale_8</span>
  <span class="n">GY80_a_scale_16</span> <span class="o">&lt;-</span><span class="k">default</span>

<span class="kt">void</span> <span class="n">a_set_bw</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">bw</span><span class="p">);</span>
<span class="c1">//set measuring frequency, can be:</span>
  <span class="n">GY80_a_bw_3200</span>  <span class="c1">// 1600Hz Bandwidth   140µA IDD</span>
  <span class="n">GY80_a_bw_1600</span>  <span class="c1">//  800Hz Bandwidth    90µA IDD</span>
  <span class="n">GY80_a_bw_800</span>   <span class="c1">//  400Hz Bandwidth   140µA IDD</span>
  <span class="n">GY80_a_bw_400</span>   <span class="c1">//  200Hz Bandwidth   140µA IDD</span>
  <span class="n">GY80_a_bw_200</span>   <span class="c1">//  100Hz Bandwidth   140µA IDD</span>
  <span class="n">GY80_a_bw_100</span>   <span class="c1">//   50Hz Bandwidth   140µA IDD</span>
  <span class="n">GY80_a_bw_50</span>    <span class="c1">//   25Hz Bandwidth    90µA IDD</span>
  <span class="n">GY80_a_bw_25</span>    <span class="c1">// 12.5Hz Bandwidth    60µA IDD</span>
  <span class="n">GY80_a_bw_12_5</span>  <span class="c1">// 6.25Hz Bandwidth    50µA IDD (default value)</span>
  <span class="n">GY80_a_bw_6_25</span>  <span class="c1">// 3.13Hz Bandwidth    45µA IDD</span>
  <span class="n">GY80_a_bw_3_13</span>  <span class="c1">// 1.56Hz Bandwidth    40µA IDD</span>
  <span class="n">GY80_a_bw_1_56</span>  <span class="c1">// 0.78Hz Bandwidth    34µA IDD</span>
  <span class="n">GY80_a_bw_0_78</span>  <span class="c1">// 0.39Hz Bandwidth    23µA IDD</span>
  <span class="n">GY80_a_bw_0_39</span>  <span class="c1">// 0.20Hz Bandwidth    23µA IDD</span>
  <span class="n">GY80_a_bw_0_20</span>  <span class="c1">// 0.10Hz Bandwidth    23µA IDD</span>
  <span class="n">GY80_a_bw_0_10</span>  <span class="c1">// 0.05Hz Bandwidth    23µA IDD</span>

<span class="kt">void</span> <span class="n">g_set_scale</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">scale</span><span class="p">);</span>
<span class="c1">//sets gyroscpe scale in dps, can be:</span>
  <span class="n">GY80_g_scale_250</span>
  <span class="n">GY80_g_scale_500</span>
  <span class="n">GY80_g_scale_2000</span>


<span class="cm">/*======Struct types=======*/</span>

<span class="c1">//GY80_scaled</span>
    <span class="kt">float</span> <span class="n">a_x</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">a_y</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">a_z</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">m_x</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">m_y</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">m_z</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">g_x</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">g_y</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">g_z</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">p</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">t</span><span class="p">;</span>

<span class="c1">//GY80_raw</span>
    <span class="kt">int16_t</span> <span class="n">a_x</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">a_y</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">a_z</span><span class="p">;</span>

    <span class="kt">int16_t</span> <span class="n">m_x</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">m_y</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">m_z</span><span class="p">;</span>

    <span class="kt">int16_t</span> <span class="n">g_x</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">g_y</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">g_z</span><span class="p">;</span>

    <span class="kt">uint32_t</span> <span class="n">p</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">t</span><span class="p">;</span>


<span class="c1">//GY80_single_raw</span>
    <span class="kt">int16_t</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">z</span><span class="p">;</span>

<span class="c1">//GY80_single_scaled</span>
    <span class="kt">float</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">z</span><span class="p">;</span>
</pre></div>


<h3 id="512-mpu-6050"><a name="user-content-512-mpu-6050" href="#512-mpu-6050" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>5.1.2 MPU-6050</h3>
<p>MPU6050是一种非常流行的空间运动传感器芯片，可以获取器件当前的三个加速度分量和三个旋转角速度。由于其体积小巧，功能强大，精度较高，不仅被广泛应用于工业，同时也是航模爱好者的神器，被安装在各类飞行器上驰骋蓝天。</p>
<p>随着Arduino开发板的普及，许多朋友希望能够自己制作基于MPU6050的控制系统，但由于缺乏专业知识而难以上手。此外，MPU6050的数据是有较大噪音的，若不进行滤波会对整个控制系统的精准确带来严重影响。</p>
<p>MPU6050芯片内自带了一个数据处理子模块DMP，已经内置了卡尔曼滤波算法，在许多应用中使用DMP输出的数据已经能够很好的满足要求。关于如何获取DMP的输出数据</p>
<p>There are four sensors on this board: I2C Address: 0x68<br />
1. a MEMS (microelectromechanical system) accelerometer  加速度计<br />
加速度计的三轴分量ACC_X、ACC_Y和ACC_Z均为16位有符号整数，分别表示器件在三个轴向上的加速度，取负值时加速度沿座标轴负向，取正值时沿正向。三个加速度分量均以重力加速度g的倍数为单位，能够表示的加速度范围，即倍率可以统一设定，有4个可选倍率：2g、4g、8g、16g。以ACC_X为例，若倍率设定为2g（默认），则意味着ACC_X取最小值-32768时，当前加速度为沿X轴正方向2倍的重力加速度；若设定为4g，取-32768时表示沿X轴正方向4倍的重力加速度，以此类推。显然，倍率越低精度越好，倍率越高表示的范围越大，这要根据具体的应用来设定。</p>
<ol>
<li>gyroscope with 16-bit analog-to-digital converters for 60 micro g and 0.01 degree/second precision, respectively. 角速度计<br />
绕X、Y和Z三个座标轴旋转的角速度分量GYR_X、GYR_Y和GYR_Z均为16位有符号整数。从原点向旋转轴方向看去，取正值时为顺时针旋转，取负值时为逆时针旋转。三个角速度分量均以“度/秒”为单位，能够表示的角速度范围，即倍率可统一设定，有4个可选倍率：250度/秒、500度/秒、1000度/秒、2000度/秒。以GYR_X为例，若倍率设定为250度/秒，则意味着GYR取正最大值32768时，当前角速度为顺时针250度/秒；若设定为500度/秒，取32768时表示当前角速度为顺时针500度/秒。显然，倍率越低精度越好，倍率越高表示的范围越大。</li>
</ol>
<h3 id="512"><a name="user-content-512" href="#512" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>5.1.2 地址冲突问题</h3>
<div class="codehilite"><pre><span class="c1">//.h文件里</span>
<span class="c1">//# define HMC5983_Address 0x1E    //把这行注销掉</span>
<span class="cp"># define ConfigurationRegisterA 0x00</span>
<span class="cp"># define ConfigurationRegisterB 0x01</span>
<span class="cp"># define ModeRegister 0x02</span>
<span class="cp"># define DataRegisterBegin 0x03</span>

<span class="c1">//.cpp 里改成这样</span>
<span class="n">HMC5983</span><span class="o">::</span><span class="n">HMC5983</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">Addr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">m_Scale</span> <span class="o">=</span> <span class="mf">0.92</span>
<span class="kt">uint8_t</span> <span class="n">HMC5983_Address</span>   <span class="o">=</span> <span class="n">Addr</span><span class="p">;</span>

<span class="p">}</span>
<span class="c1">/////////////////////////////////////////////////////////////</span>
<span class="err">主程序里</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MPU_addr</span><span class="o">=</span><span class="mh">0x68</span>

<span class="n">HMC5983</span> <span class="n">compass1</span><span class="err">（</span><span class="mh">0x1E</span><span class="err">）；</span><span class="c1">//这个地址要查手册是多少</span>
<span class="n">HMC5983</span> <span class="n">compass2</span><span class="err">（</span><span class="mh">0x1F</span><span class="err">）；</span><span class="c1">//这个地址要查手册是多少</span>
</pre></div>


<p>(1)通常传感器的 IIC address 是不能改的,<br />
   我不认为 HMC5983 的 IIC address 可以改 ??<br />
(2)同一条 IIC bus 上不可以有重复的 IIC slave address<br />
   所以如果你都直接连在一起是不行的 !<br />
(3)如果你一定要两个,<br />
   那可以 try 这样:<br />
   各自的 VDD 各自连到 Arduino 的数字脚, 例如 pin 3 和 pin 5<br />
   其他照你原先接,<br />
   每次只可读取一个,<br />
   把要读的透过 pin 3 或 pin 5 给它电力, 另一个则用 digitalWrite(pin, LOW); 关闭电力<br />
  如果是 5V, <br />
  假设要读 pin 3 那个,<br />
  就 digitalWrite(5, 0);  digitalWrite(3, HIGH); <br />
如果 HMC5983 是 3V, 则改这样:<br />
     digitalWrite(5, 0);  analogWrite(3, 185);  // 大约 3.5 Volt<br />
  接着要 delay 一下, 例如 delay(1234);<br />
  然后才下达 IIC 命令</p>
<h3 id="513-multiwii"><a name="user-content-513-multiwii" href="#513-multiwii" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>5.1.3 MultiWii</h3>
<hr />
<h1 id="6-raspberry-arduino"><a name="user-content-6-raspberry-arduino" href="#6-raspberry-arduino" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6 Raspberry 和 Arduino 蓝牙通信</h1>
<h2 id="61-pybluez"><a name="user-content-61-pybluez" href="#61-pybluez" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.1 pybluez 库</h2>
<div class="codehilite"><pre><span class="c1"># 安装配置依赖库</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">pub</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">bluetooth</span><span class="o">/</span><span class="n">bluez</span><span class="o">-</span><span class="mf">5.9</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span>
<span class="n">tar</span> <span class="n">xvf</span> <span class="n">bluez</span><span class="o">-</span><span class="mf">5.9</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libusb</span><span class="o">-</span><span class="n">dev</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libdbus</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">dev</span> 
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libudev</span><span class="o">-</span><span class="n">dev</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">glib2</span><span class="o">.</span><span class="mi">0</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libical</span><span class="o">-</span><span class="n">dev</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libreadline</span><span class="o">-</span><span class="n">dev</span>

<span class="o">./</span><span class="n">configure</span>
<span class="n">make</span>
<span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span>
<span class="n">systemctl</span> <span class="n">status</span> <span class="n">bluetooth</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">bluetooth</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">bluetooth</span>



<span class="n">mkdir</span> <span class="n">pyblue</span>
<span class="n">cd</span> <span class="n">pyblue</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">karulis</span><span class="o">/</span><span class="n">pybluez</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">master</span><span class="o">.</span><span class="n">zip</span>
<span class="n">unzip</span> <span class="n">master</span><span class="o">.</span><span class="n">zip</span>
<span class="n">cd</span> <span class="n">pybluez</span><span class="o">-</span><span class="n">master</span>

<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libbluetooth</span><span class="o">-</span><span class="n">dev</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>


<h3 id="611"><a name="user-content-611" href="#611" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.1.1 示例</h3>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">bluetooth</span>

<span class="n">nearby_devices</span> <span class="o">=</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">discover_devices</span><span class="p">(</span><span class="n">lookup_names</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;found </span><span class="si">%d</span><span class="s"> devices&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">nearby_devices</span><span class="p">))</span>

<span class="k">for</span> <span class="n">addr</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">nearby_devices</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;  </span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</pre></div>


<h2 id="612"><a name="user-content-612" href="#612" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.1.2代码</h2>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">bluetooth</span>

<span class="n">target_name</span> <span class="o">=</span> <span class="s">&quot;X4&quot;</span>
<span class="n">target_address</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">nearby_devices</span> <span class="o">=</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">discover_devices</span><span class="p">()</span>

<span class="k">for</span> <span class="n">bdaddr</span> <span class="ow">in</span> <span class="n">nearby_devices</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">target_name</span> <span class="o">==</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">lookup_name</span><span class="p">(</span> <span class="n">bdaddr</span> <span class="p">):</span>
        <span class="n">target_address</span> <span class="o">=</span> <span class="n">bdaddr</span>
        <span class="k">break</span>

<span class="k">if</span> <span class="n">target_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;found target bluetooth device with name:&quot;</span><span class="p">,</span> <span class="n">target_name</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;could not find target bluetooth device nearby&quot;</span>
</pre></div>


<h2 id="62-drone"><a name="user-content-62-drone" href="#62-drone" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.2 连接Drone</h2>
<p>Try creating a SP profile to the Pi. Edit the following file:</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">dbus</span><span class="o">-</span><span class="n">org</span><span class="o">.</span><span class="n">bluez</span><span class="o">.</span><span class="n">service</span>
</pre></div>


<p>Find the following line and add a compatibility flag &lsquo;-C&rsquo; to the end:</p>
<div class="codehilite"><pre><span class="n">ExecStart</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">bluetooth</span><span class="o">/</span><span class="n">bluetoothd</span> <span class="o">-</span><span class="n">C</span>
</pre></div>


<p>Additionally, add the following line after the above:</p>
<div class="codehilite"><pre><span class="nv">ExecStartPost</span><span class="o">=</span>/usr/bin/sdptool add SP
</pre></div>


<p>Save and reboot. Try removing the device then repairing and trusting the device with bluetoothctl</p>
<div class="codehilite"><pre><span class="n">power</span> <span class="n">on</span>
<span class="n">agent</span> <span class="n">on</span>
<span class="c1"># The Bluetooth agent is what manages the Bluetooth &#39;pairing code&#39;. It can either respond to a &#39;pairing code&#39; coming in, or can send one out.</span>
<span class="n">scan</span> <span class="n">on</span>
<span class="n">pair</span> <span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span> 
<span class="n">trust</span> <span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span> 
<span class="c1"># connect X*X*X*X*X*X </span>
</pre></div>


<p>Then connect to the device with terminal via:</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">rfcomm</span> <span class="n">watch</span> <span class="n">hci0</span>

<span class="c1"># or</span>

<span class="c1"># 除了bluetoothctl，在Raspbian是shell中可以通过hciconfig来控制蓝牙模块。比如开关蓝牙模块</span>
<span class="n">sudo</span> <span class="n">hciconfig</span> <span class="n">hci0</span> <span class="n">up</span>   <span class="c1">#启动hci设备</span>
<span class="n">sudo</span> <span class="n">hciconfig</span> <span class="n">hci0</span> <span class="n">down</span> <span class="c1">#关闭hci设备</span>
<span class="c1"># 命令中的hci0指的是0号HCI设备，即树莓派的蓝牙适配器</span>

<span class="n">sudo</span> <span class="n">rfcomm</span> <span class="n">connect</span> <span class="mi">0</span> <span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span>  <span class="mi">1</span>

<span class="n">sudo</span> <span class="n">rfcomm</span> <span class="n">watch</span> <span class="n">hci0</span>

<span class="c1"># 与此同时，你可以用下面命令来查看蓝牙设备的工作日志： </span>

<span class="n">hcidump</span>
</pre></div>


<p>Connected /dev/rfcomm0 to X<em>X</em>X<em>X</em>X*X  on channel 1</p>
<p>If that doesn&rsquo;t work you can also try adding pi to the lp group</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">adduser</span> <span class="n">pi</span> <span class="n">lp</span>
</pre></div>


<p><div class="codehilite"><pre><span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">bluetooth</span><span class="o">/</span><span class="n">rfcomm</span><span class="o">.</span><span class="n">conf</span>

<span class="n">rfcomm0</span> <span class="p">{</span>
    <span class="n">bind</span> <span class="n">no</span><span class="p">;</span>
    <span class="n">device</span> <span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span> <span class="p">;</span>
    <span class="n">channel</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">comment</span> <span class="err">“</span><span class="n">Connection</span> <span class="n">to</span> <span class="n">Bluetooth</span> <span class="n">serial</span> <span class="n">module</span><span class="err">”</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<br />
The &ldquo;bind no&rdquo; is important, otherwise it will try to autmatically bind, which presents all sorts of problems for actually accessing the device (as it&rsquo;s quite picky about when its associated)</p>
<p>sudo rfcomm connect 0</p>
<p>sudo rfcomm connect rfcomm0 X<em>X</em>X<em>X</em>X*X </p>
<div class="codehilite"><pre><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">sourceforge</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">pyserial</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">HEAD</span><span class="o">/</span><span class="n">tree</span><span class="o">/</span><span class="n">trunk</span><span class="o">/</span><span class="n">pyserial</span><span class="o">/</span><span class="n">serial</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">miniterm</span><span class="o">.</span><span class="n">py</span>

<span class="n">sudo</span> <span class="n">miniterm</span><span class="o">.</span><span class="n">py</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">rfcomm0</span>
<span class="n">sudo</span> <span class="n">service</span> <span class="n">bluetooth</span> <span class="n">restart</span>
</pre></div>


<h3 id="_2"><a name="user-content-_2" href="#_2" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>两行可行方案</h3>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">hciconfig</span> <span class="n">hci0</span> <span class="n">up</span>
<span class="n">sudo</span> <span class="n">rfcomm</span> <span class="n">connect</span> <span class="mi">0</span> <span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span>  <span class="mi">1</span>
</pre></div>


<h2 id="63-pythonshell"><a name="user-content-63-pythonshell" href="#63-pythonshell" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.3 Python运行外部shell命令</h2>
<h3 id="631-subprocess"><a name="user-content-631-subprocess" href="#631-subprocess" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.3.1 subprocess 库</h3>
<div class="codehilite"><pre><span class="c1"># The os.system has many problems and subprocess is a much better way to executing unix command. The syntax is:</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s">&quot;command1&quot;</span><span class="p">)</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">&quot;command1&quot;</span><span class="p">,</span> <span class="s">&quot;arg1&quot;</span><span class="p">,</span> <span class="s">&quot;arg2&quot;</span><span class="p">])</span>

<span class="c1"># subprocess模块中只定义了一个类: Popen。可以使用Popen来创建进程，并与进程进行复杂的交互。它的构造函数如下：</span>

<span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">preexec_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">close_fds</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">startupinfo</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">creationflags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<p>参数args可以是字符串或者序列类型（如：list，元组），用于指定进程的可执行文件及其参数。如果是序列类型，第一个元素通常是可执行文件的路径。我们也可以显式的使用executeable参数来指定可执行文件的路径。在windows操作系统上，Popen通过调用CreateProcess()来创建子进程,CreateProcess接收一个字符串参数，如果args是序列类型，系统将会通过list2cmdline()函数将序列类型转换为字符串。</p>
<p>参数bufsize：指定缓冲。我到现在还不清楚这个参数的具体含义，望各个大牛指点。</p>
<p>参数executable用于指定可执行程序。一般情况下我们通过args参数来设置所要运行的程序。如果将参数shell设为True，executable将指定程序使用的shell。在windows平台下，默认的shell由COMSPEC环境变量来指定。</p>
<p>参数stdin, stdout, stderr分别表示程序的标准输入、输出、错误句柄。他们可以是PIPE，文件描述符或文件对象，也可以设置为None，表示从父进程继承。</p>
<p>参数preexec_fn只在Unix平台下有效，用于指定一个可执行对象（callable object），它将在子进程运行之前被调用。</p>
<p>参数Close_sfs：在windows平台下，如果close_fds被设置为True，则新创建的子进程将不会继承父进程的输入、输出、错误管道。我们不能将close_fds设置为True同时重定向子进程的标准输入、输出与错误(stdin, stdout, stderr)。</p>
<p>如果参数shell设为true，程序将通过shell来执行。</p>
<p>参数cwd用于设置子进程的当前目录。</p>
<p>参数env是字典类型，用于指定子进程的环境变量。如果env = None，子进程的环境变量将从父进程中继承。</p>
<p>参数Universal_newlines:不同操作系统下，文本的换行符是不一样的。如：windows下用’/r/n’表示换，而Linux下用’/n’。如果将此参数设置为True，Python统一把这些换行符当作’/n’来处理。</p>
<p>参数startupinfo与createionflags只在windows下用效，它们将被传递给底层的CreateProcess()函数，用于设置子进程的一些属性，如：主窗口的外观，进程的优先级等等。</p>
<div class="codehilite"><pre><span class="c1"># To store output to the output variable, run:</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Today is&quot;</span><span class="p">,</span> <span class="n">output</span>

<span class="c1"># get real time output:</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">cmdping</span> <span class="o">=</span> <span class="s">&quot;ping -c4 www.cyberciti.biz&quot;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmdping</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>


<h3 id="632"><a name="user-content-632" href="#632" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.3.2 超级管理员运行</h3>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>

<span class="n">sudo_password</span> <span class="o">=</span> <span class="s">&#39;My_pass&#39;</span>
<span class="n">command_open</span> <span class="o">=</span> <span class="s">&#39;sudo hciconfig hci0 up&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">command_connect</span> <span class="o">=</span> <span class="s">&#39;rfcomm connect 0 X*X*X*X*X*X  1&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s">&#39;sudo&#39;</span><span class="p">,</span> <span class="s">&#39;-S&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">command_open</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span><span class="n">universal_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sudo_prompt</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">sudo_password</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s">&#39;sudo&#39;</span><span class="p">,</span> <span class="s">&#39;-S&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">command_connect</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span><span class="n">universal_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sudo_prompt</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">sudo_password</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</pre></div>


<p>结束超级进程</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;sudo killall rfcomm&quot;</span><span class="p">)</span>
</pre></div>


<h3 id="633"><a name="user-content-633" href="#633" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.3.3 蓝牙连接完整代码</h3>
<div class="codehilite"><pre><span class="ch">#!/home/pi/miniconda3/envs/py27/bin/</span>
<span class="kn">import</span> <span class="nn">bluetooth</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span><span class="nn">os</span>

<span class="n">target_name</span> <span class="o">=</span> <span class="s">&quot;X4&quot;</span>
<span class="n">killcount</span><span class="o">=</span><span class="mi">0</span>
<span class="n">target_address</span> <span class="o">=</span> <span class="s">&#39;X*X*X*X*X*X &#39;</span>
<span class="n">sudo_password</span> <span class="o">=</span> <span class="s">&#39;X*X*X*X*X*X &#39;</span>
<span class="n">command_open</span> <span class="o">=</span> <span class="s">&#39;sudo hciconfig hci0 up&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">command_connect</span> <span class="o">=</span> <span class="s">&#39;nohup rfcomm connect 0 X*X*X*X*X*X  1 &gt; /home/pi/log/rfcomm_x4.log 2&gt;&amp;1 &amp;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">detect_drone</span><span class="p">():</span>
  <span class="n">nearby_devices</span> <span class="o">=</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">discover_devices</span><span class="p">(</span><span class="n">lookup_names</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span><span class="n">flush_cache</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">bdaddr</span> <span class="ow">in</span> <span class="n">nearby_devices</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">bdaddr</span><span class="o">==</span> <span class="n">target_address</span><span class="p">:</span>
      <span class="k">return</span> <span class="mi">1</span>
      <span class="k">break</span>
  <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">status_blue</span><span class="p">():</span>
  <span class="n">stdoutdata</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s">&quot;hcitool&quot;</span><span class="p">,</span><span class="s">&quot;con&quot;</span><span class="p">])</span>
  <span class="k">if</span> <span class="s">&quot;X*X*X*X*X*X &quot;</span> <span class="ow">in</span> <span class="n">stdoutdata</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Bluetooth device is connected&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="n">Bluetooth</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s">&#39;sudo&#39;</span><span class="p">,</span> <span class="s">&#39;-S&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">command_open</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span><span class="n">universal_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sudo_prompt</span> <span class="o">=</span> <span class="n">Bluetooth</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">sudo_password</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">status_blue</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">detect_drone</span><span class="p">():</span>
      <span class="k">print</span> <span class="p">(</span><span class="s">&quot;Found target bluetooth device with name:&quot;</span><span class="p">,</span> <span class="n">target_name</span><span class="p">)</span>
      <span class="k">print</span> <span class="p">(</span><span class="s">&quot;Starting rfcomm&quot;</span><span class="p">)</span>
      <span class="n">Bluetooth</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s">&#39;sudo&#39;</span><span class="p">,</span> <span class="s">&#39;-S&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">command_open</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span><span class="n">universal_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="n">sudo_prompt</span> <span class="o">=</span> <span class="n">Bluetooth</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">sudo_password</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;sudo killall rfcomm&quot;</span><span class="p">)</span>
      <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">Drone_bluetooth</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s">&#39;sudo&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">command_connect</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span><span class="n">universal_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span> <span class="p">(</span><span class="s">&quot;No target bluetooth device nearby&quot;</span><span class="p">)</span>
</pre></div>


<p>We now look for nearby devices using <code>bluetooth.discover_devices</code>. I’m adding a few parameters as well. <code>lookup_names</code> is set to True so we can get the devices names instead of the just their addresses, and <code>flush_cache</code> is also set to True to make sure we always look for fresh information. Finally we set <code>duration</code> to 20, meaning we look for devices for up to 20 seconds. This is a bit excessive, but useful when testing.</p>
<p>nohup命令及其输出文件</p>
<p>nohup命令：如果你正在运行一个进程，而且你觉得在退出帐户时该进程还不会结束，那么可以使用nohup命令。该命令可以在你退出帐户/关闭终端之后继续运行相应的进程。nohup就是不挂起的意思(no hang up)。 <br />
一般都是在linux下nohup格式：</p>
<p><div class="codehilite"><pre>nohup <span class="nb">command </span>
或者 
nohup <span class="nb">command</span> <span class="p">&amp;</span> 
</pre></div>
<br />
这之间的差别是带&amp;的命令行，即使terminal（终端）关闭，或者电脑死机程序依然运行（前提是你把程序递交到服务器上).它把标准输出(STDOUT)和标准错误（STDERR）结果输出到nohup.txt文件这个看似很方便，但是当输出很大的时候，nohup.txt文件会非常大，或者多个后台命令的时候大家都会输出到nohup.txt文件，不利于查找结果和调试程序。所以能够重定向输出会非常方便。下面要介绍标准输出，标准输入 和标准错误了。 <br />
其实我们一直都在用，只是没有注意到，比如 </p>
<div class="codehilite"><pre>&gt;./command.sh &gt; output
<span class="c1"># 这其中的&gt;就是标准输出符号，其实是 1&gt;output 的缩写</span>
&gt;./command.sh 2&gt; output
<span class="c1"># 这里的2&gt;就是将标准错误输出到output文件里。 </span>
</pre></div>


<p>而<code>0&lt;</code>则是标准输入了。 </p>
<p>下面步入正题，重定向后台命令 </p>
<p><div class="codehilite"><pre>nohup ./command.sh &gt; output 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span> 
</pre></div>
<br />
解释：前面的nohup和后面的&amp;我想大家都能明白了把。 主要是中间的<code>2&gt;&amp;1</code>意思是把标准错误(2)重定向到标准输出中(1)，而标准输出又导入文件output里面,所以结果是标准错误和标准输出都导入文件output里面了。 <br />
至于为什么需要将标准错误重定向到标准输出的原因，那就归结为标准错误没有缓冲区，而stdout有。这就会导致 &gt;output 2&gt;output 文件output被两次打开，而stdout和stderr将会竞争覆盖，这肯定不是我门想要的. </p>
<p>这就是为什么有人会写成： <br />
nohup ./command.sh &gt;output 2&gt;output出错的原因了 </p>
<p>最后谈一下/dev/null文件的作用 <br />
这是一个无底洞，任何东西都可以定向到这里，但是却无法打开。 <br />
所以一般很大的stdou和stderr当你不关心的时候可以利用stdout和stderr定向到这里&gt;./command.sh &gt;/dev/null 2&gt;&amp;1 </p>
<h3 id="634-python"><a name="user-content-634-python" href="#634-python" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.3.4 注册为python自动后台运行服务</h3>
<p>修改默认环境</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">nano</span> <span class="o">~/.</span><span class="n">bashrc</span>

<span class="n">export</span> <span class="n">PATH</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="o">/</span><span class="n">miniconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">py27</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="err">$</span><span class="n">PATH</span>
</pre></div>


<div class="codehilite"><pre>sudo nano /etc/rc.local
</pre></div>


<div class="codehilite"><pre>nohup /home/pi/miniconda3/envs/py27/bin/python /home/pi/bootwith/bluetooth_drone.py &gt; /home/pi/log/bluetooth_drone.log 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>
</pre></div>


<div class="codehilite"><pre>sudo nano /etc/init.d/bluetooth_drone



<span class="c1">#! /bin/sh</span>
<span class="c1"># /etc/init.d/noip </span>

<span class="c1">### BEGIN INIT INFO</span>
<span class="c1"># Provides:          noip</span>
<span class="c1"># Required-Start:    $remote_fs $syslog</span>
<span class="c1"># Required-Stop:     $remote_fs $syslog</span>
<span class="c1"># Default-Start:     2 3 4 5</span>
<span class="c1"># Default-Stop:      0 1 6</span>
<span class="c1"># Short-Description: Simple script to start a program at boot</span>
<span class="c1"># Description:       A simple script which will start / stop a program a boot / shutdown.</span>
<span class="c1">### END INIT INFO</span>

<span class="c1"># If you want a command to always run, put it here</span>

<span class="c1"># Carry out specific functions when asked to by the system</span>
<span class="k">case</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> in
  start<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Starting bluetooth_drone&quot;</span>
    nohup /home/pi/miniconda3/envs/py27/bin/python /home/pi/bootwith/bluetooth_drone.py &gt; /home/pi/log/bluetooth_drone.log 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">&amp;</span>
    <span class="p">;;</span>
  stop<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Stopping bluetooth_drone&quot;</span>
    <span class="c1"># kill application you want to stop</span>
    killall -9 rfcomm
    <span class="p">;;</span>
  *<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Usage: /etc/init.d/bluetooth_drone {start|stop}&quot;</span>
    <span class="nb">exit </span>1
    <span class="p">;;</span>
<span class="k">esac</span>

<span class="nb">exit </span>0




sudo chmod +755 /etc/init.d/bluetooth_drone
</pre></div>


<p>测试</p>
<div class="codehilite"><pre>sudo /etc/init.d/bluetooth_drone start
sudo /etc/init.d/bluetooth_drone stop
</pre></div>


<p>Register script to be run at startup:</p>
<div class="codehilite"><pre><span class="nb">cd</span> /etc/init.d/
sudo update-rc.d bluetooth_drone defaults
sudo update-rc.d -f bluetooth_drone remove
</pre></div>


<h2 id="64"><a name="user-content-64" href="#64" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.4 交换数据</h2>
<h3 id="641"><a name="user-content-641" href="#641" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.4.1安装配置库文件</h3>
<div class="codehilite"><pre>mkdir pymulti
wget https://github.com/alduxvm/pyMultiWii/archive/master.zip
unzip master.zip
python setup.py install
</pre></div>


<h3 id="642"><a name="user-content-642" href="#642" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.4.2 接收数据</h3>
<div class="codehilite"><pre><span class="ch">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;show-attitude.py: Script to ask the MultiWii Board attitude and print it.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pymultiwii</span> <span class="kn">import</span> <span class="n">MultiWii</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">stdout</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c1">#board = MultiWii(&quot;/dev/ttyUSB0&quot;)</span>
    <span class="n">board</span> <span class="o">=</span> <span class="n">MultiWii</span><span class="p">(</span><span class="s">&quot;/dev/rfcomm0&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">board</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="n">MultiWii</span><span class="o">.</span><span class="n">RAW_IMU</span><span class="p">)</span>
            <span class="c1">#print board.attitude #uncomment for regular printing</span>

            <span class="c1"># Fancy printing (might not work on windows...)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;ax = {:+.0f} </span><span class="se">\t</span><span class="s"> ay = {:+.0f} </span><span class="se">\t</span><span class="s"> az = {:+.0f} gx = {:+.0f} </span><span class="se">\t</span><span class="s"> gy = {:+.0f} </span><span class="se">\t</span><span class="s"> gz = {:+.0f} mx = {:+.0f} </span><span class="se">\t</span><span class="s"> my = {:+.0f} </span><span class="se">\t</span><span class="s"> mz = {:+.0f} </span><span class="se">\t</span><span class="s"> elapsed = {:+.4f} </span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">rawIMU</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">rawIMU</span><span class="p">[</span><span class="s">&#39;ay&#39;</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">rawIMU</span><span class="p">[</span><span class="s">&#39;az&#39;</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">rawIMU</span><span class="p">[</span><span class="s">&#39;gx&#39;</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">rawIMU</span><span class="p">[</span><span class="s">&#39;gy&#39;</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">rawIMU</span><span class="p">[</span><span class="s">&#39;gz&#39;</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">rawIMU</span><span class="p">[</span><span class="s">&#39;mx&#39;</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">rawIMU</span><span class="p">[</span><span class="s">&#39;my&#39;</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">rawIMU</span><span class="p">[</span><span class="s">&#39;mz&#39;</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">attitude</span><span class="p">[</span><span class="s">&#39;elapsed&#39;</span><span class="p">]))</span>
            <span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">message</span> <span class="p">)</span>
            <span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="c1"># End of fancy printing</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">error</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Error on Main: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>


<h3 id="643"><a name="user-content-643" href="#643" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.4.3 发送数据</h3>
<div class="codehilite"><pre><span class="ch">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;test-send.py: Test script to send RC commands to a MultiWii Board.&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Aldo Vargas&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s">&quot;Copyright 2016 Altax.net&quot;</span>

<span class="n">__license__</span> <span class="o">=</span> <span class="s">&quot;GPL&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s">&quot;Aldo Vargas&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s">&quot;alduxvm@gmail.com&quot;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s">&quot;Development&quot;</span>

<span class="kn">from</span> <span class="nn">pymultiwii</span> <span class="kn">import</span> <span class="n">MultiWii</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c1">#board = MultiWii(&quot;/dev/ttyUSB0&quot;)</span>
    <span class="n">board</span> <span class="o">=</span> <span class="n">MultiWii</span><span class="p">(</span><span class="s">&quot;/dev/rfcomm0&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
          <span class="c1">#example of 8 RC channels to be send</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1500</span><span class="p">,</span><span class="mi">1550</span><span class="p">,</span><span class="mi">1600</span><span class="p">,</span><span class="mi">1560</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1040</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">]</span>

            <span class="c1"># Old function </span>
            <span class="c1">#board.sendCMD(16,MultiWii.SET_RAW_RC,data)</span>

            <span class="c1">#New function that will receive attitude after setting the rc commands</span>
            <span class="n">board</span><span class="o">.</span><span class="n">sendCMDreceiveATT</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="n">MultiWii</span><span class="o">.</span><span class="n">SET_RAW_RC</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>

            <span class="k">print</span> <span class="n">board</span><span class="o">.</span><span class="n">attitude</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">error</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Error on Main: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>


<div class="admonition hint">
<p class="admonition-title">RC alias</p>
</div>
<table>
<thead>
<tr>
<th>No</th>
<th align="center">Name</th>
<th align="right">Range</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td align="center">ROLL</td>
<td align="right">1020~2000</td>
</tr>
<tr>
<td>1</td>
<td align="center">PITCH</td>
<td align="right">1020~2000</td>
</tr>
<tr>
<td>2</td>
<td align="center">YAW</td>
<td align="right">1020~2000</td>
</tr>
<tr>
<td>3</td>
<td align="center">THROTTLE</td>
<td align="right">1000~2000</td>
</tr>
<tr>
<td>4</td>
<td align="center">AUX1</td>
<td align="right">flight mode selection</td>
</tr>
<tr>
<td>5</td>
<td align="center">AUX2</td>
<td align="right">tuning and calibration</td>
</tr>
<tr>
<td>6</td>
<td align="center">AUX3</td>
<td align="right">overwrite CAM pitch (AUX1-AUX4) disable manual input and free the AUX channel</td>
</tr>
<tr>
<td>7</td>
<td align="center">AUX4</td>
<td align="right"></td>
</tr>
</tbody>
</table>
<p>测得解锁数据代码</p>
<div class="admonition attention">
<p class="admonition-title">解锁 日本手</p>
</div>
<table>
<thead>
<tr>
<th>最小</th>
<th align="center">居中</th>
<th align="right">最大</th>
</tr>
</thead>
<tbody>
<tr>
<td>throttle</td>
<td align="center">pitch前进</td>
<td align="right">yaw</td>
</tr>
<tr>
<td>油门</td>
<td align="center">roll翻滚</td>
<td align="right">右自旋</td>
</tr>
</tbody>
</table>
<p>数值 <code>[1500,1500,2000,1020]</code></p>
<p>/home/pi/miniconda3/envs/py27/lib/python2.7/site-packages/pymultiwii-1.6-py2.7.egg</p>
<h3 id="644"><a name="user-content-644" href="#644" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.4.4 蓝牙数据嗅探</h3>
<p>$$验证解锁数据代码$$</p>
<div class="codehilite"><pre><span class="mi">24</span><span class="p">:</span><span class="mi">4</span><span class="n">d</span><span class="p">:</span><span class="mi">3</span><span class="n">c</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mi">65</span><span class="p">:</span><span class="mi">65</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="mi">4</span><span class="n">d</span><span class="p">:</span><span class="mi">3</span><span class="n">c</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mi">6</span><span class="n">c</span><span class="p">:</span><span class="mi">6</span><span class="n">c</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="mi">4</span><span class="n">d</span><span class="p">:</span><span class="mi">3</span><span class="n">c</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mi">6</span><span class="n">d</span><span class="p">:</span><span class="mi">6</span><span class="n">d</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="mi">4</span><span class="n">d</span><span class="p">:</span><span class="mi">3</span><span class="n">c</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mi">6</span><span class="n">a</span><span class="p">:</span><span class="mi">6</span><span class="n">a</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="mi">4</span><span class="n">d</span><span class="p">:</span><span class="mi">3</span><span class="n">c</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mi">71</span><span class="p">:</span><span class="mi">71</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="mi">4</span><span class="n">d</span><span class="p">:</span><span class="mi">3</span><span class="n">c</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mi">66</span><span class="p">:</span><span class="mi">66</span>

<span class="n">ee</span>
<span class="n">ll</span>
<span class="n">mm</span>
<span class="n">jj</span>
<span class="n">qq</span>
<span class="n">ff</span>
</pre></div>


<h3 id="645"><a name="user-content-645" href="#645" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.4.5 解锁</h3>
<div class="codehilite"><pre><span class="kn">from</span> <span class="nn">pymultiwii</span> <span class="kn">import</span> <span class="n">MultiWii</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">board</span> <span class="o">=</span> <span class="n">MultiWii</span><span class="p">(</span><span class="s">&quot;/dev/rfcomm0&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">board</span><span class="o">.</span><span class="n">arm</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Board is armed now!&quot;</span>
        <span class="k">print</span> <span class="s">&quot;In 3 seconds it will disarm...&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">board</span><span class="o">.</span><span class="n">disarm</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Disarmed.&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">error</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Error on Main: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>


<p>库文件定义</p>
<div class="codehilite"><pre>    <span class="k">def</span> <span class="nf">arm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">timer</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1500</span><span class="p">,</span><span class="mi">1500</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">1000</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendCMD</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">MultiWii</span><span class="o">.</span><span class="n">SET_RAW_RC</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="n">timer</span> <span class="o">=</span> <span class="n">timer</span> <span class="o">+</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span>  <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">disarm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">timer</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1500</span><span class="p">,</span><span class="mi">1500</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendCMD</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">MultiWii</span><span class="o">.</span><span class="n">SET_RAW_RC</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="n">timer</span> <span class="o">=</span> <span class="n">timer</span> <span class="o">+</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span>  <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</pre></div>


<h3 id="646"><a name="user-content-646" href="#646" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>6.4.6 接收信息并显示为图像</h3>
<p>安装matplotlib库文件</p>
<div class="codehilite"><pre><span class="nb">source </span>activate py27
conda install matplotlib
</pre></div>


<p>python-pyqtgraph库文件</p>
<p>Pyside为依赖库</p>
<div class="codehilite"><pre>sudo nano /etc/apt/sources.list
deb http://luke.campagnola.me/debian dev/
sudo apt-get install python-pyqtgraph
sudo apt-get install python-pyside 
sudo apt-get install python-qt4 


sudo apt-get install build-essential git cmake libqt4-dev libphonon-dev python2.7-dev libxml2-dev libxslt1-dev qtmobility-dev libqtwebkit-dev
pip install wheel
wget https://pypi.python.org/packages/source/P/PySide/PySide-1.2.4.tar.gz
tar -xvzf PySide-1.2.4.tar.gz
<span class="nb">cd </span>PySide-1.2.4
python setup.py bdist_wheel --qmake<span class="o">=</span>/usr/bin/qmake-qt4
</pre></div>


<h1 id="_3"><a name="user-content-_3" href="#_3" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>集成串口通信和蓝牙通信</h1>
<div class="codehilite"><pre><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1">#======导入库文件======</span>
<span class="c1"># 串口通信</span>
<span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="c1"># 蓝牙通信</span>
<span class="kn">from</span> <span class="nn">pymultiwii</span> <span class="kn">import</span> <span class="n">MultiWii</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1">#======初始化全局变量======</span>
<span class="n">timeN</span><span class="o">=</span><span class="mi">1</span>
<span class="n">armN</span><span class="o">=</span><span class="mi">0</span>
<span class="n">armSwich</span><span class="o">=</span><span class="mi">1</span>
<span class="n">bluePort</span> <span class="o">=</span> <span class="s">&quot;/dev/rfcomm0&quot;</span>
<span class="n">serialPort</span> <span class="o">=</span> <span class="s">&quot;/dev/ttyACM0&quot;</span>
<span class="n">arduinoSer</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="n">serialPort</span><span class="p">,</span> <span class="mi">9600</span><span class="p">)</span>
<span class="n">arduinoDrone</span> <span class="o">=</span> <span class="n">MultiWii</span><span class="p">(</span><span class="n">bluePort</span><span class="p">)</span>

<span class="c1"># arduinoDrone.arm()</span>
<span class="c1">#======主程序======</span>
<span class="k">while</span> <span class="n">arduinoSer</span><span class="o">.</span><span class="n">isOpen</span><span class="p">():</span>
  <span class="c1">#======时间同步======</span>
  <span class="c1">#if timeN:</span>
  <span class="c1"># arduinoSer.write(time.time())</span>
  <span class="c1"># timeN=0</span>
  <span class="n">rawLigne</span> <span class="o">=</span> <span class="n">arduinoSer</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">tempeData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">rawLigne</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tempeData</span><span class="p">[</span><span class="s">&quot;Triger&quot;</span><span class="p">]):</span>
      <span class="c1">#{u&#39;Swich&#39;: 1, u&#39;Triger&#39;: 1, u&#39;IR&#39;: 0, u&#39;Stick&#39;: [592, 598], u&#39;Power&#39;: 392}</span>
      <span class="c1">#======红外模块======</span>
      <span class="c1">#======四轴飞行器======</span>
      <span class="c1">#初始赋值</span>
      <span class="c1">#中间位置  528 537 </span>
      <span class="c1">#100 1000</span>
      <span class="n">rawRoll</span> <span class="o">=</span> <span class="n">tempeData</span><span class="p">[</span><span class="s">&#39;Stick&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">dataRoll</span> <span class="o">=</span> <span class="n">rawRoll</span><span class="o">+</span><span class="mi">1000</span><span class="c1">#/(999-100)*980+1020</span>
      <span class="n">rawPitch</span> <span class="o">=</span> <span class="n">tempeData</span><span class="p">[</span><span class="s">&#39;Stick&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">dataPitch</span> <span class="o">=</span> <span class="n">rawPitch</span><span class="o">+</span><span class="mi">1000</span><span class="c1">#/(999-100)*980+1020</span>
      <span class="n">rawThrottle</span> <span class="o">=</span> <span class="n">tempeData</span><span class="p">[</span><span class="s">&#39;Power&#39;</span><span class="p">]</span>
      <span class="n">dataThrottle</span> <span class="o">=</span> <span class="n">rawThrottle</span><span class="o">+</span><span class="mi">950</span><span class="c1">#/(999-100)*980+1020</span>
      <span class="n">ifArm</span> <span class="o">=</span> <span class="n">tempeData</span><span class="p">[</span><span class="s">&#39;Swich&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">ifArm</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">armN</span><span class="o">+=</span><span class="mi">1</span>
      <span class="c1">#print armN</span>
      <span class="c1">#全局变量控制解锁。如果该变量/10%2等于1，则为奇数*10，那么解锁，否则锁定</span>
      <span class="c1">#解决按钮延迟的问题</span>
      <span class="k">if</span> <span class="n">armN</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">armSwich</span><span class="p">:</span>
          <span class="n">arduinoDrone</span><span class="o">.</span><span class="n">arm</span><span class="p">()</span>
          <span class="n">armSwich</span><span class="o">=</span><span class="mi">0</span>
          <span class="k">print</span> <span class="s">&#39;unlocked&#39;</span>
        <span class="n">dataCMD</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataRoll</span><span class="p">,</span><span class="n">dataPitch</span><span class="p">,</span><span class="mi">1500</span><span class="p">,</span><span class="n">dataThrottle</span><span class="p">]</span>
        <span class="c1">#dataArm = [1500,1500,2000,1000]</span>
        <span class="c1">#[ROLL,PITCH,YAW,THROTTLE]</span>
        <span class="n">arduinoDrone</span><span class="o">.</span><span class="n">sendCMD</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">MultiWii</span><span class="o">.</span><span class="n">SET_RAW_RC</span><span class="p">,</span><span class="n">dataCMD</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">dataCMD</span>
      <span class="k">else</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">armSwich</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
          <span class="c1">#arduinoDrone.disarm()</span>
          <span class="n">armSwich</span><span class="o">=</span><span class="mi">1</span>
          <span class="k">print</span> <span class="s">&#39;locked&#39;</span>
        <span class="k">print</span> <span class="s">&#39;StandBy&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1">#======树莓派Django模块======</span>
      <span class="c1">#{u&#39;Distance&#39;: 4, u&#39;Temperature&#39;: 20, u&#39;Light&#39;: 191, u&#39;Humity&#39;: 63, u&#39;Time&#39;: 1504611050, u&#39;Triger&#39;: 0}</span>
      <span class="k">print</span> <span class="s">&#39;存到数据库Django==&gt;&#39;</span><span class="p">,</span> <span class="n">tempeData</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="c1"># do nothing, not a valid JSON</span>
    <span class="k">pass</span>
</pre></div>


<hr />
<h1 id="7-vps-web"><a name="user-content-7-vps-web" href="#7-vps-web" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>7 VPS Web配置</h1>
<p>系统：ubuntu 14 x86_64 </p>
<h2 id="71"><a name="user-content-71" href="#71" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>7.1 初始化配置</h2>
<ul>
<li>安装sudo和nano</li>
</ul>
<div class="codehilite"><pre>apt-get update
apt-get upgrade
apt-get install -y sudo
apt-get install -y nano
</pre></div>


<ul>
<li>
<p>BBR网络加速开启</p>
<ul>
<li>准备：在Ubuntu安装gcc-4.9</li>
</ul>
<div class="codehilite"><pre>sudo apt-get update
sudo apt-get install -y software-properties-common
sudo add-apt-repository ppa:ubuntu-toolchain-r/test
sudo apt-get update
sudo apt-get -y install g++-4.9
readlink <span class="sb">`</span>which gcc<span class="sb">`</span>
运行这条命令创建文件链接：
ln -sf <span class="sb">`</span>which gcc-4.9<span class="sb">`</span> /usr/bin/gcc
</pre></div>


<ul>
<li>
<p>脚本，执行此命令会自动重启.</p>
<div class="codehilite"><pre>wget --no-check-certificate -qO <span class="s1">&#39;BBR.sh&#39;</span> <span class="s1">&#39;https://moeclub.org/attachment/LinuxShell/BBR.sh&#39;</span> <span class="o">&amp;&amp;</span> chmod a+x BBR.sh <span class="o">&amp;&amp;</span> bash BBR.sh -f
</pre></div>


</li>
<li>
<p>检测:重启后运行以下命令,结果不为空,则开启BBR成功.<br />
<code>lsmod |grep 'bbr'</code></p>
</li>
<li>
<p>一键BBR改进版/增强版</p>
<p><div class="codehilite"><pre>wget --no-check-certificate -qO <span class="s1">&#39;BBR_POWERED.sh&#39;</span> <span class="s1">&#39;https://moeclub.org/attachment/LinuxShell/BBR_POWERED.sh&#39;</span> <span class="o">&amp;&amp;</span> chmod a+x BBR_POWERED.sh <span class="o">&amp;&amp;</span> bash BBR_POWERED.sh
</pre></div>
<br />
    - 检测:重启后运行以下命令,结果不为空,则开启BBR成功.<br />
<code>lsmod |grep 'bbr_powered'</code></p>
</li>
</ul>
</li>
<li>
<p>添加账户</p>
</li>
</ul>
<div class="codehilite"><pre><span class="nt">adduser</span> <span class="nt">liang</span>
<span class="nt">X</span><span class="o">*</span><span class="nt">X</span><span class="o">*</span><span class="nt">X</span><span class="o">*</span><span class="nt">X</span><span class="o">*</span><span class="nt">X</span><span class="o">*</span><span class="nt">X</span>
<span class="nt">usermod</span> <span class="nt">-a</span> <span class="nt">-G</span> <span class="nt">sudo</span> <span class="nt">liang</span>
<span class="nt">sudo</span> <span class="nt">passwd</span> <span class="nt">root</span>
<span class="nt">X</span><span class="o">*</span><span class="nt">X</span><span class="o">*</span><span class="nt">X</span><span class="o">*</span><span class="nt">X</span><span class="o">*</span><span class="nt">X</span><span class="o">*</span><span class="nt">X</span>
</pre></div>


<p>配置SSH</p>
<div class="codehilite"><pre>sudo nano /etc/ssh/sshd_config
</pre></div>


<p>修改配置文件</p>
<div class="codehilite"><pre><span class="nt">PasswordAuthentication</span> <span class="nt">no</span>
<span class="nt">PermitRootLogin</span> <span class="nt">no</span>
<span class="nt">port</span> <span class="nt">80</span>
</pre></div>


<p>重启SSH服务</p>
<div class="codehilite"><pre><span class="nt">sudo</span> <span class="nt">service</span> <span class="nt">ssh</span> <span class="nt">restart</span>
</pre></div>


<p>80 端sslh口转发</p>
<div class="codehilite"><pre>sudo apt-get install libconfig-dev
wget https://github.com/yrutschle/sslh/archive/v1.18.tar.gz
sudo tar -C ./ -xzf v1.18.tar.gz
sudo make install
sudo cp sslh-fork /usr/local/sbin/sslh
sudo cp sslh-fork /etc/init.d/sslh
sudo cp basic.cfg /etc/sslh.cfg
sudo nano /etc/sslh.cfg
sudo update-rc.d sslh defaults
</pre></div>


<h2 id="72-shadowsocks"><a name="user-content-72-shadowsocks" href="#72-shadowsocks" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>7.2 ShadowSocks代理配置</h2>
<p>程序及其依赖组件</p>
<div class="codehilite"><pre><span class="nt">sudo</span> <span class="nt">apt-get</span> <span class="nt">install</span> <span class="nt">python-pip</span>
<span class="nt">sudo</span> <span class="nt">pip</span> <span class="nt">install</span> <span class="nt">shadowsocks</span>
<span class="nt">sudo</span> <span class="nt">apt-get</span> <span class="nt">install</span> <span class="nt">python-m2crypto</span>
</pre></div>


<p>编辑配置文件</p>
<div class="codehilite"><pre>sudo nano /etc/shadowsocks.json
</pre></div>


<div class="codehilite"><pre><span class="p">{</span>
<span class="s2">&quot;server&quot;</span><span class="o">:</span><span class="s2">&quot;X*X*X*X*X*X&quot;</span><span class="o">,</span>
<span class="s2">&quot;server_port&quot;</span><span class="o">:</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">,</span>
<span class="s2">&quot;local_address&quot;</span><span class="o">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="o">,</span>
<span class="s2">&quot;local_port&quot;</span><span class="o">:</span><span class="m">1080</span><span class="o">,</span>
<span class="s2">&quot;password&quot;</span><span class="o">:</span><span class="s2">&quot;X*X*X*X*X*X&quot;</span><span class="o">,</span>
<span class="s2">&quot;timeout&quot;</span><span class="o">:</span><span class="m">600</span><span class="o">,</span>
<span class="s2">&quot;method&quot;</span><span class="o">:</span><span class="s2">&quot;rc4-md5&quot;</span>
<span class="p">}</span>
</pre></div>


<div class="codehilite"><pre>sudo chmod 755 /etc/shadowsocks.json
sudo useradd ssuser
</pre></div>


<div class="codehilite"><pre>sudo nano /etc/rc.local
</pre></div>


<p>自启动：在 exit 0 这一行的上边加入如下</p>
<div class="codehilite"><pre>/usr/local/bin/ssserver -c /etc/shadowsocks.json -d start --user ssuser
</pre></div>


<h2 id="73-openvpn"><a name="user-content-73-openvpn" href="#73-openvpn" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>7.3 OpenVPN</h2>
<div class="codehilite"><pre><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">openvpn</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;X*X*X*X*X*X&quot;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">Pshu</span><span class="o">.</span><span class="n">conf</span>
<span class="n">wget</span> <span class="o">-</span><span class="n">P</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">202.120</span><span class="o">.</span><span class="mf">126.112</span><span class="o">/</span><span class="n">openvpn</span><span class="o">/</span><span class="n">shu</span><span class="o">.</span><span class="n">ovpn</span>
<span class="n">openvpn</span> <span class="o">--</span><span class="n">config</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">shu</span><span class="o">.</span><span class="n">ovpn</span> <span class="o">--</span><span class="n">auth</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="k">pass</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">Pshu</span><span class="o">.</span><span class="n">conf</span>
</pre></div>


<h2 id="74-nginx"><a name="user-content-74-nginx" href="#74-nginx" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>7.4 nginx</h2>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">nginx</span>
<span class="n">service</span> <span class="n">nginx</span> <span class="n">restart</span>
</pre></div>


<p>配置nginx服务器 nginx -t</p>
<div class="codehilite"><pre>nano /etc/nginx/nginx.conf
</pre></div>


<div class="codehilite"><pre><span class="nt">user</span>  <span class="nt">root</span><span class="o">;</span>  
<span class="nt">worker_processes</span>  <span class="nt">8</span><span class="o">;</span> 
<span class="nt">events</span> <span class="p">{</span>
        <span class="n">worker_connections</span> <span class="m">51200</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">http</span> <span class="p">{</span>
        <span class="n">server</span> <span class="err">{</span>
        <span class="n">root</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wwwroot</span><span class="o">/</span><span class="n">gliang</span><span class="o">.</span><span class="n">eu</span><span class="p">;</span>
        <span class="p">}</span>
<span class="err">}</span>
</pre></div>


<p>重启nginx </p>
<div class="codehilite"><pre><span class="n">nginx</span> <span class="o">-</span><span class="n">s</span> <span class="n">reopen</span>
</pre></div>


<h2 id="75-https"><a name="user-content-75-https" href="#75-https" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>7.5 https</h2>
<h3 id="751-acmesh"><a name="user-content-751-acmesh" href="#751-acmesh" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>7.5.1 安装 acme.sh并生成证书</h3>
<hr />
<p><strong>dns pod</strong></p>
<div class="codehilite"><pre>curl  https://get.acme.sh <span class="p">|</span> sh
<span class="nb">export </span><span class="nv">DP_Id</span><span class="o">=</span><span class="s2">&quot;----&quot;</span>
<span class="nb">export </span><span class="nv">DP_Key</span><span class="o">=</span><span class="s2">&quot;---------&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;DP_Id=\&quot;----\&quot;\nDP_Key=\&quot;---------\&quot;&quot;</span> &gt; ~/.acme.sh/account.conf
sed -i <span class="s1">&#39;2s/^/DP_Id=&quot;----&quot;\nDP_Key=&quot;---------&quot;\n/&#39;</span> /root/.acme.sh/dnsapi/dns_dp.sh
acme.sh --issue --dns dns_dp -d gliang.eu -d www.gliang.eu --force
</pre></div>


<div class="codehilite"><pre><span class="hll"><span class="nv">USER_PATH</span><span class="o">=</span><span class="s1">&#39;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games&#39;</span>
</span><span class="nv">AUTO_UPGRADE</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>
<span class="nv">SAVED_DP_Id</span><span class="o">=</span><span class="s2">&quot;----&quot;</span>
<span class="nv">SAVED_DP_Key</span><span class="o">=</span><span class="s2">&quot;---------&quot;</span>
</pre></div>


<div class="codehilite"><pre>acme.sh --install-cert -d gliang.eu -d www.gliang.eu --key-file /home/wwwroot/key.pem --fullchain-file /home/wwwroot/cert.pem --reloadcmd  <span class="s2">&quot;service nginx force-reload&quot;</span>
</pre></div>


<hr />
<p>http 方式需要在你的网站根目录下放置一个文件, 来验证你的域名所有权,完成验证. 然后就可以生成证书了.</p>
<p>GoDaddy.com申请production API <br />
<a href="https://developer.godaddy.com/keys/">https://developer.godaddy.com/keys/</a></p>
<div class="codehilite"><pre>curl  https://get.acme.sh <span class="p">|</span> sh
<span class="nb">export </span><span class="nv">DP_Id</span><span class="o">=</span><span class="s2">&quot;X*X*X*X*X*X&quot;</span>
<span class="nb">export </span><span class="nv">DP_Key</span><span class="o">=</span><span class="s2">&quot;X*X*X*X*X*X&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;GD_Key=\&quot;X*X*X*X*X*X\&quot;\nGD_Secret=\&quot;X*X*X*X*X*X\&quot;&quot;</span> &gt; ~/.acme.sh/account.conf
sed -i <span class="s1">&#39;2s/^/GD_Key=&quot;  &quot;\nGD_Secret=&quot;  &quot;\n/&#39;</span> /root/.acme.sh/dnsapi/dns_gd.sh
acme.sh --issue --dns dns_gd -d gliang.eu -d www.gliang.eu
</pre></div>


<p>The GD_Key and GD_Secret will be saved in ~/.acme.sh/account.conf and will be reused when needed.</p>
<div class="codehilite"><pre>Multi <span class="nv">domain</span><span class="o">=</span><span class="s1">&#39;DNS:X*X*X*X*X*X&#39;</span>
Getting domain auth token <span class="k">for</span> each domain
Getting webroot <span class="k">for</span> <span class="nv">domain</span><span class="o">=</span><span class="s1">&#39;X*X*X*X*X*X&#39;</span>
Getting new-authz <span class="k">for</span> <span class="nv">domain</span><span class="o">=</span><span class="s1">&#39;X*X*X*X*X*X&#39;</span>
The new-authz request is ok.
Getting webroot <span class="k">for</span> <span class="nv">domain</span><span class="o">=</span><span class="s1">&#39;www.X*X*X*X*X*X&#39;</span>
Getting new-authz <span class="k">for</span> <span class="nv">domain</span><span class="o">=</span><span class="s1">&#39;www.X*X*X*X*X*X&#39;</span><span class="c1">#&#39;</span>
The new-authz request is ok.
Found domain api file: /root/.acme.sh/dnsapi/dns_gd.sh
Adding record
Added, sleeping <span class="m">10</span> seconds
Found domain api file: /root/.acme.sh/dnsapi/dns_gd.sh
Adding record
Added, sleeping <span class="m">10</span> seconds
Sleep <span class="m">120</span> seconds <span class="k">for</span> the txt records to take effect
Verifying:X*X*X*X*X*X
Success
Verifying:www.X*X*X*X*X*X
Success
Verify finished, start to sign.
Cert success.
Your cert is in  /root/.acme.sh/X*X*X*X*X*X/X*X*X*X*X*X.cer 
Your cert key is in  /root/.acme.sh/X*X*X*X*X*X/X*X*X*X*X*X.key 
The intermediate CA cert is in  /root/.acme.sh/X*X*X*X*X*X/ca.cer 
And the full chain certs is there:  /root/.acme.sh/X*X*X*X*X*X/fullchain.cer 
</pre></div>


<p>验证证书：</p>
<div class="codehilite"><pre>curl -X GET -H <span class="s2">&quot;Authorization: sso-key X*X*X*X*X*X&quot;</span> <span class="s2">&quot;https://api.godaddy.com/v1/domains/available?domain=X*X*X*X*X*X&quot;</span>
</pre></div>


<h3 id="752-copy-nginx"><a name="user-content-752-copy-nginx" href="#752-copy-nginx" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>7.5.2 copy证书到 nginx</h3>
<p>注意, 默认生成的证书都放在安装目录下: <code>~/.acme.sh/</code>, 请不要直接使用此目录下的文件, 例如: 不要直接让 nginx/apache 的配置文件使用这下面的文件. 这里面的文件都是内部使用, 而且目录结构可能会变化.所以安装到<code>/home/wwwroot/gliang.eu/</code></p>
<div class="codehilite"><pre>acme.sh --install-cert -d gliang.eu -d www.gliang.eu --key-file /home/wwwroot/gliang.eu/key.pem --fullchain-file /home/wwwroot/gliang.eu/cert.pem --reloadcmd  <span class="s2">&quot;service nginx force-reload&quot;</span>
</pre></div>


<div class="admonition hint">
<p>一个小提醒, 这里用的是 service nginx force-reload, 不是 service nginx reload, 据测试, reload 并不会重新加载证书, 所以用的 force-reload</p>
</div>
<p>Nginx 的配置 ssl_certificate 使用 /etc/nginx/ssl/fullchain.cer ，而非 /etc/nginx/ssl/<domain>.cer ，否则 SSL Labs 的测试会报 Chain issues Incomplete 错误。</p>
<h3 id="753-acmesh"><a name="user-content-753-acmesh" href="#753-acmesh" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>7.5.3 更新证书 和 acme.sh</h3>
<p>目前证书在 60 天以后会自动更新, 你无需任何操作. 今后有可能会缩短这个时间, 不过都是自动的, 你不用关心.</p>
<p>目前由于 acme 协议和 letsencrypt CA 都在频繁的更新, 因此 acme.sh 也经常更新以保持同步.</p>
<p>强制更新<br />
<div class="codehilite"><pre><span class="hll"><span class="n">acme</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">renew</span> <span class="o">-</span><span class="n">d</span> <span class="n">gliang</span><span class="o">.</span><span class="n">eu</span> <span class="o">-</span><span class="n">d</span> <span class="n">www</span><span class="o">.</span><span class="n">gliang</span><span class="o">.</span><span class="n">eu</span> <span class="o">--</span><span class="n">force</span>
</span></pre></div>
</p>
<div class="codehilite"><pre><span class="c1"># 手动升级</span>
acme.sh --upgrade
sed -i <span class="s1">&#39;2s/^/GD_Key=&quot;X*X*X*X*X*X&quot;\n/&#39;</span> /root/.acme.sh/dnsapi/dns_gd.sh
<span class="c1"># 开启自动升级:</span>
acme.sh  --upgrade  --auto-upgrade
<span class="c1"># 关闭自动更新:</span>
acme.sh --upgrade  --auto-upgrade  0
</pre></div>


<h3 id="754-nginx"><a name="user-content-754-nginx" href="#754-nginx" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>7.5.4 更新nginx</h3>
<div class="admonition hint">
<p>配置nginx服务器 nginx -t</p>
</div>
<div class="codehilite"><pre>nano /etc/nginx/nginx.conf
</pre></div>


<div class="codehilite"><pre><span class="c1"># 全站ssl</span>

<span class="n">events</span> <span class="p">{</span>
        <span class="n">worker_connections</span> <span class="mi">51200</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">http</span> <span class="p">{</span>
    <span class="n">server</span><span class="p">{</span>
    <span class="n">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="n">server_name</span> <span class="n">gliang</span><span class="o">.</span><span class="n">eu</span><span class="p">;</span>
    <span class="n">root</span>  <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wwwroot</span><span class="o">/</span><span class="n">gliang</span><span class="o">.</span><span class="n">eu</span><span class="o">/</span><span class="p">;</span>
    <span class="n">index</span>         <span class="n">index</span><span class="o">.</span><span class="n">html</span> <span class="n">index</span><span class="o">.</span><span class="n">htm</span><span class="p">;</span>
    <span class="n">rewrite</span> <span class="o">^/</span><span class="p">(</span><span class="o">.*</span><span class="p">)</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gliang</span><span class="o">.</span><span class="n">eu</span><span class="o">/</span><span class="err">$</span><span class="mi">1</span> <span class="n">permanent</span><span class="p">;</span>
   <span class="p">}</span>

    <span class="n">server</span> <span class="p">{</span>
        <span class="n">listen</span>        <span class="mi">443</span><span class="p">;</span>
        <span class="n">server_name</span>   <span class="n">gliang</span><span class="o">.</span><span class="n">eu</span><span class="p">;</span>
        <span class="n">root</span>          <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wwwroot</span><span class="o">/</span><span class="n">gliang</span><span class="o">.</span><span class="n">eu</span><span class="o">/</span><span class="p">;</span>
        <span class="n">index</span>         <span class="n">index</span><span class="o">.</span><span class="n">html</span> <span class="n">index</span><span class="o">.</span><span class="n">htm</span><span class="p">;</span>

        <span class="n">ssl</span>           <span class="n">on</span><span class="p">;</span>
        <span class="n">ssl_certificate</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wwwroot</span><span class="o">/</span><span class="n">gliang</span><span class="o">.</span><span class="n">eu</span><span class="o">/</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span><span class="p">;</span>
        <span class="n">ssl_certificate_key</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wwwroot</span><span class="o">/</span><span class="n">gliang</span><span class="o">.</span><span class="n">eu</span><span class="o">/</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<div class="codehilite"><pre>apt-get --yes --force-yes install <span class="nv">$something</span>
</pre></div>


<hr />
<h1 id="vps"><a name="user-content-vps" href="#vps" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>自动化脚本Vps</h1>
<h2 id="01"><a name="user-content-01" href="#01" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>01</h2>
<div class="codehilite"><pre><span class="nb">echo</span> -e <span class="s1">&#39;#!/bin/bash\necho &quot;====== starting ======&quot;\napt-get update\napt-get upgrade\napt-get install -y sudo\napt-get install -y nano\nsudo apt-get update\nsudo apt-get install --assume-yes software-properties-common\nsudo add-apt-repository ppa:ubuntu-toolchain-r/test\nsudo apt-get update\nsudo apt-get install --assume-yes g++-4.9\nln -sf `which gcc-4.9` /usr/bin/gcc\nwget --no-check-certificate -qO &#39;</span>BBR.sh<span class="s1">&#39; &#39;</span>https://moeclub.org/attachment/LinuxShell/BBR.sh<span class="s1">&#39; &amp;&amp; chmod a+x BBR.sh &amp;&amp; bash BBR.sh -f&#39;</span> &gt; start01.sh <span class="o">&amp;&amp;</span> chmod a+x ./start01.sh
</pre></div>


<hr />
<h2 id="02"><a name="user-content-02" href="#02" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>02</h2>
<div class="codehilite"><pre>nano start02.sh
</pre></div>


<div class="codehilite"><pre><span class="ch">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">&quot;====== BBR_POWERED ======&quot;</span>
lsmod <span class="p">|</span>grep <span class="s1">&#39;bbr&#39;</span>
wget --no-check-certificate -qO <span class="s1">&#39;BBR_POWERED.sh&#39;</span> <span class="s1">&#39;https://moeclub.org/attachment/LinuxShell/BBR_POWERED.sh&#39;</span> <span class="o">&amp;&amp;</span> chmod a+x BBR_POWERED.sh <span class="o">&amp;&amp;</span> bash BBR_POWERED.sh
lsmod <span class="p">|</span>grep <span class="s1">&#39;bbr_powered&#39;</span>
<span class="nb">echo</span> <span class="s2">&quot;====== new user ======&quot;</span>
adduser liang
usermod -a -G sudo liang
<span class="nb">echo</span> <span class="s2">&quot;====== change PWD of root ======&quot;</span>
passwd root
<span class="nb">echo</span> <span class="s2">&quot;====== shadowsocks ======&quot;</span>
apt-get install -y python-pip
pip install shadowsocks
apt-get install -y python-m2crypto
<span class="nb">echo</span> -e <span class="s2">&quot;X*X*X*X*X*X&quot;</span> &gt; /etc/shadowsocks.json
sudo chmod <span class="m">755</span> /etc/shadowsocks.json
sudo useradd ssuser
<span class="nb">echo</span> <span class="s2">&quot;/usr/local/bin/ssserver -c /etc/shadowsocks.json -d start --user ssuser&quot;</span> &gt;&gt; /etc/rc.local
<span class="nb">echo</span> <span class="s2">&quot;====== openvpn ======&quot;</span>
apt-get install -y openvpn
<span class="nb">echo</span> -e <span class="s2">&quot;X*X*X*X*X*X&quot;</span> &gt; /root/Pshu.conf
wget -P /root/ http://202.120.126.112/openvpn/shu.ovpn

<span class="nb">echo</span> <span class="s2">&quot;====== dogtunnel ======&quot;</span>
sudo apt-get install -y golang-go
mkdir -P /root/dogtunnel/dt
wget -P http://dog-tunnel.tk/down/dtunnel_linux_x64_0.80.tgz
sudo tar -C /root/dogtunnel/dt -xzf dtunnel_linux_x64_0.80.tgz
chmod +x /root/dogtunnel/dt/dtunnel
<span class="nb">echo</span> -e <span class="s1">&#39;#! /bin/sh\n# /etc/init.d/noip \n### BEGIN INIT INFO\n# Provides:          noip\n# Required-Start:    $remote_fs $syslog\n# Required-Stop:     $remote_fs $syslog\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-Description: Simple script to start a program at boot\n# Description:       A simple script which will start / stop a program a boot / shutdown.\n### END INIT INFO\n# If you want a command to always run, put it here\n# Carry out specific functions when asked to by the system\ncase &quot;$1&quot; in\n  start)\n    echo &quot;Starting DogTunnel&quot;\n    X*X*X*X*X*X    ;;\n  stop)\n    echo &quot;Stopping DogTunnel&quot;\n    # kill application you want to stop\n    killall dtunnel\n    ;;\n  *)\n    echo &quot;Usage: /etc/init.d/dtunnel {start|stop}&quot;\n    exit 1\n    ;;\nesac\nexit 0&#39;</span> &gt; /etc/init.d/dogtunnel <span class="o">&amp;&amp;</span> chmod +755 /etc/init.d/dogtunnel
sudo update-rc.d /etc/init.d/dogtunnel defaults

<span class="nb">echo</span> <span class="s2">&quot;====== nginx ======&quot;</span>
sudo apt-get update
sudo apt-get install -y nginx
mkdir -p X*X*X*X*X*X
<span class="nb">echo</span> -e <span class="s2">&quot;events {\n        worker_connections 51200;\n}\nhttp {\n        server {\n        X*X*X*X*X*X;\n        }\n}&quot;</span> &gt; /etc/nginx/nginx.conf
<span class="nb">echo</span> <span class="s2">&quot;Welcome!&quot;</span> &gt; /home/wwwroot/gliang.eu/index.html
service nginx force-reload

<span class="nb">echo</span> <span class="s2">&quot;====== https ======&quot;</span>
curl  https://get.acme.sh <span class="p">|</span> sh
<span class="nb">export </span><span class="nv">DP_Id</span><span class="o">=</span><span class="s2">&quot;X*X*X*X*X*X&quot;</span>
<span class="nb">export </span><span class="nv">DP_Key</span><span class="o">=</span><span class="s2">&quot;X*X*X*X*X*X&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;GD_Key=\&quot;X*X*X*X*X*X&quot;</span> &gt; ~/.acme.sh/account.conf
<span class="c1"># sed -i &#39;2s/^/GD_Key=&quot;dKiQai3byGrX_EeorLuTYKW1XdzhYkEnDmk&quot;\nGD_Secret=&quot;EeotFgcHjpFSm5vUZuj3TG&quot;\n/&#39; /root/.acme.sh/dnsapi/dns_gd.sh</span>
reboot
</pre></div>


<div class="codehilite"><pre>chmod a+x ./start02.sh
</pre></div>


<hr />
<h2 id="03"><a name="user-content-03" href="#03" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>03</h2>
<div class="codehilite"><pre>nano start03.sh
</pre></div>


<div class="codehilite"><pre><span class="ch">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">&quot;====== HTTPS ======&quot;</span>
acme.sh --issue --dns dns_gd -d gliang.eu -d www.gliang.eu
acme.sh --install-cert -d gliang.eu -d www.gliang.eu --key-file X*X*X*X*X*X --reloadcmd  <span class="s2">&quot;service nginx force-reload&quot;</span>
acme.sh  --upgrade  --auto-upgrade

<span class="nb">echo</span> <span class="s2">&quot;====== Nginx full HTTPS ======&quot;</span>

<span class="nb">echo</span> -e <span class="s1">&#39;events {\nworker_connections 51200;\n}\nhttp {\nserver{\nlisten 80;\nserver_name gliang.eu;\nroot  /home/wwwroot/gliang.eu/;\nindex  index.html index.htm;\nrewrite ^/(.*) https://gliang.eu/$1 permanent;\n}\nserver {\nlisten 443;\nserver_name   gliang.eu;\nroot  /home/wwwroot/gliang.eu/;\nindex  index.html index.htm;\nssl  on;\nssl_certificate /home/wwwroot/gliang.eu/cert.pem;\nssl_certificate_key /home/wwwroot/gliang.eu/key.pem;\n}\n}&#39;</span> &gt; /etc/nginx/nginx.conf

service nginx force-reload
</pre></div>


<div class="codehilite"><pre>chmod a+x ./start03.sh
</pre></div>


<hr />
<h1 id="8-raspbian-vps"><a name="user-content-8-raspbian-vps" href="#8-raspbian-vps" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>8 Raspbian 和 VPS 站点通信</h1>
<hr />
<h1 id="a-linux"><a name="user-content-a-linux" href="#a-linux" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>附录A Linux 开机自动启动</h1>
<div class="admonition caution">
<p class="admonition-title">重要！</p>
</div>
<p>首先将命令更改为后台运行并且任意目录可执行<br />
<code>nohup command &gt; /dev/null 2&gt;&amp;1 &amp;</code></p>
<h2 id="a1-rclocal"><a name="user-content-a1-rclocal" href="#a1-rclocal" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>A.1 编辑 rc.local</h2>
<div class="codehilite"><pre>sudo nano /etc/rc.local
</pre></div>


<p>如果只是想开机时执行一些命令在背景运行, 而不是用到复杂的开机服务(例如可以暂停重启什么功能的), 可以这么做:<br />
编辑<code>/etc/rc.local</code>, 在 exit 0 前面加入你要执行的命令、脚本。</p>
<div class="admonition danger">
<p class="admonition-title">绝对路径</p>
</div>
<p>注意, 这个是很早的执行阶段, 可能PATH没有设置好, 所以最好用绝对路径!!!再说一次, 绝对路径! 包括脚本内!</p>
<h2 id="a2"><a name="user-content-a2" href="#a2" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>A.2 计划事务</h2>
<p>sudo crontab -e 进入计划事务编辑模式, 编辑计划, 加入这么一句<code>@reboot /path/to/script</code>. 这个可以加载比较多的指令了, 如果没有正常运行, 请用绝对路径.</p>
<h2 id="a3"><a name="user-content-a3" href="#a3" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>A.3 注册为服务</h2>
<p>先把 脚本 放到 <code>/etc/init.d</code>目录下。该目录为定义的服务。<br />
图形管理界面可以使用<code>sysv-rc-conf</code>, 命令行可以使用service命令.</p>
<div class="codehilite"><pre>sudo apt install sysv-rc-conf
sudo sysv-rc-conf
</pre></div>


<p>这里面service是不同级别的runlevel处理方法, [X]就是开启, 否则是没有开启, 按空格键切换<br />
  要马上操作服务: 按+开启,-停止服务<br />
  q退出</p>
<p>放在/etc/init.d里的是一些可执行的bash脚本. 相应脚本其实是service 运行的. 而开机运行的内容放在<code>/etc/rc*</code>内. 有些系统有/etc/rc/文件夹专门放置, 在ubuntu16里面都放在/etc/内. 在<code>/etc/rc*</code>的一般是放<code>/etc/init.d</code>内文件的链接文件.<br />
在开机启动内容文件夹内一般有<code>rc*.d</code>和<code>rc.local</code>,一般定义一句话开机启动的就定义在<code>rc.local</code>好了, 这个是最后必定加载的文件.因为<code>rc.local</code>是等待<code>/etc/init.d</code>的服务都开启后才执行的，所以如果<code>/etc/init.d</code>中的服务未开启完成，<code>rc.local</code>是不会执行的。如启动了<code>firstboot</code>服务，将会导致多用户模式下<code>rc.local</code>不能执行, 可通过 chkconfig –del 把 firstboot服务去除。服务开启时都会写启动日志，可通过<code>/var/log/boot.log</code>查看服务启动与否，再结合<code>/etc/rc.d/rcx.d/</code>下服务启动顺序排查哪些服务阻塞了。可结合 <code>ps awux | grep ServerName</code> 一起排查。</p>
<p>而<code>rc*.d</code>则对应不同开机级数作相应运行, 文件名开头S的表示该服务会加载,K代表该服务不加载:</p>
<div class="admonition note">
<p class="admonition-title">Attention</p>
</div>
<p>rc0.d: 关机级别 -&gt; shutdown 命令 （千万不要把initdefault 设置为0 ）<br />
  rc1.d: 单用户, 不带网络, 不执行daemon背景程序, 不允许非root登陆 类似安全模式。<br />
  rc2.d: 多用户, 不带网络, 不执行daemon背景程序的级别<br />
  rc3.d: 多用户, 带网络的级别(正常级别)<br />
  rc4.d: 用户自定义<br />
  rc5.d: 多用户带图形界面(一般情况)<br />
  rc6.d: 重启级别 -&gt; reboot 命令<br />
  rcS.d: 在rc?.d之前运行</p>
<p>!!! caution &ldquo;Attention&rdquo;<br />
      runlevel 命令可以知道当前级别. <br />
      <div class="codehilite"><pre><span class="nv">$ </span>sudo runlevel
N 3
</pre></div>
<br />
      总的加载顺序是: <br />
      开机init -&gt; rcS.d -&gt; rc0~6.d -&gt; rc.local <br />
      即使有个服务存在/etc/init.d <br />
      但要是没有rc的运行级别来运行, 依然是运行不起来的~ <br />
      sudo init N 就是切换当前操作系统的Runlevel的命令 一般用init 3和init 5</p>
<p>用命令行来设置运行级别的服务可以使用update-rc.d命令, 不同系统该指令有差异.</p>
<div class="codehilite"><pre><span class="c1"># Set service at 2,3,4,5 Level</span>
update-rc.d servicename default
<span class="c1"># Cancel service at 2,3,4,5 Level</span>
update-rc.d servicename remove
<span class="c1"># Cancel service at 2,3,4,5 Level, and delete the symlinks even it exists in /etc/init.d</span>
update-rc.d -f servicename remove
<span class="c1"># Set service at giving Level</span>
update-rc.d servicename <span class="nb">enable</span>  <span class="o">[</span>S<span class="p">|</span>2<span class="p">|</span>3<span class="p">|</span>4<span class="p">|</span>5<span class="o">]</span>
<span class="c1"># Cancel service at giving Level</span>
update-rc.d servicename disable  <span class="o">[</span>S<span class="p">|</span>2<span class="p">|</span>3<span class="p">|</span>4<span class="p">|</span>5<span class="o">]</span>

<span class="c1"># 设定启动级别 </span>
update-rc.d xxx<span class="o">(</span>脚本名<span class="o">)</span> start <span class="m">98</span> <span class="m">2</span> . 
    <span class="c1">#98 为启动序号，</span>
​    <span class="c1">#2是系统的运行级别，可自己调整，</span>
​    <span class="c1">#注意不要忘了结尾的句点。</span>
    <span class="c1">#现在我们到 `/etc/rc2.d` 下，就多了一个 S98mysql 这样的符号链接。</span>
</pre></div>


<p>卸载启动服务脚本</p>
<div class="codehilite"><pre><span class="nv">$ </span><span class="nb">cd</span> /etc/init.d
<span class="nv">$ </span>sudo update-rc.d -f <span class="nb">test </span>remove
</pre></div>


<div class="admonition hint">
<p class="admonition-title">service命令</p>
<p>这个命令主要用途是一次性操作服务 (相当于sysv-rc-conf的+-号).</p>
</div>
<div class="codehilite"><pre>service &lt; option &gt; <span class="p">|</span> --status-all <span class="p">|</span> <span class="o">[</span> service_name <span class="o">[</span> <span class="nb">command</span> <span class="p">|</span> --full-restart <span class="o">]</span> <span class="o">]</span>
<span class="c1">## 查看所有服务当前的状态</span>
service --status-all
<span class="c1">## 开启/重启服务</span>
service mysql start/restart
<span class="c1">## 停止服务 </span>
service mysql stop
</pre></div>


<h2 id="_4"><a name="user-content-_4" href="#_4" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>完整实例</h2>
<p><code>sudo nano /etc/init.d/servicename</code></p>
<div class="codehilite"><pre><span class="ch">#! /bin/sh</span>
<span class="c1"># /etc/init.d/noip </span>

<span class="c1">### BEGIN INIT INFO</span>
<span class="c1"># Provides:          noip</span>
<span class="c1"># Required-Start:    $remote_fs $syslog</span>
<span class="c1"># Required-Stop:     $remote_fs $syslog</span>
<span class="c1"># Default-Start:     2 3 4 5</span>
<span class="c1"># Default-Stop:      0 1 6</span>
<span class="c1"># Short-Description: Simple script to start a program at boot</span>
<span class="c1"># Description:       A simple script which will start / stop a program a boot / shutdown.</span>
<span class="c1">### END INIT INFO</span>

<span class="c1"># If you want a command to always run, put it here</span>

<span class="c1"># Carry out specific functions when asked to by the system</span>
<span class="k">case</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> in
  start<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Starting &quot;</span>
    <span class="c1"># run application you want to start</span>
    servicename

    <span class="p">;;</span>
  stop<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Stopping &quot;</span>
    <span class="c1"># kill application you want to stop</span>
    killall servicename

    <span class="p">;;</span>
  *<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Usage: /etc/init.d/servicename {start|stop}&quot;</span>
    <span class="nb">exit </span>1
    <span class="p">;;</span>
<span class="k">esac</span>

<span class="nb">exit </span>0
</pre></div>


<p>Make the script executable:</p>
<div class="codehilite"><pre>sudo chmod +755 /etc/init.d/servicename
</pre></div>


<p>测试</p>
<div class="codehilite"><pre>sudo /etc/init.d/servicename start  
sudo /etc/init.d/servicename stop
</pre></div>


<p>Register script to be run at startup:</p>
<div class="codehilite"><pre>cd /etc/init.d/
sudo update-rc.d servicename defaults
</pre></div>


<p>清除 remove the script from start-up</p>
<div class="codehilite"><pre>sudo update-rc.d -f servicename remove
</pre></div>


<div class="admonition danger">
<p class="admonition-title">Python脚本</p>
<p>nohup /home/pi/miniconda3/envs/py27/bin/python name.py &gt; /home/pi/log/name.log 2&gt;&amp;1 &amp;</p>
</div>
<h2 id="a4-shell"><a name="user-content-a4-shell" href="#a4-shell" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>A.4 shell脚本</h2>
<p>将写好的脚本（.sh文件）放到目录 <code>/etc/profile.d/</code> 下，系统启动后就会自动执行该目录下的所有shell脚本。</p>
<h2 id="a5"><a name="user-content-a5" href="#a5" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>A.5 登陆命令行时自动运行</h2>
<p>Add your script executable command to the bottom of .bashrc that will run your script every time you log in.</p>
<p>Make sure you are in the pi folder:<br />
<code>$ cd ~</code><br />
Create a file and write a script to run in the file:<br />
<code>$ sudo nano superscript</code><br />
Open up<code>.bashrc</code> for configuration:<br />
<code>$ sudo nano .bashrc</code><br />
Scroll down to the bottom and add the line: ./superscript<br />
Save and exit</p>
<hr />
<h1 id="b-python"><a name="user-content-b-python" href="#b-python" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>附录B Python</h1>
<h2 id="b0-python"><a name="user-content-b0-python" href="#b0-python" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0 python学习笔记</h2>
<h3 id="b01"><a name="user-content-b01" href="#b01" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1基础语法</h3>
<h4 id="b011"><a name="user-content-b011" href="#b011" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.1 输出</h4>
<p>print()在括号中加上字符串，就可以向屏幕上输出指定的文字。<br />
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span><span class="n">print</span><span class="p">(</span><span class="err">&#39;</span><span class="n">hello</span><span class="p">,</span> <span class="n">world</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span><span class="n">print</span><span class="p">(</span><span class="err">&#39;</span><span class="n">The</span> <span class="n">quick</span> <span class="n">brown</span> <span class="n">fox</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">jumps</span> <span class="n">over</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">the</span> <span class="n">lazy</span> <span class="n">dog</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">The</span> <span class="n">quick</span> <span class="n">brown</span> <span class="n">fox</span> <span class="n">jumps</span> <span class="n">over</span> <span class="n">the</span> <span class="n">lazy</span> <span class="n">dog</span>
<span class="cp"># 逗号自动转为空格</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">print</span><span class="p">(</span><span class="err">&#39;</span><span class="mi">100</span> <span class="o">+</span> <span class="mi">200</span> <span class="o">=</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">200</span><span class="p">)</span>
<span class="mi">100</span> <span class="o">+</span> <span class="mi">200</span> <span class="o">=</span> <span class="mi">300</span>
</pre></div>
</p>
<p><strong>格式化字符串</strong></p>
<p>在Python中，采用的格式化方式和C语言是一致的，用%实现</p>
<p><div class="codehilite"><pre>&gt;&gt;&gt; &#39;Hello, %s&#39; % &#39;world&#39;
&#39;Hello, world&#39;
&gt;&gt;&gt; &#39;Hi, %s, you have $%d.&#39; % (&#39;Michael&#39;, 1000000)
&#39;Hi, Michael, you have $1000000.&#39;
</pre></div>
<br />
%d  整数<br />
%f  浮点数<br />
%s  字符串<br />
%x  十六进制整数</p>
<p>指定位数</p>
<p><div class="codehilite"><pre>&gt;&gt;&gt; &#39;%.2f&#39; % 3.1415926
&#39;3.14&#39;
</pre></div>
<br />
如果你不太确定应该用什么，%s永远起作用，它会把任何数据类型转换为字符串。有些时候，字符串里面的%是一个普通字符怎么办？这个时候就需要转义，用%%来表示一个%</p>
<h4 id="b012"><a name="user-content-b012" href="#b012" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.2 输入</h4>
<p><div class="codehilite"><pre>&gt;&gt;&gt; name = input(&#39;please enter your name: &#39;)
 #显示引号内字符串，输入任意字符，然后按回车后完成输入。
</pre></div>
<br />
input()返回的数据类型是str，str不能直接和整数比较，必须先把str转换成整数。Python提供了int()函数来完成这件事情：</p>
<div class="codehilite"><pre>s = input(&#39;birth: &#39;)
birth = int(s)
if birth &lt; 2000:
    print(&#39;00前&#39;)
else:
    print(&#39;00后&#39;)
</pre></div>


<h4 id="b013"><a name="user-content-b013" href="#b013" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3 数据类型</h4>
<h5 id="b0131"><a name="user-content-b0131" href="#b0131" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.1整数</h5>
<p>计算机由于使用二进制，所以，有时候用十六进制表示整数比较方便，十六进制用0x前缀和0-9，a-f表示</p>
<h5 id="b0132"><a name="user-content-b0132" href="#b0132" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.2 浮点数/小数</h5>
<p>科学计数法表示，把10用e替代</p>
<p>整数和浮点数在计算机内部存储的方式是不同的，整数运算永远是精确的。而浮点数运算则可能会有四舍五入的误差。</p>
<h5 id="b0133"><a name="user-content-b0133" href="#b0133" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.3 字符串</h5>
<p>字符串是以单引号&rdquo;或双引号&rdquo;括起来的任意文本。&rsquo;&lsquo;或&rdquo;&ldquo;本身只是一种表示方式，不是字符串的一部分，因此，字符串&rsquo;abc&rsquo;只有a，b，c这3个字符。如果&rsquo;本身也是一个字符，那就可以用&rdquo;&ldquo;括起来，比如&rdquo;I&rsquo;m OK&rdquo;包含的字符是I，&rsquo;，m，空格，O，K这6个字符。如果字符串内部既包含&rsquo;又包含&rdquo;，可以用转义字符"或'来标识。</p>
<div class="codehilite"><pre>&gt;&gt;&gt;&#39;I\&#39;m \&quot;OK\&quot;!&#39;
I&#39;m &quot;OK&quot;!
</pre></div>


<p>转义字符:<br />
\n表示换行，\t表示制表符，\n表示换行，\t表示制表符<br />
用r&rsquo;&lsquo;表示&rsquo;&lsquo;内部的字符串默认不转义<br />
<div class="codehilite"><pre>&gt;&gt;&gt; print(r&#39;\\\t\\&#39;)
\\\t\\
</pre></div>
<br />
Python允许用&rsquo;&lsquo;&rsquo;&hellip;&rsquo;&lsquo;&rsquo;的格式表示多行内容</p>
<div class="codehilite"><pre>&gt;&gt;&gt; print(&#39;&#39;&#39;line1
... line2
... line3&#39;&#39;&#39;)
line1
line2
line3

# 写成程序
print(&#39;&#39;&#39;line1
line2
line3&#39;&#39;&#39;)
</pre></div>


<p><em>字符串编码</em><br />
计算机只能处理数字，如果要处理文本，就必须先把文本转换为数字才能处理。最早的计算机在设计时采用8个比特（bit）作为一个字节（byte），所以，一个字节能表示的最大的整数就是255（二进制11111111=十进制255），如果要表示更大的整数，就必须用更多的字节。比如两个字节可以表示的最大整数是65535，4个字节可以表示的最大整数是4294967295。由于计算机是美国人发明的，因此，最早只有127个字符被编码到计算机里，也就是大小写英文字母、数字和一些符号，这个编码表被称为ASCII编码，比如大写字母A的编码是65，小写字母z的编码是122。但是要处理中文显然一个字节是不够的，至少需要两个字节，而且还不能和ASCII编码冲突，所以，中国制定了<em>GB2312</em>编码，用来把中文编进去。<br />
日文编到Shift_JIS里，韩文编到Euc-kr里。为了消除乱码，Unicode应运而生。现代操作系统和大多数编程语言都直接支持Unicode。</p>
<p>ASCII编码和Unicode编码的区别：ASCII编码是1个字节，而Unicode编码通常是2个字节。<br />
字母A用ASCII编码是十进制的65，二进制的01000001；<br />
字符0用ASCII编码是十进制的48，二进制的00110000，注意字符&lsquo;0&rsquo;和整数0是不同的；<br />
汉字中已经超出了ASCII编码的范围，用Unicode编码是十进制的20013，二进制的01001110 00101101。<br />
你可以猜测，如果把ASCII编码的A用Unicode编码，只需要在前面补0就可以，因此，A的Unicode编码是00000000 01000001。</p>
<p>新的问题又出现了：如果统一成Unicode编码，乱码问题从此消失了。但是，如果你写的文本基本上全部是英文的话，用Unicode编码比ASCII编码需要多一倍的存储空间，在存储和传输上就十分不划算。所以，本着节约的精神，又出现了把Unicode编码转化为“可变长编码”的UTF-8编码。UTF-8编码把一个Unicode字符根据不同的数字大小编码成1-6个字节，常用的英文字母被编码成1个字节，汉字通常是3个字节，只有很生僻的字符才会被编码成4-6个字节。如果你要传输的文本包含大量英文字符，用UTF-8编码就能节省空间</p>
<p>UTF-8编码有一个额外的好处，就是ASCII编码实际上可以被看成是UTF-8编码的一部分，所以，大量只支持ASCII编码的历史遗留软件可以在UTF-8编码下继续工作。</p>
<p><em>现在计算机系统通用的字符编码工作方式：</em><br />
在计算机内存中，统一使用Unicode编码，当需要保存到硬盘或者需要传输的时候，就转换为UTF-8编码。用记事本编辑的时候，从文件读取的UTF-8字符被转换为Unicode字符到内存里，编辑完成后，保存的时候再把Unicode转换为UTF-8保存到文件：<br />
<img alt="记事本编辑" src="https://www.liaoxuefeng.com/files/attachments/001387245992536e2ba28125cf04f5c8985dbc94a02245e000/0" /></p>
<p>网页<br />
<img alt="网页" src="https://www.liaoxuefeng.com/files/attachments/001387245979827634fd6204f9346a1ae6358d9ed051666000/0" /></p>
<p><em>Python的字符串</em></p>
<p>对于单个字符的编码，Python提供了ord()函数获取字符的整数表示，chr()函数把编码转换为对应的字符：</p>
<p><div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">ord</span><span class="p">(</span><span class="sc">&#39;A&#39;</span><span class="p">)</span>
<span class="mi">65</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ord</span><span class="p">(</span><span class="sc">&#39;中&#39;</span><span class="p">)</span>
<span class="mi">20013</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">chr</span><span class="p">(</span><span class="mi">66</span><span class="p">)</span>
<span class="sc">&#39;B&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">chr</span><span class="p">(</span><span class="mi">25991</span><span class="p">)</span>
<span class="sc">&#39;文&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="err">&#39;\</span><span class="n">u4e2d</span><span class="err">\</span><span class="n">u6587</span><span class="err">&#39;</span>
<span class="err">&#39;中文&#39;</span>
</pre></div>
<br />
由于Python的字符串类型是str，在内存中以Unicode表示，一个字符对应若干个字节。如果要在网络上传输，或者保存到磁盘上，就需要把str变为以字节为单位的bytes。</p>
<p>Python对bytes类型的数据用带b前缀的单引号或双引号表示：</p>
<p><div class="codehilite"><pre>x = b&#39;ABC&#39;
</pre></div>
<br />
后者虽然内容显示得和前者一样，但bytes的每个字符都只占用一个字节。<br />
以Unicode表示的str通过encode()方法可以编码为指定的bytes</p>
<div class="codehilite"><pre>&gt;&gt;&gt; &#39;ABC&#39;.encode(&#39;ascii&#39;)
b&#39;ABC&#39;
&gt;&gt;&gt; &#39;中文&#39;.encode(&#39;utf-8&#39;)
b&#39;\xe4\xb8\xad\xe6\x96\x87&#39;
&gt;&gt;&gt; &#39;中文&#39;.encode(&#39;ascii&#39;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
UnicodeEncodeError: &#39;ascii&#39; codec can&#39;t encode characters in position 0-1: ordinal not in range(128)
</pre></div>


<p>反过来，如果我们从网络或磁盘上读取了字节流，那么读到的数据就是bytes。要把bytes变为str，就需要用decode()方法：</p>
<p><div class="codehilite"><pre>&gt;&gt;&gt; b&#39;ABC&#39;.decode(&#39;ascii&#39;)
&#39;ABC&#39;
&gt;&gt;&gt; b&#39;\xe4\xb8\xad\xe6\x96\x87&#39;.decode(&#39;utf-8&#39;)
&#39;中文&#39;
</pre></div>
<br />
要计算str包含多少个字符，可以用len()函数。如果换成bytes，len()函数就计算字节数。</p>
<p><div class="codehilite"><pre>&gt;&gt;&gt; len(b&#39;ABC&#39;)
3
&gt;&gt;&gt; len(b&#39;\xe4\xb8\xad\xe6\x96\x87&#39;)
6
&gt;&gt;&gt; len(&#39;中文&#39;.encode(&#39;utf-8&#39;))
6
</pre></div>
<br />
可见，1个中文字符经过UTF-8编码后通常会占用3个字节，而1个英文字符只占用1个字节。<br />
在操作字符串时，我们经常遇到str和bytes的互相转换。为了避免乱码问题，应当始终坚持使用UTF-8编码对str和bytes进行转换。<br />
由于Python源代码也是一个文本文件，所以，当你的源代码中包含中文的时候，在保存源代码时，就需要务必指定保存为UTF-8编码。当Python解释器读取源代码时，为了让它按UTF-8编码读取，我们通常在文件开头写上这两行：</p>
<p><div class="codehilite"><pre><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
</pre></div>
<br />
<strong>必须并且要确保文本编辑器正在使用UTF-8 without BOM编码</strong></p>
<h5 id="b0134"><a name="user-content-b0134" href="#b0134" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.4布尔值</h5>
<p>在Python中，可以直接用True、False表示布尔值（请注意大小写），也可以通过布尔运算计算出来：<br />
<div class="codehilite"><pre>&gt;&gt;&gt; True
True
&gt;&gt;&gt; False
False
&gt;&gt;&gt; 3 &gt; 2
True
&gt;&gt;&gt; 3 &gt; 5
False
</pre></div>
<br />
布尔值可以用and、or和not运算。</p>
<p>and运算是与运算，只有所有都为True，and运算结果才是True；or运算是或运算，只要其中有一个为True，or运算结果就是True；not运算是非运算，它是一个单目运算符，把True变成False，False变成True。</p>
<h5 id="b0135"><a name="user-content-b0135" href="#b0135" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.5 空值</h5>
<p>空值是Python里一个特殊的值，用None表示。None不能理解为0，因为0是有意义的，而None是一个特殊的空值。</p>
<h5 id="b0136-list"><a name="user-content-b0136-list" href="#b0136-list" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.6 列表 list</h5>
<p>list是一种有序的集合，可以随时添加和删除其中的元素。<br />
列出班里所有同学的名字</p>
<p><div class="codehilite"><pre>&gt;&gt;&gt; classmates = [&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]
&gt;&gt;&gt; classmates
[&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]
</pre></div>
<br />
用len()函数可以获得list元素的个数</p>
<div class="codehilite"><pre>&gt;&gt;&gt; len(classmates)
3
</pre></div>


<p>取最后一个元素，除了计算索引位置外，还可以用-1做索引，直接获取最后一个元素：</p>
<div class="codehilite"><pre>&gt;&gt;&gt; classmates[-1]
&#39;Tracy&#39;
</pre></div>


<p>list是一个可变的有序表</p>
<p><em>追加</em></p>
<div class="codehilite"><pre># 追加元素到末尾
&gt;&gt;&gt; classmates.append(&#39;Adam&#39;)
&gt;&gt;&gt; classmates
[&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;, &#39;Adam&#39;]

# 元素插入到指定的位置
&gt;&gt;&gt; classmates.insert(1, &#39;Jack&#39;)
&gt;&gt;&gt; classmates
[&#39;Michael&#39;, &#39;Jack&#39;, &#39;Bob&#39;, &#39;Tracy&#39;, &#39;Adam&#39;]
</pre></div>


<p><em>删除</em></p>
<div class="codehilite"><pre># 删除list末尾的元素
&gt;&gt;&gt; classmates.pop()
&#39;Adam&#39;
&gt;&gt;&gt; classmates
[&#39;Michael&#39;, &#39;Jack&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]

# 删除指定位置的元素
&gt;&gt;&gt; classmates.pop(1)
&#39;Jack&#39;
&gt;&gt;&gt; classmates
[&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]
</pre></div>


<p><em>替换</em></p>
<div class="codehilite"><pre>&gt;&gt;&gt; classmates[1] = &#39;Sarah&#39;
&gt;&gt;&gt; classmates
[&#39;Michael&#39;, &#39;Sarah&#39;, &#39;Tracy&#39;]
</pre></div>


<p>list里面的元素的数据类型也可以不同</p>
<p><div class="codehilite"><pre>&gt;&gt;&gt; L = [&#39;Apple&#39;, 123, True]

# list元素也可以是另一个list
&gt;&gt;&gt; s = [&#39;python&#39;, &#39;java&#39;, [&#39;asp&#39;, &#39;php&#39;], &#39;scheme&#39;]
&gt;&gt;&gt; len(s)
4
</pre></div>
<br />
要拿到&rsquo;php&rsquo;可以写s[2][1]，因此s可以看成是一个二维数组</p>
<h5 id="b0137-dict"><a name="user-content-b0137-dict" href="#b0137-dict" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.7 字典 dict</h5>
<p>dict全称dictionary，在其他语言中也称为map，使用键-值（key-value）存储，具有极快的查找速度。<br />
例如要根据同学的名字查找对应的成绩，如果用list实现，需要两个list：<br />
<div class="codehilite"><pre>names = [&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]
scores = [95, 75, 85]
</pre></div>
<br />
list越长，耗时越长。<br />
如果用dict实现，只需要一个“名字”-“成绩”的对照表，直接根据名字查找成绩，无论这个表有多大，查找速度都不会变慢。<br />
<div class="codehilite"><pre>&gt;&gt;&gt; d = {&#39;Michael&#39;: 95, &#39;Bob&#39;: 75, &#39;Tracy&#39;: 85}
&gt;&gt;&gt; d[&#39;Michael&#39;]
95
</pre></div>
<br />
dict的实现原理和查字典是一样的。假设字典包含了1万个汉字，我们要查某一个字，一个办法是把字典从第一页往后翻，直到找到我们想要的字为止，这种方法就是在list中查找元素的方法，list越大，查找越慢。</p>
<p>dict是先在字典的索引表里（比如部首表）查这个字对应的页码，然后直接翻到该页，找到这个字。无论找哪个字，这种查找速度都非常快，不会随着字典大小的增加而变慢。比如&rsquo;Michael&rsquo;，dict在内部就可以直接计算出Michael对应的存放成绩的“页码”，也就是95这个数字存放的内存地址，直接取出来，所以速度非常快。</p>
<p><em>添加</em><br />
除了初始化时指定外，还可以通过key放入数据<br />
<div class="codehilite"><pre>&gt;&gt;&gt; d[&#39;Adam&#39;] = 67
&gt;&gt;&gt; d[&#39;Adam&#39;]
67
</pre></div>
<br />
<em>修改</em><br />
由于一个key只能对应一个value，所以，多次对一个key放入value，后面的值会把前面的值冲掉</p>
<p>要避免key不存在的错误，有两种办法，一是通过in判断key是否存在<br />
<div class="codehilite"><pre>&gt;&gt;&gt; &#39;Thomas&#39; in d
False
</pre></div>
<br />
二是通过dict提供的get方法，如果key不存在，可以返回None(返回None的时候Python的交互式命令行不显示结果。)，或者自己指定的value<br />
<div class="codehilite"><pre>&gt;&gt;&gt; d.get(&#39;Thomas&#39;)
&gt;&gt;&gt; d.get(&#39;Thomas&#39;, -1)
-1
</pre></div>
<br />
<em>删除</em><br />
要删除一个key，用pop(key)方法，对应的value也会从dict中删除</p>
<div class="codehilite"><pre>&gt;&gt;&gt; d.pop(&#39;Bob&#39;)
75
&gt;&gt;&gt; d
{&#39;Michael&#39;: 95, &#39;Tracy&#39;: 85}
</pre></div>


<p>dict内部存放的顺序和key放入的顺序是没有关系的。</p>
<p>和list比较，dict有以下几个特点：</p>
<table>
<thead>
<tr>
<th>dict</th>
<th>list</th>
</tr>
</thead>
<tbody>
<tr>
<td>查找和插入的速度极快</td>
<td>查找和插入的时间随着元素的增加而增加</td>
</tr>
<tr>
<td>不会随着key的增加而变慢</td>
<td>占用空间小，浪费内存很少</td>
</tr>
<tr>
<td>需要占用大量的内存</td>
<td><strong>dict是用空间来换取时间的一种方法</strong></td>
</tr>
</tbody>
</table>
<p>注意：<br />
dict的key必须是不可变对象。因为dict根据key来计算value的存储位置，如果每次计算相同的key得出的结果不同，那dict内部就完全混乱了。这个通过key计算位置的算法称为哈希算法（Hash）要保证hash的正确性，作为key的对象就不能变。在Python中，字符串、整数等都是不可变的，因此，可以放心地作为key。而list是可变的，就不能作为key：</p>
<div class="codehilite"><pre>&gt;&gt;&gt; key = [1, 2, 3]
&gt;&gt;&gt; d[key] = &#39;a list&#39;
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
TypeError: unhashable type: &#39;list&#39;
</pre></div>


<h5 id="b0138-set"><a name="user-content-b0138-set" href="#b0138-set" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.8 Set  无序和无重复元素的集合</h5>
<p><div class="codehilite"><pre>&gt;&gt;&gt; s = set([1, 2, 3])
&gt;&gt;&gt; s
{1, 2, 3}
</pre></div>
<br />
传入的参数[1, 2, 3]是一个list，而显示的{1, 2, 3}只是告诉你这个set内部有1，2，3这3个元素，显示的顺序也不表示set是有序的。重复元素在set中自动被过滤。</p>
<p>add(key)方法可以添加元素到set中</p>
<p><div class="codehilite"><pre>&gt;&gt;&gt; s.add(4)
&gt;&gt;&gt; s
{1, 2, 3, 4}
&gt;&gt;&gt; s.add(4)
&gt;&gt;&gt; s
{1, 2, 3, 4}
</pre></div>
<br />
通过remove(key)方法可以删除元素</p>
<div class="codehilite"><pre>&gt;&gt;&gt; s.remove(4)
&gt;&gt;&gt; s
{1, 2, 3}
</pre></div>


<p>set和dict的唯一区别仅在于没有存储对应的value，但是，set的原理和dict一样，所以，同样不可以放入可变对象，因为无法判断两个可变对象是否相等，也就无法保证set内部“不会有重复元素”</p>
<h5 id="b0139"><a name="user-content-b0139" href="#b0139" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.9  不可变对象</h5>
<p>str是不变对象，而list是可变对象。<br />
对于可变对象list 操作，list内部的内容是会变化的</p>
<div class="codehilite"><pre>&gt;&gt;&gt; a = [&#39;c&#39;, &#39;b&#39;, &#39;a&#39;]
&gt;&gt;&gt; a.sort()
&gt;&gt;&gt; a
[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]
</pre></div>


<p>而对于不可变对象str进行操作</p>
<p><div class="codehilite"><pre>&gt;&gt;&gt; a = &#39;abc&#39;
&gt;&gt;&gt; b = a.replace(&#39;a&#39;, &#39;A&#39;)
&gt;&gt;&gt; b
&#39;Abc&#39;
&gt;&gt;&gt; a
&#39;abc&#39;
</pre></div>
<br />
要始终牢记的是，a是变量，而&rsquo;abc&rsquo;才是字符串对象！有些时候，我们经常说，对象a的内容是&rsquo;abc&rsquo;，但其实是指，a本身是一个变量，它指向的对象的内容才是&rsquo;abc&rsquo;</p>
<p>当我们调用a.replace(&lsquo;a&rsquo;, &lsquo;A&rsquo;)时，实际上调用方法replace是作用在字符串对象&rsquo;abc&rsquo;上的，而这个方法虽然名字叫replace，但却没有改变字符串&rsquo;abc&rsquo;的内容。相反，replace方法创建了一个新字符串&rsquo;Abc&rsquo;并返回，如果我们用变量b指向该新字符串，就容易理解了，变量a仍指向原有的字符串&rsquo;abc&rsquo;，但变量b却指向新字符串&rsquo;Abc&rsquo;了</p>
<p>所以，对于不变对象来说，调用对象自身的任意方法，也不会改变该对象自身的内容。相反，这些方法会创建新的对象并返回，这样，就保证了不可变对象本身永远是不可变的。</p>
<p>使用key-value存储结构的dict在Python中非常有用，选择不可变对象作为key很重要，最常用的key是字符串。</p>
<h5 id="b01310-tuple"><a name="user-content-b01310-tuple" href="#b01310-tuple" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.10 tuple</h5>
<p>tuple 有序列表：元组<br />
tuple和list非常类似，但是tuple一旦初始化就不能修改。没有append()，insert()这样的方法。所以代码更安全。如果可能，能用tuple代替list就尽量用tuple。</p>
<p>tuple的陷阱：当你定义一个tuple时，在定义的时候，tuple的元素就必须被确定下来：</p>
<p><div class="codehilite"><pre># 空的
&gt;&gt;&gt; t = ()

# 定义一个只有1个元素的tuple时，加一个逗号,，以免成数学计算意义上的括号。
 &gt;&gt;&gt; t = (1,)

#“可变的”tuple
&gt;&gt;&gt; t = (&#39;a&#39;, &#39;b&#39;, [&#39;A&#39;, &#39;B&#39;])
&gt;&gt;&gt; t[2][0] = &#39;X&#39;
&gt;&gt;&gt; t[2][1] = &#39;Y&#39;
&gt;&gt;&gt; t
(&#39;a&#39;, &#39;b&#39;, [&#39;X&#39;, &#39;Y&#39;])
</pre></div>
<br />
表面上看，tuple的元素确实变了，但其实变的不是tuple的元素，而是list的元素。tuple一开始指向的list并没有改成别的list，所以，tuple所谓的“不变”是说，tuple的每个元素，指向永远不变。即指向&rsquo;a&rsquo;，就不能改成指向&rsquo;b&rsquo;，指向一个list，就不能改成指向其他对象，但指向的这个list本身是可变的</p>
<h5 id="b01311"><a name="user-content-b01311" href="#b01311" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.11 变量</h5>
<p>变量的概念基本上和初中代数的方程变量是一致的，只是在计算机程序中，变量不仅可以是数字，还可以是任意数据类型。</p>
<p>变量在程序中就是用一个变量名表示了，变量名必须是大小写英文、数字和_的组合，且不能用数字开头</p>
<p>在Python中，等号=是赋值语句，可以把任意数据类型赋值给变量，同一个变量可以反复赋值，而且可以是不同类型的变量</p>
<p><div class="codehilite"><pre>a = 123 # B是整数
print(a)
a = &#39;ABC&#39; # B变为字符串
print(a)
</pre></div>
<br />
这种变量本身类型不固定的语言称之为动态语言。</p>
<h5 id="b01312"><a name="user-content-b01312" href="#b01312" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.3.12 常量</h5>
<p>用全部大写的变量名表示常量只是一个习惯上的用法。<br />
·PI = 3.14159265359·</p>
<h4 id="b014"><a name="user-content-b014" href="#b014" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.4 运算</h4>
<p>整数的除法也是精确的。<br />
在Python中，有两种除法，一种除法是/<br />
<div class="codehilite"><pre> &gt;&gt;&gt;9 / 3
3.0
</pre></div>
<br />
还有一种除法是//，称为地板除，两个整数的除法仍然是整数<br />
<div class="codehilite"><pre>&gt;&gt;&gt; 10 // 3
3
</pre></div>
<br />
因为//除法只取结果的整数部分，所以Python还提供一个余数运算，可以得到两个整数相除的余数</p>
<div class="codehilite"><pre>&gt;&gt;&gt; 10 % 3
1
</pre></div>


<h4 id="b015"><a name="user-content-b015" href="#b015" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.5 逻辑语句</h4>
<h5 id="b0151-if"><a name="user-content-b0151-if" href="#b0151-if" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.5.1 if语句</h5>
<p><div class="codehilite"><pre>age = 20
if age &gt;= 6:
    print(&#39;teenager&#39;)
elif age &gt;= 18:
    print(&#39;adult&#39;)
else:
    print(&#39;kid&#39;)

# 简写
if x:
    print(&#39;True&#39;)
</pre></div>
<br />
只要x是非零数值、非空字符串、非空list等，就判断为True，否则为False。</p>
<h5 id="b0152"><a name="user-content-b0152" href="#b0152" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.5.2循环</h5>
<h6 id="b01521-forin"><a name="user-content-b01521-forin" href="#b01521-forin" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.5.2.1  for&hellip;in</h6>
<div class="codehilite"><pre>names = [&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]
for name in names:
    print(name)
</pre></div>


<p>计算1-100的整数之和，从1写到100有点困难，幸好Python提供一个range()函数，可以生成一个整数序列，再通过list()函数可以转换为list。比如range(5)生成的序列是从0开始小于5的整数</p>
<div class="codehilite"><pre>sum = 0
for x in range(101):
    sum = sum + x
print(sum)
</pre></div>


<h6 id="b01522-while"><a name="user-content-b01522-while" href="#b01522-while" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.1.5.2.2 while 循环</h6>
<div class="codehilite"><pre>sum = 0
n = 99
while n &gt; 0:
    sum = sum + n
    n = n - 2
print(sum)
</pre></div>


<h3 id="b02"><a name="user-content-b02" href="#b02" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.2 函数</h3>
<h4 id="b021"><a name="user-content-b021" href="#b021" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.2.1 定义</h4>
<div class="codehilite"><pre>def my_abs(x):
    if x &gt;= 0:
        return x
    else:
        return -x
</pre></div>


<h4 id="b022"><a name="user-content-b022" href="#b022" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.2.2 调用</h4>
<div class="codehilite"><pre>&gt;&gt;&gt; int(&#39;123&#39;)
123
&gt;&gt;&gt; int(12.34)
12
&gt;&gt;&gt; float(&#39;12.34&#39;)
12.34
&gt;&gt;&gt; str(1.23)
&#39;1.23&#39;
&gt;&gt;&gt; str(100)
&#39;100&#39;
&gt;&gt;&gt; bool(1)
True
&gt;&gt;&gt; bool(&#39;&#39;)
False

# 函数名其实就是指向一个函数对象的引用，完全可以把函数名赋给一个变量，相当于给这个函数起了一个“别名”
&gt;&gt;&gt; a = abs # 变量a指向abs函数
&gt;&gt;&gt; a(-1) # 所以也可以通过a调用abs函数
1
</pre></div>


<h4 id="b023"><a name="user-content-b023" href="#b023" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.2.3 参数</h4>
<p>定义函数的时候，我们把参数的名字和位置确定下来，函数的接口定义就完成了。Python的函数定义非常简单，但灵活度却非常大。除了正常定义的必选参数外，还可以使用默认参数、可变参数和关键字参数，使得函数定义出来的接口，不但能处理复杂的参数，还可以简化调用者的代码。</p>
<h5 id="b0231"><a name="user-content-b0231" href="#b0231" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.2.3.1 位置参数</h5>
<div class="codehilite"><pre>def power(x, n):
    s = 1
    while n &gt; 0:
        n = n - 1
        s = s * x
    return s
</pre></div>


<h5 id="b0232"><a name="user-content-b0232" href="#b0232" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.2.3.2 默认参数</h5>
<p>新的power(x, n)函数定义没有问题，但是，旧的调用代码失败了，原因是我们增加了一个参数，导致旧的代码因为缺少一个参数而无法正常调用。这个时候，默认参数就排上用场了。由于我们经常计算x2，所以，完全可以把第二个参数n的默认值设定为2</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">s</span>
</pre></div>


<p>设置默认参数时，有几点要注意：<br />
一是必选参数在前，默认参数在后，否则Python的解释器会报错（思考一下为什么默认参数不能放在必选参数前面）；<br />
二当函数有多个参数时，把变化大的参数放前面，变化小的参数放后面。变化小的参数就可以作为默认参数。<br />
使用默认参数最大的好处是能降低调用函数的难度。</p>
<p><div class="codehilite"><pre><span class="k">def</span> <span class="nf">enroll</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;Beijing&#39;</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;name:&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;gender:&#39;</span><span class="p">,</span> <span class="n">gender</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;age:&#39;</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;city:&#39;</span><span class="p">,</span> <span class="n">city</span><span class="p">)</span>

    <span class="n">enroll</span><span class="p">(</span><span class="s">&#39;Adam&#39;</span><span class="p">,</span> <span class="s">&#39;M&#39;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;Tianjin&#39;</span><span class="p">)</span>
</pre></div>
<br />
但是默认参数有个最大的坑。默认参数必须指向不变对象！<br />
先定义一个函数，传入一个list，添加一个END再返回</p>
<p><div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_end</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;END&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">L</span>

  <span class="c1">#当你正常调用时，结果似乎不错</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">add_end</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;END&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add_end</span><span class="p">([</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">])</span>
<span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="s">&#39;END&#39;</span><span class="p">]</span>

<span class="c1"># 当你使用默认参数调用时，一开始结果也是对的</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add_end</span><span class="p">()</span>
<span class="p">[</span><span class="s">&#39;END&#39;</span><span class="p">]</span>

<span class="c1"># 但是，再次调用add_end()时，结果就不对了</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add_end</span><span class="p">()</span>
<span class="p">[</span><span class="s">&#39;END&#39;</span><span class="p">,</span> <span class="s">&#39;END&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add_end</span><span class="p">()</span>
<span class="p">[</span><span class="s">&#39;END&#39;</span><span class="p">,</span> <span class="s">&#39;END&#39;</span><span class="p">,</span> <span class="s">&#39;END&#39;</span><span class="p">]</span>
</pre></div>
<br />
Python函数在定义的时候，默认参数L的值就被计算出来了，即[]，因为默认参数L也是一个变量，它指向对象[]，每次调用该函数，如果改变了L的内容，则下次调用时，默认参数的内容就变了，不再是函数定义时的[]了。</p>
<p>要修改上面的例子，我们可以用None这个不变对象来实现</p>
<p><div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_end</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">L</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">L</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;END&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">L</span>
</pre></div>
<br />
为什么要设计str、None这样的不变对象呢？因为不变对象一旦创建，对象内部的数据就不能修改，这样就减少了由于修改数据导致的错误。此外，由于对象不变，多任务环境下同时读取对象不需要加锁，同时读一点问题都没有。我们在编写程序时，如果可以设计一个不变对象，那就尽量设计成不变对象。</p>
<h5 id="b0233"><a name="user-content-b0233" href="#b0233" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.2.3.3 可变参数</h5>
<p><div class="codehilite"><pre><span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="o">*</span><span class="n">numbers</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span>
    <span class="k">return</span> <span class="nb">sum</span>
</pre></div>
<br />
定义可变参数和定义一个list或tuple参数相比，仅仅在参数前面加了一个*号。在函数内部，参数numbers接收到的是一个tuple，因此，函数代码完全不变。但是，调用该函数时，可以传入任意个参数，包括0个参数</p>
<p>如果已经有一个list或者tuple，要调用一个可变参数</p>
<p><div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">calc</span><span class="p">(</span><span class="o">*</span><span class="n">nums</span><span class="p">)</span>
<span class="mi">14</span>
</pre></div>
<br />
*nums表示把nums这个list的所有元素作为可变参数传进去。这种写法相当有用，而且很常见。</p>
<h5 id="b0234"><a name="user-content-b0234" href="#b0234" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.2.3.4 关键字参数</h5>
<p>可变参数允许你传入0个或任意个参数，这些可变参数在函数调用时自动组装为一个tuple。而关键字参数允许你传入0个或任意个含参数名的参数，这些关键字参数在函数内部自动组装为一个dict</p>
<p><div class="codehilite"><pre><span class="k">def</span> <span class="nf">person</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;name:&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s">&#39;age:&#39;</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="s">&#39;other:&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
</pre></div>
<br />
可以传入任意个数的关键字参数</p>
<p><div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">person</span><span class="p">(</span><span class="s">&#39;Bob&#39;</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;Beijing&#39;</span><span class="p">)</span>
<span class="n">name</span><span class="p">:</span> <span class="n">Bob</span> <span class="n">age</span><span class="p">:</span> <span class="mi">35</span> <span class="n">other</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;city&#39;</span><span class="p">:</span> <span class="s">&#39;Beijing&#39;</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">person</span><span class="p">(</span><span class="s">&#39;Adam&#39;</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="s">&#39;M&#39;</span><span class="p">,</span> <span class="n">job</span><span class="o">=</span><span class="s">&#39;Engineer&#39;</span><span class="p">)</span>
<span class="n">name</span><span class="p">:</span> <span class="n">Adam</span> <span class="n">age</span><span class="p">:</span> <span class="mi">45</span> <span class="n">other</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;M&#39;</span><span class="p">,</span> <span class="s">&#39;job&#39;</span><span class="p">:</span> <span class="s">&#39;Engineer&#39;</span><span class="p">}</span>
</pre></div>
<br />
关键字参数有什么用？它可以扩展函数的功能。比如，在person函数里，我们保证能接收到name和age这两个参数，但是，如果调用者愿意提供更多的参数，我们也能收到。试想你正在做一个用户注册的功能，除了用户名和年龄是必填项外，其他都是可选项，利用关键字参数来定义这个函数就能满足注册的需求。</p>
<p>和可变参数类似，也可以先组装出一个dict，然后，把该dict转换为关键字参数传进去</p>
<p><div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">extra</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;city&#39;</span><span class="p">:</span> <span class="s">&#39;Beijing&#39;</span><span class="p">,</span> <span class="s">&#39;job&#39;</span><span class="p">:</span> <span class="s">&#39;Engineer&#39;</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">person</span><span class="p">(</span><span class="s">&#39;Jack&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="n">extra</span><span class="p">[</span><span class="s">&#39;city&#39;</span><span class="p">],</span> <span class="n">job</span><span class="o">=</span><span class="n">extra</span><span class="p">[</span><span class="s">&#39;job&#39;</span><span class="p">])</span>
<span class="n">name</span><span class="p">:</span> <span class="n">Jack</span> <span class="n">age</span><span class="p">:</span> <span class="mi">24</span> <span class="n">other</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;city&#39;</span><span class="p">:</span> <span class="s">&#39;Beijing&#39;</span><span class="p">,</span> <span class="s">&#39;job&#39;</span><span class="p">:</span> <span class="s">&#39;Engineer&#39;</span><span class="p">}</span>

<span class="c1"># 或简化</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">extra</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;city&#39;</span><span class="p">:</span> <span class="s">&#39;Beijing&#39;</span><span class="p">,</span> <span class="s">&#39;job&#39;</span><span class="p">:</span> <span class="s">&#39;Engineer&#39;</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">person</span><span class="p">(</span><span class="s">&#39;Jack&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">)</span>
<span class="n">name</span><span class="p">:</span> <span class="n">Jack</span> <span class="n">age</span><span class="p">:</span> <span class="mi">24</span> <span class="n">other</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;city&#39;</span><span class="p">:</span> <span class="s">&#39;Beijing&#39;</span><span class="p">,</span> <span class="s">&#39;job&#39;</span><span class="p">:</span> <span class="s">&#39;Engineer&#39;</span><span class="p">}</span>
</pre></div>
<br />
<strong><em>*</em>*extra表示把extra这个dict的所有key-value用关键字参数传入到函数的</strong>**kw参数，kw将获得一个dict，注意kw获得的dict是extra的一份拷贝，对kw的改动不会影响到函数外的extra</p>
<p><strong>命名关键字参数</strong><br />
对于关键字参数，函数的调用者可以传入任意不受限制的关键字参数。至于到底传入了哪些，就需要在函数内部通过kw检查。<br />
检查是否有city和job参数</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">person</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="s">&#39;city&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
        <span class="c1"># 有city参数</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="s">&#39;job&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
        <span class="c1"># 有job参数</span>
        <span class="k">pass</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;name:&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s">&#39;age:&#39;</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="s">&#39;other:&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
</pre></div>


<p>如果要限制关键字参数的名字，就可以用命名关键字参数，例如，只接收city和job作为关键字参数</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">person</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">job</span><span class="p">)</span>
</pre></div>


<p>和关键字参数<em><em>kw不同，命名关键字参数需要一个特殊分隔符</em>，</em>后面的参数被视为命名关键字参数。</p>
<p>如果函数定义中已经有了一个可变参数，后面跟着的命名关键字参数就不再需要一个特殊分隔符*</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">person</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">job</span><span class="p">)</span>
</pre></div>


<p>命名关键字参数必须传入参数名，这和位置参数不同。如果没有传入参数名，调用将报错。由于调用时缺少参数名city和job，Python解释器把这4个参数均视为位置参数，但person()函数仅接受2个位置参数。</p>
<p>命名关键字参数可以有缺省值，从而简化调用</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">person</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;Beijing&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">job</span><span class="p">)</span>
</pre></div>


<h5 id="b0235"><a name="user-content-b0235" href="#b0235" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.2.3.5 参数组合</h5>
<p>在Python中定义函数，可以用必选参数、默认参数、可变参数、关键字参数和命名关键字参数，这5种参数都可以组合使用。但是请注意，参数定义的顺序必须是：<br />
  1.必选参数<br />
  2.默认参数<br />
  3.可变参数<br />
  4.命名关键字参数<br />
  5.关键字参数</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;a =&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s">&#39;b =&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s">&#39;c =&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s">&#39;args =&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="s">&#39;kw =&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;a =&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s">&#39;b =&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s">&#39;c =&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s">&#39;d =&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="s">&#39;kw =&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
</pre></div>


<p>在函数调用的时候，Python解释器自动按照参数位置和参数名把对应的参数传进去</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">f1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">args</span> <span class="o">=</span> <span class="p">()</span> <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span> <span class="n">args</span> <span class="o">=</span> <span class="p">()</span> <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">)</span> <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">)</span> <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="mi">99</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">99</span> <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
</pre></div>


<p>通过一个tuple和dict，你也可以调用上述函数</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="s">&#39;#&#39;</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f1</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,)</span> <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="s">&#39;#&#39;</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="mi">88</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="s">&#39;#&#39;</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">88</span> <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="s">&#39;#&#39;</span><span class="p">}</span>
</pre></div>


<p><strong>所以，对于任意函数，都可以通过类似func(*args, </strong>kw)的形式调用它，无论它的参数是如何定义的**</p>
<h4 id="b024"><a name="user-content-b024" href="#b024" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.2.4 递归</h4>
<p>在函数内部，可以调用其他函数。如果一个函数在内部调用自身本身，这个函数就是递归函数。</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">fact</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">fact</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>递归函数的优点是定义简单，逻辑清晰。理论上，所有的递归函数都可以写成循环的方式，但循环的逻辑不如递归清晰。</p>
<p>使用递归函数需要注意防止栈溢出。在计算机中，函数调用是通过栈（stack）这种数据结构实现的，每当进入一个函数调用，栈就会加一层栈帧，每当函数返回，栈就会减一层栈帧。由于栈的大小不是无限的，所以，递归调用的次数过多，会导致栈溢出。可以试试fact(1000)</p>
<p>解决递归调用栈溢出的方法是通过尾递归优化，事实上尾递归和循环的效果是一样的，所以，把循环看成是一种特殊的尾递归函数也是可以的。</p>
<p>尾递归是指，在函数返回的时候，调用自身本身，并且，return语句不能包含表达式。这样，编译器或者解释器就可以把尾递归做优化，使递归本身无论调用多少次，都只占用一个栈帧，不会出现栈溢出的情况。</p>
<p>上面的fact(n)函数由于return n * fact(n - 1)引入了乘法表达式，所以就不是尾递归了。要改成尾递归方式，需要多一点代码，主要是要把每一步的乘积传入到递归函数中：</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">fact</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">fact_iter</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fact_iter</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">product</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">product</span>
    <span class="k">return</span> <span class="n">fact_iter</span><span class="p">(</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span> <span class="o">*</span> <span class="n">product</span><span class="p">)</span>
</pre></div>


<p>可以看到，return fact_iter(num - 1, num * product)仅返回递归函数本身，num - 1和num * product在函数调用前就会被计算，不影响函数调用。</p>
<p>fact(5)对应的fact_iter(5, 1)的调用如下</p>
<div class="codehilite"><pre><span class="o">===&gt;</span> <span class="n">fact_iter</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">===&gt;</span> <span class="n">fact_iter</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="o">===&gt;</span> <span class="n">fact_iter</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="o">===&gt;</span> <span class="n">fact_iter</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="o">===&gt;</span> <span class="n">fact_iter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
<span class="o">===&gt;</span> <span class="mi">120</span>
</pre></div>


<p>尾递归调用时，如果做了优化，栈不会增长，因此，无论多少次调用也不会导致栈溢出。</p>
<p>遗憾的是，大多数编程语言没有针对尾递归做优化，Python解释器也没有做优化，所以，即使把上面的fact(n)函数改成尾递归方式，也会导致栈溢出。</p>
<p>基于这一思想，我们来介绍Python中非常有用的高级特性，1行代码能实现的功能，决不写5行代码。请始终牢记，代码越少，开发效率越高。</p>
<h3 id="b03"><a name="user-content-b03" href="#b03" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.3 高级特性</h3>
<p>在Python中，代码不是越多越好，而是越少越好。代码不是越复杂越好，而是越简单越好。</p>
<p>基于这一思想，Python中非常有用的高级特性，1行代码能实现的功能，决不写5行代码。请始终牢记，代码越少，开发效率越高。</p>
<h4 id="b031"><a name="user-content-b031" href="#b031" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.3.1 切片</h4>
<p>一行代码取一个list的前3个元素</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Michael&#39;</span><span class="p">,</span> <span class="s">&#39;Sarah&#39;</span><span class="p">,</span> <span class="s">&#39;Tracy&#39;</span><span class="p">,</span> <span class="s">&#39;Bob&#39;</span><span class="p">,</span> <span class="s">&#39;Jack&#39;</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">L</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="s">&#39;Michael&#39;</span><span class="p">,</span> <span class="s">&#39;Sarah&#39;</span><span class="p">,</span> <span class="s">&#39;Tracy&#39;</span><span class="p">]</span>
</pre></div>


<p>L[0:3]表示，从索引0开始取，直到索引3为止，但不包括索引3。即索引0，1，2，正好是3个元素。如果第一个索引是0，还可以省略</p>
<p>倒数切片</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">L</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
<span class="p">[</span><span class="s">&#39;Bob&#39;</span><span class="p">,</span> <span class="s">&#39;Jack&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">L</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">[</span><span class="s">&#39;Bob&#39;</span><span class="p">]</span>
</pre></div>


<p>创建一个0-99的数列</p>
<div class="codehilite"><pre><span class="n">L</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>

<span class="c1"># 前10个数，每两个取一个</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">L</span><span class="p">[:</span><span class="mi">10</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>

<span class="c1"># 所有数，每5个取一个</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">L</span><span class="p">[::</span><span class="mi">5</span><span class="p">]</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">95</span><span class="p">]</span>

<span class="c1"># 只写[:]就可以原样复制一个list</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">L</span><span class="p">[:]</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mi">99</span><span class="p">]</span>
</pre></div>


<p>tuple也是一种list，唯一区别是tuple不可变。因此，tuple也可以用切片操作，只是操作的结果仍是tuple：</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>
<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>


<p>字符串&rsquo;xxx&rsquo;也可以看成是一种list，每个元素就是一个字符。因此，字符串也可以用切片操作，只是操作结果仍是字符串：</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="s">&#39;ABCDEFG&#39;</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="s">&#39;ABC&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s">&#39;ABCDEFG&#39;</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
<span class="s">&#39;ACEG&#39;</span>
</pre></div>


<h4 id="b032"><a name="user-content-b032" href="#b032" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.3.2 迭代</h4>
<p>Python的for循环抽象程度要高于Java的for循环，因为Python的for循环不仅可以用在list或tuple上，还可以作用在其他可迭代对象上。</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">a</span>
<span class="n">c</span>
<span class="n">b</span>
</pre></div>


<p>默认情况下，dict迭代的是key。如果要迭代value，可以用for value in d.values()，如果要同时迭代key和value，可以用for k, v in d.items()。</p>
<p>迭代字符</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s">&#39;ABC&#39;</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">A</span>
<span class="n">B</span>
<span class="n">C</span>
</pre></div>


<p>迭代list变成索引-元素对</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">]):</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="o">...</span>
<span class="mi">0</span> <span class="n">A</span>
<span class="mi">1</span> <span class="n">B</span>
<span class="mi">2</span> <span class="n">C</span>
</pre></div>


<p>可以直接作用于for循环的数据类型有以下几种：<br />
一类是集合数据类型，如list、tuple、dict、set、str等；<br />
一类是generator，包括生成器和带yield的generator function。<br />
这些可以直接作用于for循环的对象统称为可迭代对象：Iterable。<br />
判断一个对象是可迭代对象</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="c1"># str是否可迭代</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">)</span> <span class="c1"># list是否可迭代</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="c1"># 整数是否可迭代</span>
<span class="bp">False</span>
</pre></div>


<p>而生成器不但可以作用于for循环，还可以被next()函数不断调用并返回下一个值，直到最后抛出StopIteration错误表示无法继续返回下一个值了。<br />
可以被next()函数调用并不断返回下一个值的对象称为迭代器：Iterator</p>
<p>使用isinstance()判断一个对象是否是Iterator对象</p>
<p><div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Iterator</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">((</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span> <span class="n">Iterator</span><span class="p">)</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">([],</span> <span class="n">Iterator</span><span class="p">)</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">({},</span> <span class="n">Iterator</span><span class="p">)</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">)</span>
<span class="bp">False</span>
</pre></div>
<br />
list、dict、str等数据类型不是Iterator。因为Python的Iterator对象表示的是一个数据流，Iterator对象可以被next()函数调用并不断返回下一个数据，直到没有数据时抛出StopIteration错误。可以把这个数据流看做是一个有序序列，但我们却不能提前知道序列的长度，只能不断通过next()函数实现按需计算下一个数据，所以Iterator的计算是惰性的，只有在需要返回下一个数据时它才会计算。</p>
<p>Iterator甚至可以表示一个无限大的数据流，例如全体自然数。而使用list是永远不可能存储全体自然数的。</p>
<p>Python的for循环本质上就是通过不断调用next()函数实现的</p>
<div class="codehilite"><pre><span class="c1"># 首先获得Iterator对象:</span>
<span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="c1"># 循环:</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># 获得下一个值:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="c1"># 遇到StopIteration就退出循环</span>
        <span class="k">break</span>
</pre></div>


<h4 id="b033"><a name="user-content-b033" href="#b033" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.3.3 列表生成</h4>
<p>生成[1x1, 2x2, 3x3, &hellip;, 10x10]列表</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
</pre></div>


<p>还可以筛选出仅偶数的平方</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
</pre></div>


<p>使用两层循环，可以生成全排列</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="s">&#39;ABC&#39;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="s">&#39;XYZ&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s">&#39;AX&#39;</span><span class="p">,</span> <span class="s">&#39;AY&#39;</span><span class="p">,</span> <span class="s">&#39;AZ&#39;</span><span class="p">,</span> <span class="s">&#39;BX&#39;</span><span class="p">,</span> <span class="s">&#39;BY&#39;</span><span class="p">,</span> <span class="s">&#39;BZ&#39;</span><span class="p">,</span> <span class="s">&#39;CX&#39;</span><span class="p">,</span> <span class="s">&#39;CY&#39;</span><span class="p">,</span> <span class="s">&#39;CZ&#39;</span><span class="p">]</span>
</pre></div>


<p>可以使用两个变量来生成list</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="s">&#39;C&#39;</span> <span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span> <span class="o">+</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
<span class="p">[</span><span class="s">&#39;y=B&#39;</span><span class="p">,</span> <span class="s">&#39;x=A&#39;</span><span class="p">,</span> <span class="s">&#39;z=C&#39;</span><span class="p">]</span>
</pre></div>


<p>所有的字符串变成小写</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Hello&#39;</span><span class="p">,</span> <span class="s">&#39;World&#39;</span><span class="p">,</span> <span class="s">&#39;IBM&#39;</span><span class="p">,</span> <span class="s">&#39;Apple&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
<span class="p">[</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;world&#39;</span><span class="p">,</span> <span class="s">&#39;ibm&#39;</span><span class="p">,</span> <span class="s">&#39;apple&#39;</span><span class="p">]</span>
</pre></div>


<h4 id="b034"><a name="user-content-b034" href="#b034" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.3.4 生成器</h4>
<p>一边循环一边计算的机制，称为生成器</p>
<p>通过列表生成式，我们可以直接创建一个列表。但是，受到内存限制，列表容量肯定是有限的。而且，创建一个包含100万个元素的列表，不仅占用很大的存储空间，如果我们仅仅需要访问前面几个元素，那后面绝大多数元素占用的空间都白白浪费了。</p>
<p>要创建一个generator，有很多种方法。第一种方法很简单，只要把一个列表生成式的[]改成()，就创建了一个generator</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">L</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">81</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">g</span>
<span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="o">&lt;</span><span class="n">genexpr</span><span class="o">&gt;</span> <span class="n">at</span> <span class="mh">0x1022ef630</span><span class="o">&gt;</span>
</pre></div>


<p>如果要一个一个打印出来<br />
通过next()函数获得generator的下一个返回值<br />
或者使用for循环，因为generator也是可迭代对象</p>
<p>比如斐波拉契数列：除第一个和第二个数外，任意一个数都可由前两个数相加得到<br />
1, 1, 2, 3, 5, 8, 13, 21, 34, &hellip;</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="nb">max</span><span class="p">):</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="s">&#39;done&#39;</span>
</pre></div>


<p>赋值语句<br />
a, b = b, a + b<br />
相当于：</p>
<div class="codehilite"><pre><span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># t是一个tuple</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>


<p>要把fib函数变成generator，只需要把print(b)改为yield b就可以了</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="nb">max</span><span class="p">):</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">b</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="s">&#39;done&#39;</span>
</pre></div>


<h3 id="b04-oop-object-oriented-design"><a name="user-content-b04-oop-object-oriented-design" href="#b04-oop-object-oriented-design" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.4 OOP (object-oriented design)</h3>
<p>编程的发展已经从简单控制流中按步的指令序列进入到更有组织的方式中，依靠代码块可以形成命名子程序和完成既定的功能。结构化的或过程性编程可以让我们把程序组织成逻辑块，以便重复或重用</p>
<div class="admonition question">
<p class="admonition-title">实质</p>
<p>如果我们能对数据加上动作呢？如果我们所创建和编写的数据片段，是真实生活中实体的模型，内嵌数据体和动作呢？<br />
如果我们能通过一系列已定义的接口(又称存取函数集合)访问数据属性，像自动取款机卡或能访问你的银行帐号的个人支票，我们就有了一个“对象”系统，从大的方面来看，每一个对象既可以与自身进行交互，也可以与其它对象进行交互。</p>
</div>
<div class="admonition attention">
<p class="admonition-title">实现方式与类比</p>
<p>数据层和逻辑层现在由一个可用以创建这些对象的简单抽象层来描述。类提供了这样一些对象的定义，实例即是这些定义的实现。<br />
C++可以被认为“更好的C”; <br />
Java，则要求万物皆类,一个源文件对应一个类定义；<br />
在 Python 中，一切皆对象。</p>
</div>
<div class="admonition question">
<p class="admonition-title">为什么要OOP</p>
<p>考虑用 OOD 来工作的一个最重要的原因，在于它直接提供建模和解决现实世界问题和情形的途径</p>
</div>
<p>相关术语</p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled> 抽象/实现 </li>
<li class="task-list-item"><input type="checkbox" disabled> 封装/接口 </li>
<li class="task-list-item"><input type="checkbox" disabled checked> 合成:彼此是“有一个”的关系</li>
<li class="task-list-item"><input type="checkbox" disabled checked> 派生/继承/继承结构:继承结构表示多“代”派生，可以描述成一个“族谱”，连续的子类，与祖先类都有关系。</li>
<li class="task-list-item"><input type="checkbox" disabled> 泛化/特化:子类可以认为同祖先类是“是一个”的关系</li>
<li class="task-list-item"><input type="checkbox" disabled> 多态</li>
<li class="task-list-item"><input type="checkbox" disabled> 自省/反射:查出传入的一个对象有什么能力</li>
</ul>
<div class="admonition unknown">
<p class="admonition-title">Python</p>
<p>面向对象编程主要有两个主题:<br />
1. 类<br />
2. 实例<br />
类是对象的定义，而实例是&rdquo;真正的实物&rdquo;，它存放了类中所定义的对象的具体信息。<br />
object 是“所有类之母”。如果你的类没有继承任何其他父类，object 将作为默认的父类。<br />
工厂制造机器相当于类，而生产出来的玩具就是它们各个类的实例。尽管每个实例都有一个基本的结构，但各自的属性像颜色或尺寸可以改变-----这就好比实例的属性。<br />
创建一个实例的过程称作实例化</p>
</div>
<p><div class="codehilite"><pre><span class="n">myFirstObject</span> <span class="o">=</span> <span class="n">MyNewObjectType</span><span class="p">()</span> 
</pre></div>
<br />
  我们改进类的方式之一就是给类添加功能(通俗的名字叫方法)。</p>
<div class="codehilite"><pre><span class="k">class</span> <span class="nc">MyDataWithMethod</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>  <span class="c1"># 定义类 </span>
<span class="k">def</span> <span class="nf">printFoo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># 定义方法 </span>
<span class="k">print</span> <span class="s">&#39;You invoked printFoo()!&#39;</span> 

<span class="c1">#调用</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">myObj</span> <span class="o">=</span> <span class="n">MyDataWithMethod</span><span class="p">()</span>  <span class="c1"># 创建实例 </span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">myObj</span><span class="o">.</span><span class="n">printFoo</span><span class="p">()</span>  <span class="c1"># 现在调用方法 </span>
<span class="n">You</span> <span class="n">invoked</span> <span class="n">printFoo</span><span class="p">()</span><span class="err">!</span> 
</pre></div>


<p>self 参数存在于所有方法声明中。代表实例对象本身。在其它语言中，self 称为“this”。</p>
<p>特殊的方法__init__()，子类化及继承。<br />
  Python 创建实例后，在实例化过程中，调用__init__()方法，当一个类被实例化时，就可以定义额外的行为，如果不存在默认的参数，那么传给__init__()的两个参数在实例化时是必须的。</p>
<div class="codehilite"><pre><span class="k">class</span> <span class="nc">AddrBookEntry</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="c1"># 类定义 </span>
<span class="s">&#39;address book entry class&#39;</span> 
 <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">ph</span><span class="p">):</span> <span class="c1"># 定义构造器  </span>
   <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">nm</span>  <span class="c1"># 设置 name </span>
   <span class="bp">self</span><span class="o">.</span><span class="n">phone</span> <span class="o">=</span> <span class="n">ph</span>  <span class="c1"># 设置 phone </span>
   <span class="k">print</span> <span class="s">&#39;Created instance for:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> 
 <span class="k">def</span> <span class="nf">updatePhone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newph</span><span class="p">):</span>  <span class="c1"># 定义方法 </span>
   <span class="bp">self</span><span class="o">.</span><span class="n">phone</span> <span class="o">=</span> <span class="n">newph</span> 
   <span class="k">print</span> <span class="s">&#39;Updated phone# for:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> 

<span class="c1">#创建</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">john</span> <span class="o">=</span> <span class="n">AddrBookEntry</span><span class="p">(</span><span class="s">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s">&#39;408-555-1212&#39;</span><span class="p">)</span> <span class="c1">#为 John Doe 创建实例 </span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jane</span> <span class="o">=</span> <span class="n">AddrBookEntry</span><span class="p">(</span><span class="s">&#39;Jane Doe&#39;</span><span class="p">,</span> <span class="s">&#39;650-555-1212&#39;</span><span class="p">)</span> <span class="c1">#为 Jane Doe 创建实例</span>

<span class="c1">#方法调用（通过实例）</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">john</span><span class="o">.</span><span class="n">updatePhone</span><span class="p">(</span><span class="s">&#39;415-555-1212&#39;</span><span class="p">)</span> <span class="c1">#更新 John Doe 的电话 </span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">john</span><span class="o">.</span><span class="n">phone</span> 
<span class="s">&#39;415-555-1212&#39;</span> 

<span class="c1">#定义子类</span>
<span class="k">class</span> <span class="nc">EmplAddrBookEntry</span><span class="p">(</span><span class="n">AddrBookEntry</span><span class="p">):</span> 
<span class="s">&#39;Employee Address Book Entry class&#39;</span><span class="c1">#员工地址本类 </span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">em</span><span class="p">):</span>  
        <span class="n">AddrBookEntry</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">ph</span><span class="p">)</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">empid</span> <span class="o">=</span> <span class="nb">id</span> <span class="c1">#未绑定的不是通过实例的方法调用 需要:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">em</span> <span class="c1">#显式传递 self 实例对象给基类构造器</span>

    <span class="k">def</span> <span class="nf">updateEmail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newem</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">newem</span> 
        <span class="k">print</span> <span class="s">&#39;Updated e-mail address for:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> 

<span class="c1">#创建子类</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">john</span> <span class="o">=</span> <span class="n">EmplAddrBookEntry</span><span class="p">(</span><span class="s">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s">&#39;408-555-1212&#39;</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span> <span class="s">&#39;john@spam.doe&#39;</span><span class="p">)</span> 
<span class="n">Created</span> <span class="n">instance</span> <span class="k">for</span><span class="p">:</span> <span class="n">John</span> <span class="n">Doe</span>  <span class="c1">#给 John Doe 创建实例</span>
</pre></div>


<h4 id="b041"><a name="user-content-b041" href="#b041" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.4.1 创建类</h4>
<div class="codehilite"><pre><span class="k">class</span> <span class="nc">ClassName</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span> 
<span class="s">&#39;class documentation string&#39;</span> <span class="c1">#&#39;类文档字符串&#39; </span>
<span class="n">class_suite</span> <span class="c1">#类体 </span>
</pre></div>


<div class="admonition attention">
<p class="admonition-title">命名</p>
<p>类名通常由大写字母打头。数据值应该使用名词作为名字，方法使用谓词（动词加对象）。</p>
</div>
<h4 id="b042"><a name="user-content-b042" href="#b042" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>B.0.4.2 类属性</h4></article></body></html>